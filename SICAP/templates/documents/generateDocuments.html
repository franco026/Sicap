
{% extends 'base/base.html' %}
{% load bootstrap4 %}
{% block main %}

<body onload="loadTest()">
    <br>
    <br>
    <br>
    <br>
    <br>


{% load bootstrap4 %}

<div class="col-lg-8 posts-list" >
	<form id="addVoucher">
		<h2>Seleccionar comprobante</h2>
		<br>
		<div id="separator">
			
		</div>
		<br>
		<h2>Seleccione el origen</h2>
		<br>	
			<div id="separatorOP">
				
			</div>
			<br>		
	</form>
	<div id="separatorButton" style="display:none">
		<button  onclick="generateDisponibilty()" id="generator" class="genric-btn primary small">GENERAR DISPONIBILIDAD DE PRESUPUESTO DE</button>
	</div>
</div>
<br>

<div id=divCreate class="container-fluid" style="display:none" >
	<div class="card mb-4">
		<div class="card-header"><i class="fas fa-table mr-1"></i>Agregar disponibilidad</div>
		<div class="card-body">
			<form id="createDisponibility">
				<div class="form-row">
					<div class="col-6">
						<label>Número de disponibilidad</label>
						<input type="number" name="disponibilityIn" id="disponibilityIn" class="form-control" placeholder="Número de disponibilidad" required>
					</div>
					<div class="col-6">
						<label>Fecha disponibilidad</label>				  
						<input name="date" id="date" type="date" class="form-control" >
					</div>
				</div>
				<br>
				<div class="form-row mb-3">
					<div class="col-6">
						<label for="exampleFormControlTextarea1">Observación</label>
						<textarea placeholder="Observación" name="observation" class="form-control" id="exampleFormControlTextarea1" rows="3"></textarea>
					</div>					
				</div>
				<div  class="container-fluid mb-3" style="float:left">
					<div class="card" >
					<div class="card-header " id="textTable"><i class="fas fa-table mr-1" ></i>Lista de rubros por presupuesto de</div>
					<div class="card-body" >
						<div class="table-responsive">
							<div class="mb-2">
								<button  onclick="getRubrosByOrigin(1)" data-toggle="modal" data-target="#myModalRubroOrigin" class="genric-btn primary small">Agregar Rubros</button>               
							</div>
								<table class="table table-bordered dataTable" id="dataTableTest" cellspacing="0" 
								role="grid" aria-describedby="dataTable_info">	
								<thead>
									<tr>
										<th>ID</th>
										<th>Rubro</th>
										<th>Descripción</th>
										<th>Valor Disponibilidad</th>
										<th>Por ejecutar</th>
										<th>Saldo Actual por ejecutar</th>
										<th>Acciones</th>
									</tr>
								</thead>
								<tfoot>
									<tr>
										<th>ID</th>
										<th>Rubro</th>
										<th>Descripción</th>
										<th>Valor Disponibilidad</th>
										<th>Por ejecuta</th>
										<th>Saldo Actual por ejecutar</th>
										<th>Acciones</th>
									</tr>
								</tfoot>
									<tbody>
										<h1></h1>
									</tbody>
								</table>
								
						</div>
						<div class="form-row col-12 mb-2">
								
							<div class="col-8" >
								<h6  id="totalDisponibility" for="totalDisponibility" align="center">DISPONIBILIDAD: 0</h6>					
							</div>
							<div class="col-4" >
								<h6  id="totalBalance" for="totalBalance">SALDO: 0</h6>										
							</div>
						</div>
					</div>
					</div>
				</div>  
				<div  class="container-fluid mb-3" style="float:left">
					<div class="card" >
					<div class="card-header " id="divTabDispoText"><i class="fas fa-table mr-1" ></i>Lista de movimientos disponibilidad del presupuesto de</div>
						<div class="card-body" >
							<div class="table-responsive">
								<table class="table table-bordered dataTable" id="dataTableDispo" cellspacing="0" 
									role="grid" aria-describedby="dataTable_info">
									
									<thead>
										<tr>
											<th>Número</th>	
											<th>Observación</th>
											<th>Valor</th>
											<th>Por Ejecutar</th>
											<th>Fecha</th>
											<th>Acciones</th>
										</tr>
									</thead>
									<tfoot>
										<tr>
											<th>Número</th>	
											<th>Observación</th>
											<th>Valor</th>
											<th>Por Ejecutar</th>
											<th>Fecha</th>
											<th>Acciones</th>
										</tr>
									</tfoot>
									</table>
							</div>
						</div>
					</div>
				</div> 	
				<br>
				<br>
				<div class="form-row mb-2">
					<div id="divInitialBudget" >
						<button type="button" onclick="createDisponibility(1)"   class="btn btn-primary">Guardar disponibilidad</button>
						<button type="button" onclick="createDisponibility(2)" class="btn btn-primary">Guardar y generar registro</button>
						<button type="button" onclick="cancels(2)"  class="btn btn-secondary">Cancelar</button>
					</div>					
				</div>  
			</form>
		</div>	
	</div>
	 

</div>
<div id="divRegister" class="container-fluid" style="display:none">
	<div class="card mb-4">
		<div class="card-header"><i class="fas fa-table mr-1"></i>Agregar registro</div>
		<div class="card-body">
				<div class="form-row">
					<div class="col-6">
						<label>Número de registro:</label>
						<input type="number" name="registerNumber" id="registerNumber" class="form-control" placeholder="Número de registro" >
					</div>
					<div class="col-6">
						<label>Fecha de registro:</label>				  
						<input name="dateRegister" id="dateRegister" type="date" class="form-control" >
					</div>
				</div>
				<br>
				<div class="form-row">
					<div class="col-6" >
						<label id="labelGetDisponibility">Disponibilidad:</label>
						<button type="button" onclick="getDisponibilitysRg()"  data-toggle="modal" data-target="#myModalDisponibilityOrigin"  id="buttonGetDisponibility"  class="btn btn-primary btn-sm" style="font-size:16px"><i class="fa fa-search-plus"></i></button>
						<select class="form-control" id="disponibilitySelectRegister"></select>			
					</div>	
					<div class="col-6" >
						<label>Terceros:</label>
						<button type="button" onclick="getThirdsRg(1)" data-toggle="modal" data-target="#myModalThirds" class="btn btn-primary btn-sm" style="font-size:16px"><i class="fa fa-search-plus"></i></button>
						<select class="form-control" id="terceroSelectRegister"></select>			
					</div>					
				</div>
				<div class="form-row">
					<div class="col-6" >
						<label>Informe Contractual:</label>
						<select class="form-control" id="typeContract"></select>	
					</div>	
					<div  style="display: none;" class="col-6 mb-2" id="DetalltypeContract">
						<label>Contracto</label>
						<select class="form-control"  id="selectDetalltypeContract"></select>
					</div>					
				</div>
				<br>
				<div class="form-row">
					<div class="col-6">
						<label for="exampleFormControlTextarea1">Observación:</label>
						<textarea placeholder="Observación" name="observationRegister" class="form-control" id="observationRegister" rows="3"></textarea>
					</div>					
				</div>	
				<br>
				<div  class="container-fluid mb-3" style="float:left">
					<div class="card" >
					<div class="card-header" id="textTableRubrosRegister"><i class="fas fa-table mr-1" ></i>Rubros de registro de</div>
						<div class="card-body" >
							<div class="table-responsive">
								<table class="table table-bordered dataTable" id="dataTableRegister" cellspacing="0" 
									role="grid" aria-describedby="dataTable_info">
									
									<thead>
										<tr>
											<th>Rubro</th>	
											<th>Descripción</th>
											<th>Valor Disponibilidad</th>
											<th>Valor registro</th>
											<th>Saldo</th>
											<th>Acciones</th>
										</tr>
									</thead>
									<tfoot>
										<tr>
											<th>Rubro</th>	
											<th>Descripción</th>
											<th>Valor Disponibilidad</th>
											<th>Valor registro</th>
											<th>Saldo</th>
											<th>Acciones</th>
										</tr>
									</tfoot>
									</table>
							</div>
							<div class="form-row col-12 mb-2">
						
								<div class="col-8" >
									<h6  id="totalRegisterBalance" for="totalRegisterBalance" align="center">REGISTRO: 0</h6>																							
								</div>
								<div class="col-4" >
									<h6  id="totalRegister" for="totalRegister">SALDO: 0</h6>
								</div>
							</div>	
						</div>
					</div>
				</div>
				<div  class="container-fluid mb-3" style="float:left">
					<div class="card" >
					<div class="card-header" id="divTabRegisterText"><i class="fas fa-table mr-1" ></i>Lista de registros realizados del presupuesto de</div>
						<div class="card-body" >
							<div class="table-responsive">
								<table class="table table-bordered dataTable" id="dataTableGetRegisters" cellspacing="0" 
									role="grid" aria-describedby="dataTable_info">
									
									<thead>
										<tr>
											<th>Registro</th>	
											<th>Observación</th>
											<th>Valor</th>
											<th>Saldo</th>
											<th>Fecha</th>
											<th>Acciones</th>
										</tr>
									</thead>
									<tfoot>
										<tr>
											<th>Registro</th>	
											<th>Observación</th>
											<th>Valor</th>
											<th>Saldo</th>
											<th>Fecha</th>
											<th>Acciones</th>
										</tr>
									</tfoot>
									</table>
							</div>
						</div>
					</div>
				</div>		
				<div class="form-row">
					<div>
						<button onclick="createRegister(1)" type="button" class="btn btn-primary">Guardar registro</button>
						<button onclick="createRegister(2)" type="button" class="btn btn-primary">Guardar y generar obligación</button>
						<button type="button" onclick="cancels(3)" class="btn btn-secondary">Cancelar</button>
					</div>					
				</div>  
		</div>	
	</div>
</div>
<div id="divObligation" class="container-fluid" style="display:none">
	<div class="card mb-4">
		<div class="card-header"><i class="fas fa-table mr-1"></i>Agregar Obligación</div>
		<div class="card-body">
				<div class="form-row">
					<div class="col-6">
						<label>Número de obligación:</label>
						<input type="number" name="numberObligation" id="numberObligation" class="form-control" placeholder="Número de registro" >
					</div>
					<div class="col-6">
						<label>Fecha de obligación:</label>				  
						<input name="dateObligation" id="dateObligation" type="date" class="form-control" >
					</div>
				</div>
				<br>
				<div class="form-row">
					<div class="col-6">
						<label id="labelRegisterSelectObligation">Registro:</label><button id="buttonRegisterSelectObligation" type="button" onclick="getRegistersOB()" data-toggle="modal" data-target="#myModalRegister" class="btn btn-primary btn-sm" style="font-size:16px"><i class="fa fa-search-plus"></i></button>
						<select class="form-control" name="registerObligation" id="registerObligation" >
						</select>
					</div>		
					<div class="col-6" >
						<label id="ThirdsToObligation">Terceros:</label><button type="button"  id="buttonThirdSelectObligation" onclick="getThirdsRg(1)" data-toggle="modal" data-target="#myModalThirds" class="btn btn-primary btn-sm" style="font-size:16px"><i class="fa fa-search-plus"></i></button>
						<select class="form-control" name="terceroSelectObligation" id="terceroSelectObligation" >
						</select>
					</div>					
				</div>
				<br>		
				<div id="textBoxEcono" class="form-row">
					<div class="col-6" >
						<label class="checkbox-inline">Sección de derechos economicos o personales
							<input id="checkEcono"style=" width: 30px; height: 30px; " onclick="changeRE()" type="checkbox" value="">
						</label>
						</select>
					</div>					
				</div>
				<br>
				<div class="form-row">
					<div class="col-6">
						<label for="exampleFormControlTextarea1">Observación:</label>
						<textarea placeholder="Observación" name="observationObligation" class="form-control" id="observationObligation" rows="3"></textarea>
					</div>					
				</div>	
				<br>
				<div  class="container-fluid mb-3" style="float:left">
					<div class="card" >
					<div class="card-header" id="textTableRubrosObligText"><i class="fas fa-table mr-1" style="font-size: 30px;"></i>Rubros de obligación</div>
						<div class="card-body" >
							<div class="table-responsive">
								<table class="table table-bordered dataTable" id="dataTableObligation" cellspacing="0" 
									role="grid" aria-describedby="dataTable_info">
									
									<thead>
										<tr>
											<th>Rubro</th>	
											<th>Inputación</th>
											<th>Valor registro</th>
											<th>Valor Obligación</th>
											<th>Saldo</th>
											<th>Acciones</th>
										</tr>
									</thead>
									<tfoot>
										<tr>
											<th>Rubro</th>	
											<th>Inputación</th>
											<th>Valor Registro</th>
											<th>Valor Obligación</th>
											<th>Saldo</th>
											<th>Acciones</th>
										</tr>
									</tfoot>
									</table>
							</div>
							<div class="form-row col-12 mb-2">
								<div class="col-8" >
									<h6  id="totalObligationBalance" for="totalObligationBalance" align="center">OBLIGACIÓN: 0</h6>
								</div>
								<div class="col-4" >
									<h6  id="totalObligation" for="totalObligation">SALDO: 0</h6>														
								</div>								
							</div>	
						</div>
					</div>
					<br>
					<br>
					<div  class="container-fluid mb-3" style="float:left">
						<div class="card" >
						<div class="card-header" ><i class="fas fa-table mr-1" ></i>Ingreso datos contables</div>
							<div class="card-body" >
								<div class="table-responsive">
									<table style="width: 100%;" class="table table-bordered dataTable" id="dataTableGetAccountsObligation" cellspacing="0" 
										role="grid" aria-describedby="dataTable_info">
										
										<thead>
											<tr>
												<th>rubro</th>
												<th>Cuenta</th>
												<th>Descripción</th>
												<th>Tipo de cuenta</th>
												<th>Documento</th>
												<th>Valor</th>
												<th>Acciones</th>
											</tr>
										</thead>
										<tfoot>
											<tr>
												<th>rubro</th>
												<th>Cuenta</th>
												<th>Descripción</th>
												<th>Tipo de cuenta</th>
												<th>Documento</th>
												<th>Valor</th>
												<th>Acciones</th>
											</tr>
										</tfoot>
										</table>
								</div>
							</div>
						</div>
					</div>	
				</div>		
				<div  class="container-fluid mb-3" style="float:left">
					<div class="card" >
					<div class="card-header" id="divTabObligationText"><i class="fas fa-table mr-1" ></i>Lista de obligaciones realizadas del presupuesto de</div>
						<div class="card-body" >
							<div class="table-responsive">
								<table class="table table-bordered dataTable" id="dataTableGetObligation" cellspacing="0" 
									role="grid" aria-describedby="dataTable_info">
									
									<thead>
										<tr>
											<th>Obligación</th>	
											<th>Observación</th>
											<th>Valor</th>
											<th>Saldo</th>
											<th>Fecha</th>
											<th>Acciones</th>
										</tr>
									</thead>
									<tfoot>
										<tr>
											<th>Obligación</th>	
											<th>Observación</th>
											<th>Valor</th>
											<th>Saldo</th>
											<th>Fecha</th>
											<th>Acciones</th>
										</tr>
									</tfoot>
									</table>
							</div>
						</div>
					</div>
				</div>
					
				<div class="form-row">
					<div >
						<button onclick="createObligation(1)" type="button" class="btn btn-primary">Guardar obligación</button>
						<button onclick="createObligation(2)" type="button" class="btn btn-primary">Guardar y generar comprobante de pago</button>
						<button type="button" onclick="cancels(4)" class="btn btn-secondary">Cancelar</button>
					</div>					
				</div>  
		</div>	
	</div>
</div>
<div id="divVoucherPayment" class="container-fluid" style="display:none">
	<form id="addFilter">
		
		<div class="custom-control custom-radio custom-control-inline">
			<input class="form-check-input"  onclick="getFilter()" type="radio" name="filterCheck" id="exampleRadios1" value="DOCUMENT">
			<label class="form-check-label" for="exampleRadios1" >
				Buscar por cedula
			</label>
		</div> 
		<div class="custom-control custom-radio custom-control-inline">
			<input class="form-check-input" onclick="getFilter()" type="radio" name="filterCheck" id="exampleRadios2" value="NAME">
			<label class="form-check-label" for="exampleRadios2">
				Buscar por nombre
			</label>
		</div>
		
	</form>
	<br>
	<div class="form-group" id="div_filter" >
		<label id="id_label_filter">Escriba su documento</label>
		<div class="form-row">
			<div class="col-4">
				<input type="text" name="name" maxlength="100" class="form-control"  id="id_input_filter">
			</div>
			<div class="col">
				<button type="button" id="buttonGetThird"onclick="getThirdsOb(1)"  class="btn btn-primary btn-sm" style="font-size:16px"><i class="fa fa-search-plus"></i></button>
			</div>
		</div>
		
	</div>
	
	<div class="card mb-4" id="postSelection"  style="display:none">
		<div class="card-header"><i class="fas fa-table mr-1"></i>Generar comprobante de pago</div>
		<div class="card-body">
			
				<div class="form-row">
					
					<div class="col-6" >
						<label>Tipo de documento:</label>
						<select class="form-control" name="typeDocument" id="typeDocument" >
						</select>
					</div>			
					<div class="col-6">
						<label>Número de comprobante de pago:</label>
						<input type="number" name="numberVoucherPayment" id="numberVoucherPayment" class="form-control" placeholder="Número de comprobante de pago" >
					</div>
				</div>
				<br>
				<br>		
				<div class="form-row">	
					
					<div class="col-6">
						<label>Fecha de comprobante de pago:</label>				  
						<input name="dateVoucherPayment" id="dateVoucherPayment" type="date" class="form-control" >
					</div>		

					<div class="col-6">
						<label for="exampleFormControlTextarea1">Observación:</label>
						<textarea placeholder="Observación" name="observationVoucherPayment" class="form-control" id="observationVoucherPayment" rows="3"></textarea>
					</div>					
				</div>	
				<br>					
				<div class="form-row">
					<div  class="container-fluid mb-3" style="float:left">
						<div class="card" >
						<div class="card-header" id="textTableRubrosObligText" style="font-size: 30px;"><i class="fas fa-table mr-1" ></i>Rubros de obligación</div>
							<div class="card-body" >
								<div class="table-responsive">
									<table class="table table-bordered dataTable" id="dataTableVoucher" cellspacing="0" 
										role="grid" aria-describedby="dataTable_info">
										
										<thead>
											<tr>
												<th>Rubro</th>
												<th>Descripcion</th>
												<th>Valor obligacion</th>
												<th>Valor </th>
												<th>Saldo</th>
												<th>Acciones</th>
											</tr>
										</thead>
										<tfoot>
											<tr>
												<th>Rubro</th>
												<th>Descripcion</th>	
												<th>Valor obligacion</th>
												<th>Valor</th>
												<th>Saldo</th>
												<th>Acciones</th>
											</tr>
										</tfoot>
										</table>
								</div>
								<div class="form-row col-12 mb-2">
									<div class="col-8" >		 								
										<h6  id="totalVoucher" for="totalVoucher" align="center">COMPROBANTE DE PAGO: 0</h6>
									</div>
									<div class="col-4" >
										<h6  id="totalVoucherBalance" for="totalVoucherBalance">SALDO: 0</h6>														
									</div>								
								</div>	
							</div>
						</div>
						<br>
						<br>
						<div  class="container-fluid mb-3" style="float:left">
							<div class="card" >
							<div class="card-header" style="font-size: 30px;" ><i class="fas fa-table mr-1" ></i>Descuentos</div>
							<div class="card-body" >
									<button  onclick="getDiscountsManuals()" disabled="true" id="addDiscount" data-toggle="modal" data-target="#myModalDiscount" class="genric-btn primary small">Agregar Descuentos</button>               
									<div class="table-responsive">
										<table class="table table-bordered dataTable" id="dataTableGetDiscounts" cellspacing="0"  style="width: 100%;"
											role="grid" aria-describedby="dataTable_info">
											
											<thead>
												<tr>
													<th>ID</th>	
													<th>Descuento</th>	
													<th>Código cuenta</th>	
													<th>Description</th>
													<th>Acumula</th>
													<th>Tipo de descuento</th>
													<th>Base de calculo</th>
													<th>Valor</th>
													<th>Acciones</th>
												</tr>
											</thead>
											<tfoot>
												<tr>
													<th>ID</th>	
													<th>Decuento</th>	
													<th>Código cuenta</th>
													<th>Description</th>	
													<th>Acumula</th>
													<th>Tipo de descuento</th>
													<th>Base de calculo</th>
													<th>Valor</th>
													<th>Acciones</th>
												</tr>
											</tfoot>
											</table>
									</div>
								</div>
							</div>
						</div>
						<div id="countingToVoucher" style="display:none">
							<div  class="container-fluid mb-3" style="float:left">
								<div class="card" >
								<div class="card-header" style="font-size: 30px;"><i class="fas fa-table mr-1" ></i>Asientos contables</div>
									<div class="card-body" >
										<div style="margin-bottom: 25px;">
											<div style="display: grid;">
												
												<div style="display: grid;justify-content: center;grid-row: 1; grid-column: 1;">
													<label style="font-size: 30px; color:blue"> Total Debito</label>
													<label style="font-size: 25px; text-align: center;" id="totalAccountVoucherD"> 0</label>
												</div>

												<div style="display: grid;justify-content: center;grid-row: 1; grid-column: 2;">
													<label style="font-size: 30px; color:Red"> Diferencia</label>
													<label style="font-size: 25px; text-align: center;" id="totalAccountVoucherDifer"> 0</label>
												</div>
		
												<div style="display: grid;justify-content: center;grid-row: 1; grid-column: 3;">
													<label style="font-size: 30px; color:blue"> Total Credito</label>
													<label style="font-size: 25px; text-align: center;" id="totalAccountVoucherC"> 0</label>
												</div>
													
											</div>
										</div>
										<button  onclick="searchAccountsButtonToVoucher()" id="buttonAddAccount" data-toggle="modal" data-target="#myModalAccountVoucher" class="genric-btn primary small">Agregar Cuenta</button>               
										<div class="table-responsive">
											<table class="table table-bordered dataTable" id="datatableAccountToVoucher" cellspacing="0"  style="width: 100%;"
												role="grid" aria-describedby="dataTable_info">
												
												<thead>
													<tr>
														<th>ID</th>
														<th>Codigo</th>
														<th>Descripción</th>
														<th>Debito</th>
														<th>Credito</th>
														<th>Documento</th>
														<th>Accion</th>
													</tr>
												</thead>
												<tfoot>
													<tr>
														<th>ID</th>
														<th>Codigo</th>
														<th>Descripción</th>
														<th>Debito</th>
														<th>Credito</th>
														<th>Documento</th>
														<th>Accion</th>
													</tr>
												</tfoot>
												
											</table>
										</div>
									</div>
								</div>
							</div>	
						</div>
						<div>
							<button onclick="finishDiscounts()" div="finishDiscounts" id="buttonDiscount" type="button" class="btn btn-primary">Terminar descuentos</button>
							<button onclick="finishAccount()" div="finishDiscounts" id="buttonAccount"  style="display: none;" type="button" class="btn btn-primary">Terminar Asiento Contable</button>
						</div> 	
					</div>
					<div>
						<button onclick="SendCreateVoucherPayment()" disabled  id="buttonFinishVoucher"type="button" class="btn btn-primary">Guardar comprobante de pago</button>
						<button  onclick="cancels(5)" type="button" class="btn btn-secondary">Cancelar</button>
					</div>					
				</div>  
		</div>	
	</div>
</div>
<div class="modal fade bd-example-modal-lg" id="myModalRubroOrigin" role="dialog" style="z-index:1080">
    <div class="modal-dialog modal-lg">
      <div class="modal-content">
        <div class="modal-header">
          <h4 class="modal-title">Lista de rubros para seleccionar</h4>
            </div>
                <div class="modal-body">
					<div  class="container-fluid" >
						<div class="card" >
						<div class="card-header " ><i class="fas fa-table mr-1" ></i>Rubros</div>
						<div class="card-body" >
							<div class="table-responsive">
								<font size="2" face="Arial" >

								<table style="width:70%" class="table table-bordered dataTable " id="dataTableSelectRubro" cellspacing="0" 
									role="grid" aria-describedby="dataTable_info">	
									<thead>
										<tr>
											<th>ID</th>	
											<th>Rubro</th>
											<th>Descripción</th>
											<th>Presupuesto inicial</th>
											<th>Presupuesto real</th>
											<th>Presupuesto por ejecutar</th>
											<th>Seleccionar</th>
										</tr>
									</thead>
									<tfoot>
										<tr>
											<th>ID</th>	
											<th>Rubro</th>
											<th>Descripción</th>
											<th>Presupuesto inicial</th>
											<th>Presupuesto real</th>
											<th>Presupuesto por ejecutar</th>
											<th>Seleccionar</th>
										</tr>
									</tfoot>
										<tbody>
											<h1></h1>
										</tbody>
									</table>
								</font>
	
							</div>	
							</div>
						</div>
					</div> 
                </div>
            </div>         
        </div>  
</div>
<div class="modal fade bd-example-modal-lg" id="myModalDiscount" role="dialog">
    <div class="modal-dialog modal-lg">
      <div class="modal-content">
        <div class="modal-header">
          <h4 class="modal-title">Lista de descuentos para seleccionar</h4>
            </div>
                <div class="modal-body">
					<div  class="container-fluid" >
						<div class="card" >
						<div class="card-header " ><i class="fas fa-table mr-1" ></i>Descuentos</div>
						<div class="card-body" >
							<div class="table-responsive">
								<font size="2" face="Arial" >

									<table style="width:70%" class="table table-bordered dataTable " id="dataTableSelectDiscount" cellspacing="0" 
										role="grid" aria-describedby="dataTable_info">	
										<thead>
											<tr>
												<th>ID</th>	
												<th>Descuento</th>	
												<th>Código cuenta</th>	
												<th>Description</th>
												<th>Acumula</th>
												<th>Tipo de descuento</th>
												<th>Base de calculo</th>
												<th>Acciones</th>
											</tr>
										</thead>
										<tfoot>
											<tr>
												<th>ID</th>	
												<th>Decuento</th>	
												<th>Código cuenta</th>
												<th>Description</th>	
												<th>Acumula</th>
												<th>Tipo de descuento</th>
												<th>Base de calculo</th>
												<th>Acciones</th>
											</tr>
										</tfoot>
									</table>
								</font>
	
							</div>	
							</div>
						</div>
					</div> 
                </div>
            </div>         
        </div>  
</div>

<div class="modal fade bd-example-modal-lg" id="myModalDetall" role="dialog">
    <div class="modal-dialog modal-lg">
      <div class="modal-content">
        <div class="modal-header">
          <h4 class="modal-title">Detalles de la disponibilidad</h4>
            </div>
                <div class="modal-body">
					<div  class="container-fluid " >
						<div class="card mb" >
						<div class="card-header " ><i class="fas fa-table mr-1" ></i>Detalles de rubros implicados</div>
						<div class="card-body" >
							<div class="table-responsive">

								<table class="table table-bordered dataTable" id="datatableDetalles" cellspacing="0" 
									role="grid" aria-describedby="dataTable_info">	
									<thead>
										<tr>
											<th>Rubro</th>	
											<th>Descripción</th>
											<th>Valor Disponibilidad</th>
											<th>Valor Registro</th>
											<th>Saldo</th>
										</tr>
									</thead>
									<tfoot>
										<tr>
											<th>Rubro</th>	
											<th>Descripción</th>
											<th>Valor Disponibilidad</th>
											<th>Valor Registro</th>
											<th>Saldo</th>
										</tr>
									</tfoot>
										<tbody>
											<h1></h1>
										</tbody>
									</table>

							</div>
							<div class="form-row col-12 mb-2">
								<div class="col-8" >
									<h6  id="totalDisponibilityDetail" for="totalDisponibilityDetail" align="center">VALOR: 0</h6>
								</div>				
								<div class="col-4" >
									<h6  id="totalBalanceDetail" for="totalBalanceDetail">POR EJECUTAR: 0</h6>														
								</div>	
							</div>		
							</div>
						</div>
					</div> 
                </div>
            </div>         
        </div>  
</div>

<div class="modal fade bd-example-modal-lg" id="myModalDisponibilityOrigin" role="dialog">
    <div class="modal-dialog modal-lg">
      <div class="modal-content">
        <div class="modal-header">
          <h4 class="modal-title">Lista de disponibilidades</h4>
            </div>
                <div class="modal-body">
					<div  class="container-fluid " >
						<div class="card mb" >
						<div class="card-header " ><i class="fas fa-table mr-1" ></i>Disponibilidades</div>
						<div class="card-body" >
							<div class="table-responsive">
					
								<table class="table table-bordered dataTable " id="dataTableSelectDisponibility" cellspacing="0" 
									role="grid" aria-describedby="dataTable_info">	
									<thead>
										<tr>
											<th>Disponibilidad</th>
											<th>Valor</th>
											<th>Saldo</th>
											<th>Fecha</th>
											<th>Descripción</th>
											<th>Seleccionar</th>
										</tr>
									</thead>
									<tfoot>
										<tr>
											<th>Disponibilidad</th>
											<th>Valor</th>
											<th>Saldo</th>
											<th>Fecha</th>
											<th>Descripción</th>
											<th>Seleccionar</th>
										</tr>
									</tfoot>
										<tbody>
											<h1></h1>
										</tbody>
									</table>
									
							</div>	
							</div>
						</div>
					</div> 
                </div>
            </div>         
        </div>  
</div>
<div class="modal fade bd-example-modal-lg" id="myModalObligation" role="dialog">
    <div class="modal-dialog modal-lg">
      <div class="modal-content">
        <div class="modal-header">
          <h4 class="modal-title">Lista de obligaciones</h4>
            </div>
                <div class="modal-body">
					<div  class="container-fluid " >
						<div class="card mb" >
						<div class="card-header " ><i class="fas fa-table mr-1" ></i>Obligaciones</div>
						<div class="card-body" >
							<div class="table-responsive">
					
								<table class="table table-bordered dataTable " id="dataTableSelectObligation" cellspacing="0" 
									role="grid" aria-describedby="dataTable_info">	
									<thead>
										<tr>
											<th>Obligación</th>
											<th>Valor</th>
											<th>Saldo</th>
											<th>Fecha</th>
											<th>Descripción</th>
											<th>Seleccionar</th>
										</tr>
									</thead>
									<tfoot>
										<tr>
											<th>Obligación</th>
											<th>Valor</th>
											<th>Saldo</th>
											<th>Fecha</th>
											<th>Descripción</th>
											<th>Seleccionar</th>
										</tr>
									</tfoot>
										<tbody>
											<h1></h1>
										</tbody>
									</table>
									
							</div>	
							</div>
						</div>
					</div> 
                </div>
            </div>         
        </div>  
</div>

<div class="modal fade bd-example-modal-lg" id="myModalRegister" role="dialog">
    <div class="modal-dialog modal-lg">
      <div class="modal-content">
        <div class="modal-header">
          <h4 class="modal-title">Lista de registro</h4>
            </div>
                <div class="modal-body">
					<div  class="container-fluid " >
						<div class="card mb" >
						<div class="card-header " ><i class="fas fa-table mr-1" ></i>Registros</div>
						<div class="card-body" >
							<div class="table-responsive">
					
								<table class="table table-bordered dataTable " id="dataTableSelecRegister" cellspacing="0" 
									role="grid" aria-describedby="dataTable_info">	
									<thead>
										<tr>
											<th>Registro</th>
											<th>Valor</th>
											<th>Saldo</th>
											<th>Fecha</th>
											<th>Descripción</th>
											<th>Seleccionar</th>
										</tr>
									</thead>
									<tfoot>
										<tr>
											<th>Disponibilidad</th>
											<th>Valor</th>
											<th>Saldo</th>
											<th>Fecha</th>
											<th>Descripción</th>
											<th>Seleccionar</th>
										</tr>
									</tfoot>
										<tbody>
											<h1></h1>
										</tbody>
									</table>
									
							</div>	
							</div>
						</div>
					</div> 
                </div>
            </div>         
        </div>  
</div>

<div class="modal fade bd-example-modal-lg" id="myModalThirds" role="dialog">
    <div class="modal-dialog modal-lg">
      <div class="modal-content">
        <div class="modal-header">
          <h4 class="modal-title">Lista de terceros</h4>
            </div>
                <div class="modal-body">
					<div  class="container-fluid " >
						<div class="card mb" >
						<div class="card-header " ><i class="fas fa-table mr-1" ></i>Terceros</div>
						<div class="card-body" >
							<div class="table-responsive">
								<button class="genric-btn primary small" onclick="viewFormThirds()"  >Crear terceros</button>  
								<table class="table table-bordered dataTable " id="dataTableThirds" cellspacing="0" 
									role="grid" aria-describedby="dataTable_info">	
									<thead>
										<tr>
											<th>Nombre</th>
											<th>Apellido</th>
											<th>Tipo de identificación</th>
											<th>Identificación</th>
											<th>Teléfono</th>
											<th>Seleccionar</th>
										</tr>
									</thead>
									<tfoot>
										<tr>
											<th>Nombre</th>
											<th>Apellido</th>
											<th>Tipo de identificación</th>
											<th>Identificación</th>
											<th>Teléfono</th>
											<th>Seleccionar</th>
										</tr>
									</tfoot>
										<tbody>
											<h1></h1>
										</tbody>
									</table>
									
							</div>	
							</div>
						</div>
					</div> 
                </div>
            </div>         
        </div>  
</div>

<div class="modal fade bd-example-modal-lg" id="myModalTypeDocuments" role="dialog">
    <div class="modal-dialog modal-lg">
      <div class="modal-content">
        <div class="modal-header">
          <h4 class="modal-title">Lista de documentos</h4>
            </div>
                <div class="modal-body">
					<div  class="container-fluid " >
						<div class="card mb" >
						<div class="card-header " ><i class="fas fa-table mr-1" ></i>Documentos</div>
						<div class="card-body" >
							<div class="table-responsive">
								<table class="table table-bordered dataTable " id="dataTableTypeDocumentsVC" cellspacing="0" 
									role="grid" aria-describedby="dataTable_info">	
									<thead>
										<tr>
											<th>Codigo</th>
											<th>Nombre</th>
											<th>Description</th>
											<th>Categoria</th>
											<th>Seleccionar</th>
										</tr>
									</thead>
									<tfoot>
										<tr>
											<th>Codigo</th>
											<th>Nombre</th>
											<th>Description</th>
											<th>Categoria</th>
											<th>Seleccionar</th>
										</tr>
									</tfoot>
										<tbody>
											<h1></h1>
										</tbody>
									</table>
									
							</div>	
							</div>
						</div>
					</div> 
                </div>
            </div>         
        </div>  
</div>

<div class="modal fade" id="myModalCreateThird" role="dialog">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header">
          <h4 class="modal-title">Añadir nuevo tercero</h4>
            </div>
                <div class="modal-body">
                    <div  class="container-fluid">
                        <form id="addThirdRg" action="">
                            {% csrf_token %}
                            {% bootstrap_form thirdForm %}

                            <div id="divCreateThirdRg"  class="form-group">
                                <button id="btnCreatenThirdRg" type="button" onclick="submitThird()" class="genric-btn success circle" >Registrar Tercero</button>
                                <button type="button"  onclick="cancels(1)" class="genric-btn default circle" data-dismiss="modal">Cancelar</button>
                            </div>   
                    
                        </form>  
                    </div>
                </div>
            </div>         
        </div>  
</div>

<div class="modal fade bd-example-modal-lx" id="myModalRubroImplicado" role="dialog"style="overflow-y: scroll;">
    <div class="modal-dialog modal-lx" style=" width: 90%;max-width:1000px;">
      <div class="modal-content">
        <div class="modal-header">
          <h4 class="modal-title">Rubro implicado en disponibilidad</h4>
            </div>
                <div class="modal-body">
					<div  class="container-fluid " >
						<div class="card mb" >
						<div class="card-header " ><i class="fas fa-table mr-1" ></i>Rubros implicados</div>
						<div class="card-body" >
							<div class="table-responsive">
								<div class="mb-2" id="finishUpdateRID">
									<button  onclick="getFinishProcessUpdateRID()" data-toggle="modal" data-target="#myModalRubroImplicado"  class="genric-btn primary small">Terminar Actualización</button>
									<button  onclick="getRubrosByOrigin(2)" data-toggle="modal" data-target="#myModalRubroOrigin"  class="genric-btn primary small">Agregar Rubro</button>
								</div>
								<table class="table table-bordered dataTable" id="datatableRubroImplicadoDisponibility" cellspacing="0" 
									role="grid" aria-describedby="dataTable_rubroImplicado">	
									<thead>
										<tr>
											<th>Rubro</th>	
											<th>Descripción</th>
											<th>Valor</th>
											<th>Saldo</th>
											<th>Por Ejecutar</th>
											<th>Acciones</th>
										</tr>
									</thead>
									<tfoot>
										<tr>
											<th>Rubro</th>	
											<th>Descripción</th>
											<th>Valor</th>
											<th>Saldo</th>
											<th>Por Ejecutar</th>
											<th>Acciones</th>

										</tr>
									</tfoot>
										<tbody>
											<h1></h1> 

										</tbody>

									</table>

							</div>
							<div class="form-row col-12 mb-2">
								<div class="col-8" >
									<h6  id="totalDisponibilityRID" for="totalDisponibilityRID" align="center">VALOR: 0</h6>
								</div>					
								<div class="col-4" >
									<h6  id="totalBalanceRID" for="totalBalanceRID">POR EJECUTAR: 0</h6>														
								</div>	
							</div>

							<div class="form-row">
						
								<div class="col-6">
									<label>Fecha disponibilidad</label>				  
									<input name="dateUpdate" id="dateUpdate" type="date" class="form-control" >
								</div>
							</div>
							<div class="form-row mb-3">
								<div class="col-6">
									<label for="observationUpdate">Observación</label>
									<textarea placeholder="observación" name="observationUpdate" class="form-control" id="observationUpdate" rows="3"></textarea>
								</div>					
							</div>

							</div>
						</div>
					</div> 
                </div>
            </div>         
        </div>  
</div>

<div class="modal fade bd-example-modal-lg" id="myModalDetailRegister" role="dialog">
    <div class="modal-dialog modal-lg">
      <div class="modal-content">
        <div class="modal-header">
          <h4 class="modal-title">Detalles de registros</h4>
            </div>
                <div class="modal-body">
					<div  class="container-fluid " >
						<div class="card mb" >
						<div class="card-header " id="DetallRegister">Detalles de Rubros implicados del Beneficiaro</div>
						<div class="card-body" >
							<div class="table-responsive">

								<table class="table table-bordered dataTable" id="datatableDetailRegister" cellspacing="0" 
									role="grid" aria-describedby="dataTable_info">	
									<thead>
										<tr>
											<th>Rubro</th>	
											<th>Descripción</th>
											<th>Valor Registro</th>
											<th>Valor Obligación</th>
											<th>Saldo</th>
										</tr>
									</thead>
									<tfoot>
										<tr>
											<th>Rubro</th>	
											<th>Descripción</th>
											<th>Valor Registro</th>
											<th>Valor Obligación</th>
											<th>Saldo</th>
										</tr>
									</tfoot>
										<tbody>
											<h1></h1>
										</tbody>
									</table>

							</div>
							<div class="form-row col-12 mb-2">
								<div class="col-8" >
									<h6  id="totalBalanceDetailRegister" for="totalBalanceDetailRegister" align="center">REGISTRO: 0</h6>
								</div>
								<div class="col-4" >
									<h6  id="totalDetailRegister" for="totalDetailRegister">SALDO: 0</h6>														
								</div>			
							</div>		
							</div>
						</div>
					</div> 
                </div>
            </div>         
        </div>              
</div>
<div class="modal fade bd-example-modal-lg" id="myModalRubroImplicadoRegister" role="dialog">
    <div class="modal-dialog modal-lg">
      <div class="modal-content">
        <div class="modal-header">
          <h4 class="modal-title">Rubro implicado en registro</h4>
            </div>
                <div class="modal-body">
					<div  class="container-fluid " >
						<div class="card mb" >
						<div class="card-header " ><i class="fas fa-table mr-1" ></i>Rubros implicados</div>
						<div class="card-body" >
							<div class="table-responsive">
								<div class="mb-2" id="finishUpdateRIRegist">
									<!-- <button  onclick="getFinishProcessUpdateRIRegist()" data-toggle="modal" data-target="#myModalRubroImplicado"  class="genric-btn primary small">Terminar Actualización</button> -->
									<button  onclick="getFinishProcessUpdateRIRegist()"  class="genric-btn primary small">Terminar Actualización</button>
								</div>
								<table class="table table-bordered dataTable" id="datatableRubroImplicadoRegister" cellspacing="0" 
									role="grid" aria-describedby="dataTable_rubroImplicadoRegister">	
									<thead>
										<tr>
											<th>Rubro</th>	
											<th>Descripción</th>
											<th>Saldo Disponibilidad</th>
											<th>Saldo Registro</th>
											<th>Saldo</th>
											<th>Acciones</th>
										</tr>
									</thead>
									<tfoot>
										<tr>
											<th>Rubro</th>	
											<th>Descripción</th>
											<th>Saldo Disponibilidad</th>
											<th>Saldo Registro</th>
											<th>Saldo</th>
											<th>Acciones</th>

										</tr>
									</tfoot>
										<tbody>
											<h1></h1> 
							
										</tbody>

									</table>

							</div>
							<div class="form-row col-12 mb-2">
								<div class="col-8" >
									<h6  id="totalRegisterDR" for="totalRegisterDR" align="center">REGISTRO: 0</h6>
								</div>
								<div class="col-4" >
									<h6  id="totalBalanceDR" for="totalBalanceDR">SALDO: 0</h6>														
								</div>	
							</div>

							<div class="form-row">
						
								<div class="col-6" >
									<label>Tipo de contrato o pago</label>
									<select class="form-control" id="typeContractUpdate" >
									</select>
								</div>
								<div class="col-6 mb-2" id="DetalltypeContract">
									<label>Contracto</label>
									<input style="display: none;" class="form-control" id="idMovementTC" rows="3">
									<input style="display: none;" class="form-control" id="MovementTC" rows="3">
									<select class="form-control"  id="selectDetalltypeContractUpdate"></select>
								</div>	
								<div class="col-6">
									<label>Fecha Registro</label>				  
									<input name="dateUpdateRegister" id="dateUpdateRegister" type="date" class="form-control" >
								</div>
								
								<div class="col-6" >
									<label>Terceros</label><button type="button" onclick="getThirdsRg(2)" data-toggle="modal" data-target="#myModalThirds" class="btn btn-primary btn-sm" style="font-size:16px"><i class="fa fa-search-plus"></i></button>
									<select class="form-control" id="terceroSelectRegisterUpdate" >
									</select>
								</div>	
							</div>   

							<div class="form-row mb-3">
								<div class="col-12">
									<label for="observationUpdateRegister">Observación</label>
									<textarea placeholder="observación" name="observationUpdateRegister" class="form-control" id="observationUpdateRegister" rows="3"></textarea>
								</div>												
							</div>
												
						</div>
						</div>
						</div>
					</div>  
                </div>
            </div>         
        </div>  
</div>
<div class="modal fade bd-example-modal-lg" id="myModalDetailObligation" role="dialog">
    <div class="modal-dialog modal-lg">
      <div class="modal-content">
        <div class="modal-header">
          <h4 class="modal-title">Detalles de obligaciones</h4>
            </div>
                <div class="modal-body">
					<div  class="container-fluid " >
						<div class="card mb" >
						<div class="card-header " id="DetallObligation">Detalles de Rubros implicados en la obligación del Beneficiaro </div>
						<div class="card-body" >
							<div class="table-responsive">

								<table class="table table-bordered dataTable" id="datatableDetailObligation" cellspacing="0" 
									role="grid" aria-describedby="dataTable_info">	
									<thead>
										<tr>
											<th>Rubro</th>	
											<th>Descripción</th>
											<th>Valor Obligación</th>
											<th>Valor Pago</th>
											<th>Saldo</th>
											<th>Accion</th>
										</tr>
									</thead>
									<tfoot>
										<tr>
											<th>Rubro</th>	
											<th>Descripción</th>
											<th>Valor Obligación</th>
											<th>Valor Pago</th>
											<th>Saldo</th>
											<th>Accion</th>
										</tr>
									</tfoot>
										<tbody>
											<h1></h1>
										</tbody>
									</table>

								</div>
								<div class="form-row col-12 mb-2">
									<div class="col-8" >
										<h6  id="totalBalanceDetailObligation" for="totalBalanceDetailObligation" align="center">OBLIGACIÓN: 0</h6>
									</div>
									<div class="col-4" >
										<h6  id="totalDetailObligation" for="totalDetailObligation">SALDO: 0</h6>														
									</div>
								</div>		
							</div>
						</div>
					</div> 
                </div> 
				<div class="modal-body" id="detailAccount" style="display:none">
					<div  class="container-fluid " >
						<div class="card mb" >
						<div class="card-header " id="DetallAccountObligation"></div>
						<div class="card-body" >
							<div class="table-responsive">

								<table class="table table-bordered dataTable" id="datatableDetailAccountObligation" cellspacing="0" 
									role="grid" aria-describedby="dataTable_info">	
									<thead>
										<tr>
											<th>Cuenta</th>	
											<th>Descripción</th>
											<th>Tipo</th>
											<th>Valor</th>
										</tr>
									</thead>
									<tfoot>
										<tr>
											<th>Cuenta</th>	
											<th>Descripción</th>
											<th>Tipo</th>
											<th>Valor</th>
										</tr>
									</tfoot>
									</table>

								</div>
								<div class="form-row col-12 mb-2">
									<div class="col-8" >
										<h6  id="totalBalanceDetailDebitoObligation" for="totalBalanceDetailDebitoObligation" align="center">Debito: 0</h6>
									</div>
									<div class="col-4" >
										<h6  id="totalBalanceDetailCreditoObligation" for="totalBalanceDetailCreditoObligation">Credito: 0</h6>														
									</div>
								</div>		
							</div>
						</div>
					</div> 
                </div>           
            </div>         
        </div>              
</div>
<div class="modal fade bd-example-modal-lg" id="myModalRubroImplicadoObligation" role="dialog">
    <div class="modal-dialog modal-lg">
      <div class="modal-content">
        <div class="modal-header">
          <h4 class="modal-title">Rubro implicado en obligación</h4>
            </div>
                <div class="modal-body">
					<div  class="container-fluid " >
						<div class="card mb" >
						<div class="card-header " ><i class="fas fa-table mr-1" ></i>Rubros implicados</div>
						<div class="card-body" >
							<div class="table-responsive">
								<div class="mb-2" id="finishUpdateRIOblig">
									<!-- <button  onclick="getFinishProcessUpdateRIOblig()" data-toggle="modal" data-target="#myModalRubroImplicado"  class="genric-btn primary small">Terminar Actualización</button> -->
									<button  onclick="getFinishProcessUpdateRIOblig()" class="genric-btn primary small">Terminar Actualización</button>
								</div>
								<table class="table table-bordered dataTable" id="datatableRubroImplicadoObligation" cellspacing="0" 
									role="grid" aria-describedby="dataTable_rubroImplicadoObligation">	
									<thead>
										<tr>
											<th>Rubro</th>	
											<th>Descripción</th>
											<th>Valor Registro</th>
											<th>Valor Obligación</th>
											<th>Saldo</th>
											<th>Acciones</th>
										</tr>
									</thead>
									<tfoot>
										<tr>
											<th>Rubro</th>	
											<th>Descripción</th>
											<th>Valor Registro</th>
											<th>Valor Obligación</th>
											<th>Saldo</th>
											<th>Acciones</th>

										</tr>
									</tfoot>
										<tbody>
											<h1></h1> 
							
										</tbody>

									</table>

							</div>
							<div class="form-row col-12 mb-2">
								<div class="col-8" >
									<h6  id="totalObligationImp" for="totalObligationImp" align="center">OBLIGACIÓN: 0</h6>
								</div>
								<div class="col-4" >
									<h6  id="totalBalanceObligation" for="totalBalanceObligation">SALDO: 0</h6>														
								</div>
							</div>

							<div class="form-row mb-2">
								<div class="col-6">
									<input style="display: none;" class="form-control" id="MovementOB" rows="3">
									<label>Fecha Obligación</label>				  
									<input name="dateUpdateObligation" id="dateUpdateObligation" type="date" class="form-control" >
								</div>
								<div class="col-6" >
									<label>Terceros</label><button type="button" onclick="getThirds(1)" data-toggle="modal" data-target="#myModalThirds" class="btn btn-primary btn-sm" style="font-size:16px"><i class="fa fa-search-plus"></i></button>
									<select class="form-control" id="terceroSelectUpdateObligation" >
									</select>
								</div>	
							</div>   
							<div class="form-row mb-3">	
								<div class="col-6">
									<label for="observationUpdateObligation">Observación</label>
									<textarea placeholder="observación" name="observationUpdateObligation" class="form-control" id="observationUpdateObligation" rows="3"></textarea>
								</div>												
							</div>

							</div>
						</div>  
					</div>  
                </div>
            </div>         
        </div>  
</div>
<div class="modal fade bd-example-modal-lg" id="myModalAccountVoucher" role="dialog">
    <div class="modal-dialog modal-lg">
      <div class="modal-content">
        <div class="modal-header">
          <h4 class="modal-title" id=>Lista de cuentas</h4>
            </div>
                <div class="modal-body">
					<div  class="container-fluid " >
						<div class="card mb" >
                            <div class="card-header "><i class="fas fa-table mr-1" ></i>Seleccione la cuenta</div>
                                <div class="card-body" >
                                    <div class="table-responsive">
										<input type="number" name="search" min="-9223372036854775808" max="9223372036854775807" class="form-control" placeholder="Buscar por codigo" title="" required="" id="id_search_voucher" >
                                        <table class="table table-bordered dataTable" id="datatableAccountButtonVoucher" cellspacing="0" 
                                            role="grid" aria-describedby="dataTable_accountButton">	
                                            <thead>
                                                <tr>
                                                    <th>Código</th>	
                                                    <th>Descripción</th>
                                                    <th>Acciones</th>
                                                </tr>
                                            </thead>
                                            <tfoot>
                                                <tr>
                                                    <th>Código</th>	
                                                    <th>Descripción</th>
                                                    <th>Acciones</th>
                                                </tr>
                                            </tfoot>
                                                <tbody>
                                                    <h1></h1> 
                                    
                                                </tbody>

                                        </table>
                                    </div>		
                                </div>
                        
                            </div>  
				    </div>  
                </div>
        </div>         
    </div>  
</div>
<div class="modal fade bd-example-modal-lg" id="myModalAccountButton" role="dialog">
    <div class="modal-dialog modal-lg">
      <div class="modal-content">
        <div class="modal-header">
          <h4 class="modal-title" id=>Lista de cuentas para seleccionar</h4>
            </div>
                <div class="modal-body">
					<div  class="container-fluid " >
						<div class="card mb" >
                            <div class="card-header " id="listAccountButton"><i class="fas fa-table mr-1" ></i>Seleccione la cuenta para remplazar</div>
                                <div class="card-body" >
                                    <div class="table-responsive">
										<input type="number" name="search" min="-9223372036854775808" max="9223372036854775807" class="form-control" placeholder="Buscar por codigo" title="" required="" id="id_search" >
                                        <table class="table table-bordered dataTable" id="datatableAccountButton" cellspacing="0" 
                                            role="grid" aria-describedby="dataTable_accountButton">	
                                            <thead>
                                                <tr>
                                                    <th>Código</th>	
                                                    <th>Descripción</th>
                                                    <th>Acciones</th>
                                                </tr>
                                            </thead>
                                            <tfoot>
                                                <tr>
                                                    <th>Código</th>	
                                                    <th>Descripción</th>
                                                    <th>Acciones</th>
                                                </tr>
                                            </tfoot>
                                                <tbody>
                                                    <h1></h1> 
                                    
                                                </tbody>

                                        </table>
                                    </div>		
                                </div>
                        
                            </div>  
				    </div>  
                </div>
        </div>         
    </div>  
</div>
<div class="modal fade bd-example-modal-lx" id="myModalResult" role="dialog">
    <div class="modal-dialog modal-lx" style=" width: 90%;max-width:1000px;">
      <div class="modal-content">
        <div class="modal-header">
          <h4 class="modal-title">Resultado de la busquedad</h4>
            </div>
                <div class="modal-body">
					<div  class="container-fluid " >
						<div class="card mb" >
                            <div class="card-header " id="listResults"><i class="fas fa-table mr-1" ></i>Seleccione las obligaciones</div>
                                <div class="card-body" >
                                    <div class="table-responsive">
                                        <table class="table table-bordered dataTable" id="datatableResultsFilter" cellspacing="0" 
                                            role="grid" aria-describedby="dataTable_resultsFilter">	
                                            <thead>
                                                <tr>
													<th>Origen</th>	
													<th>Beneficiaro</th>	
													<th>Identificacion</th>
													<th>Obligacion</th>
													<th>Imputacion</th>
													<th>Valor</th>
													<th>Saldo</th>
													<th>Fecha</th>
                                                    <th>Acciones</th>
                                                </tr>
                                            </thead>
                                            <tfoot>
                                                <tr>
													<th>Origen</th>	
                                                    <th>Beneficiaro</th>	
													<th>Identificacion</th>
													<th>Obligacion</th>
													<th>Imputacion</th>
													<th>Valor</th>
													<th>Saldo</th>
													<th>Fecha</th>
                                                    <th>Acciones</th>
                                                </tr>
                                            </tfoot>
                                        </table>
                                    </div>		
                                </div>
                            </div>  
						</div> 
				    </div>  
					<div style="display: flex; justify-content: center;">
						<button type='button' onclick="procesoComprobante()" class="genric-btn primary e-large">Aceptar</button>
					</div>
                </div>		
			</div>
        </div>
    </div>  
</div>

<div class="modal fade bd-example-modal-lg" id="myModalRubroList" role="dialog">
	<div class="modal-dialog modal-lx" style=" width: 90%;max-width:850px;">
	  <div class="modal-content">
		<div class="modal-header ">
		  <h4 class="modal-title">Rubros</h4>
			</div>
			<div class="modal-body">
				<div  class="container-fluid col-12" >
					<div class="card mb-12" >
						<div class="card-header " ><i class="fas fa-table mr-1" ></i>Lista de Rubros</div>
						<div class="card-body" >
							<div class="table-responsive">
								<font size="2" face="Arial" >                      
									<table class="table table-bordered dataTable" id="dataTableRubroTem" cellspacing="0" role="grid" aria-describedby="dataTable_info">
										<thead>
											<tr>
												<th >ID</th>
												<th>Rubro</th>
												<th>Tipo</th>
												<th>Descripción</th>
												<th>Presupuesto inicial</th>
												<th>Presupuesto Real</th>
												<th>Presupuesto por ejecutar</th>
											</tr>
										</thead>
										<tfoot>
											<tr>
												<th>ID</th>
												<th>Rubro</th>
												<th>Tipo </th>
												<th>Descripción</th>
												<th>Presupuesto inicial</th>
												<th>Presupuesto Real</th>
												<th>Presupuesto por ejecutar</th>
											</tr>
										</tfoot>
										<tbody>
											<h1 id="rubroTable"></h1>
										</tbody>
									</table>
								</font>   
							</div>	
						</div>    
					</div> 
				</div> 
			</div> 
		</div>  
  </div>
<div class="modal fade bd-example-modal-lg" id="myModalResultObligations" role="dialog">
    <div class="modal-dialog modal-lg">
      <div class="modal-content">
        <div class="modal-header">
          <h4 class="modal-title">Resultado de la busquedad</h4>
            </div>
                <div class="modal-body">
					<div  class="container-fluid " >
						<div class="card mb" >
                            <div class="card-header " id="listResults"><i class="fas fa-table mr-1" ></i>Seleccione la obligacion</div>
                                <div class="card-body" >
                                    <div class="table-responsive">
                                        <table class="table table-bordered dataTable" id="datatableResultsFilterObligation" cellspacing="0" 
                                            role="grid" aria-describedby="dataTable_resultsFilterObligation">	
                                            <thead>
                                                <tr>
													<th>Obligacion</th>	
													<th>Observacion</th>	
													<th>Fecha</th>
													<th>Origin</th>
                                                    <th>Acciones</th>
                                                </tr>
                                            </thead>
                                            <tfoot>
                                                <tr>
                                                    <th>Obligacion</th>	
													<th>Observacion</th>	
													<th>Fecha</th>
													<th>Origin</th>
                                                    <th>Acciones</th>
                                                </tr>
                                            </tfoot>
                                                <tbody>
                                                    <h1></h1> 
                                    
                                                </tbody>

                                        </table>
                                    </div>		
                                </div>
                        
                            </div>  
				    </div>  
                </div>
			</div>         
		</div>  
	</div>

</div>

<div class="modal fade bd-example-modal-lx" id="myModalRepeti" role="dialog"  data-id_elemento="" data-id_rubro="">
    <div class="modal-dialog modal-lx"  style=" width: 80%;max-width:1800px;">
      	<div class="modal-content">
			<div class="modal-header">
				<h4 class="modal-title">Cuentas Rubros</h4>
			</div>
			<div class="modal-body">
				<div class="container-fluid" >
					<div class="card" >
						<div class="card-header " >
							<h6  id="typeAccountLabelDebito" for="typeAccountLabel" align="center">Cuentas</h6>
						</div>
						<div id="tablaDebito">
							<div class="card-body"  >
								<div class="table-responsive">
									<table class="table table-bordered dataTable" id="datatableResultsFilterAccountDebito" cellspacing="0" 
										role="grid" aria-describedby="dataTable_resultsFilterAccountDebito">	
										<thead>
											<tr>
												<th>Rubro</th>	
												<th>Descripción</th>	
												<th>Tipo de Cuenta</th>
												<th>Acciones</th>
											</tr>
										</thead>
										<tfoot>
											<tr>
												<th>Rubro</th>	
												<th>Descripción</th>	
												<th>Tipo de Cuenta</th>
												<th>Acciones</th>
											</tr>
										</tfoot>

									</table>
								</div>	
								<div id="CuentasAuxiliares" style="align-items: start;display: none;;margin-top: 15px;">
									<h6  id="typeAccountLabelDebito" for="typeAccountLabel" align="center">Cuentas Auxiliar</h6>
									<select class="form-control" name="typeAccountSelectAD" id="typeAccountSelectAD" ></select>
								</div>
							</div>
							<div class="card-header " >
								<h6  id="typeAccountLabelCredito" for="typeAccountLabel" align="center">Selecciona una de las cuentas: Credito</h6>
							</div>
						</div>
						<div id="CreateDebito" style="display: none;">
							<div class="card" > 
								<div class="card-header " >
									<h6  id="typeAccountLabelDebito" for="typeAccountLabel" align="center">Agregar cuentas: Debito</h6>
								</div>
								<div class="card-body"  >
									<div style="display: flex; justify-content: center;margin: 25px;">
										<button onclick="AgregarCuenta($('#myModalRepeti').data('id_elemento'),$('#myModalRepeti').data('id_rubro'),'Debito')" class="genric-btn primary e-large">Agregar</button>
									</div>
								</div>
							</div>
						</div>
						<div id="tablaCredito">
							<div class="card-body" >
								<div class="table-responsive">
									<table class="table table-bordered dataTable" id="datatableResultsFilterAccountCredito" cellspacing="0" 
										role="grid" aria-describedby="dataTable_resultsFilterAccountDebito">	
										<thead>
											<tr>
												<th>Rubro</th>	
												<th>Descripción</th>	
												<th>Tipo de Cuenta</th>
												<th>Acciones</th>
											</tr>
										</thead>
										<tfoot>
											<tr>
												<th>Rubro</th>	
												<th>Descripción</th>	
												<th>Tipo de Cuenta</th>
												<th>Acciones</th>
											</tr>
										</tfoot>
	
									</table>
								</div>	
								<div id="CuentasAuxiliaresCredito" style="align-items: start;display: none;;margin-top: 15px;">
									<h6  id="typeAccountLabelDebito" for="typeAccountLabel" align="center">Cuenta Auxiliar</h6>
									<select class="form-control" name="typeAccountSelectAC" id="typeAccountSelectAC" ></select>
								</div>
							</div>
						</div>
						<div id="CreateCredito"style="display: none;" >
							<div class="card" > 
								<div class="card-header " >
									<h6  id="typeAccountLabelDebito" for="typeAccountLabel" align="center">Agregar cuentas: Credito</h6>
								</div>
								<div class="card-body"  >
									<div style="display: flex; justify-content: center;margin: 25px;">
										<button onclick="AgregarCuenta($('#myModalRepeti').data('id_elemento'),$('#myModalRepeti').data('id_rubro'),'Credito')" class="genric-btn primary e-large">Agregar</button>
									</div>
								</div>
							</div>
						</div>
						
					</div>
					<div id="buttonConfirm" style="display: flex; justify-content: center;margin: 25px;">
						<button onclick="ConfirmarSeleccion()" class="genric-btn primary e-large">Continuar</button>
					</div>
				</div> 
			</div>
    	</div>         
    </div>
</div>



<div class="modal fade bd-example-modal-lg" id="myModalNewAccount" role="dialog" data-id_elemento="" data-id_rubro=" " data-type="">
    <div class="modal-dialog modal-lg">
      <div class="modal-content">
        <div class="modal-header">
          <h4 class="modal-title">Resultado de la busquedad</h4>
            </div>
                <div class="modal-body">
					<div  class="container-fluid " >
						<div id="divAccount" class="container-fluid col-12" style="display:block">
                            <div class="card">
                                <div class="card-header mb-3"><i class="fas fa-table mr-1"></i>Cuentas Contables-Operación-Tipo</div>
                                <form id="createAccuont" class="col-12">
                                    <div class="form-row col-12">
                                        <div class="col-8 mb-4" >
                                            <label>Cuenta:</label>
											<label for="exampleDataList" class="form-label">Datalist example</label>
											<input class="form-control" list="accountSelect" id="DataListaccountSelect" placeholder="Type to search..." >
											<datalist style="width: 100%;"id="accountSelect" name="accountSelect">
											</datalist>
                                        </div>                                     
                                    </div>
                                    <div class="col-12 mb-4" >
                                        <label>Operación Cuenta:</label>
                                        <select class="form-control" id="operationAccountSelect" name="operationAccountSelect">
                                            <option  hidden  selected> Selecciona una opción</option>
                                            <option value="Obligacion">Obligación</option>      
                                            <option value="Comprobante de Pago">Comprobante de pago</option>
                                        </select>
                                    </div>
                                    <div class="form-row col-12 mb-1" style="justify-content: center;">
                                        <div>
                                            <button onclick="createAccount($('#myModalNewAccount').data('id_elemento'),$('#myModalNewAccount').data('id_rubro'),$('#myModalNewAccount').data('type'))" type="button" id="addAccountOperation"class="btn btn-primary">Agregar</button>
                                            <button onclick="cleanFields()"type="button" class="btn btn-secondary">Cancelar</button>
                                        </div>	
                                    </div>
									<div class="form-row col-12 mb-1" style="justify-content: center;">
										
										<div>
											
                                            <button onclick="sendAccounts()" type="button" class="btn btn-primary">Guardar cuentas</button>
										</div>	
									</div>
                                </form>   
                                <div class="container-fluid mb-2" style="float:left">
                                    <div class="card">
                                    <div class="card-header mb-2" ><i class="fas fa-table mr-1" ></i>Cuenta</div>
                                        <div class="card-body" >
                                            <div class="table-responsive">
												
												<input type="text" class="form-control" placeholder="Buscar por codigo" title="" required="" id="id_searchRB"> 
                                                <table class="table table-bordered dataTable" id="dataTableAccountingOp" cellspacing="0" 
                                                    role="grid" aria-describedby="dataTable_accountOp">
                                                    
                                                    <thead>
                                                        <tr>
                                                            <th>Rubro</th>
                                                            <th>Cuenta</th>
                                                            <th>Débito-Crédito</th>
                                                            <th>Operacion</th>
                                                            <th>Acciones</th>
                                                        </tr>
                                                    </thead>
                                                    <tfoot>
                                                        <tr>  
                                                            <th>Rubro</th>
                                                            <th>Cuenta</th>
                                                            <th>Débito-Crédito</th>
                                                            <th>Operacion</th>
                                                            <th>Acciones</th>
                                                        </tr>
                                                    </tfoot>
                                                    </table>
                                            </div>    
                                        </div>
                                    </div>
                                </div>  
                            </div>
                        </div>
				    </div>  
                </div>
			</div>         
		</div>  
	</div>

</div>


<div class="modal fade bd-example-modal-lg" id="myModalComprobante" role="dialog">
    <div class="modal-dialog modal-lg">
      <div class="modal-content">
        <div class="modal-header">
          <h4 class="modal-title">Comprobante de pago</h4>
            </div>
                <div class="modal-body">
					<div  class="container-fluid " >
						<div class="card mb" >
                            <div class="card-header " id="listResults"></div>
                                <div class="card-body" >
                                    <div class="table-responsive">
										<div class="form-row">
											<div class="col-6">
												<label>Número de Comprobante:</label>
												<input type="number" name="comprobanteNumber" id="ComprobanteNumber" class="form-control" placeholder="Número de Comprobante" >
											</div>
											<div class="col-6">
												<label>Fecha de Comprobante:</label>				  
												<input name="dateComprobate" id="dateComprobate" type="date" class="form-control" >
											</div>
										</div>
										<form id="AddDocument" action="">
											<div class="form-group">
												<label for="id_TD">Tipo de documento</label>
												<select class="form-control" id="id_TD" required>
												</select>
											</div>
										</form>
										<form id="AddDocument" action="">
											<div class="form-group">
												<label for="id_TD_l">Descuento</label>
												<select class="form-control" id="id_TD" multiple="multiple" required>
												</select>
											</div>
										</form>
                                        <table class="table table-bordered dataTable" id="datatableComprobante" cellspacing="0" 
                                            role="grid" aria-describedby="dataTable_datatableComprobante">	
                                            <thead>
                                                <tr>
													<th>Obligacion</th>	
													<th>Observacion</th>	
													<th>Fecha</th>
													<th>Origin</th>
                                                    <th>Acciones</th>
                                                </tr>
                                            </thead>
                                            <tfoot>
                                                <tr>
                                                    <th>Obligacion</th>	
													<th>Observacion</th>	
													<th>Fecha</th>
													<th>Origin</th>
                                                    <th>Acciones</th>
                                                </tr>
                                            </tfoot>
                                                <tbody>
                                                    <h1></h1> 
                                    
                                                </tbody>

                                        </table>
                                    </div>		
                                </div>
                        
                            </div>  
				    </div>  
                </div>
			</div>         
		</div>  
	</div>

</div>

<script>

//onclick="getFinishProcessUpdateRIOblig()"
var originID=0;
var rubrosToOperation=[];
var addDisponibility=[];
var indexTable;
var totalOperate=0;
var totalOperateArray=[];
var totalDisponibility=0;
var oTable;
var addRegister=[];
var totalRegister=0;
var totalOperateRegister=0;
var totalOperateArrayRegister=[];
var addObligation=[];
var totalObligation=0;
var totalOperateObligation=0;
var totalOperateArrayObligation=[];
var totalOperateArrayVoucher=[];
var addVoucher=[];
var totalVoucher=0;
var totalOperateVoucher=0;
var disponibilitySec;
var registerSec;
var registerSecDispo;
var accountsWithValues =[] 
var arrayIdAccount=[]
var dateValidation;
var dateValidationR;
var checkEconomicsRight="FALSE";
var disponibilityID;
var discountsResponse=[];
var discountsRepeat=[];
var arrayIdsVoucher=[];
var accontsToVoucher=[];
var addDiscounts=[];
var addAccount=[];
var totalCreditos = 0;
var idDebitos=[];
var totalDebitos=0;
var counter = 0;

var oldDateDisp;
var oldObservationDisp;
var disponibilityUpdateTemporalyData;
var numberDisponibility;

var oldDateRegister;
var oldObservationRegister;
var valueRegisterFromValidation;


var oldDateObligation;
var oldObservationRegister;
var valueRegisterFromValidation;

var Tercerodesactivo = 0;

var datesPeriod = []


var auxiliarAccountList=[]

$(document).ready(function() {
	$('#myModalDetailObligation').on('hidden.bs.modal', function () {
		$('#DetallObligation').empty()
		$('#DetallObligation').append('Detalles de Rubros implicados en la obligación del Beneficiaro ')
	})

	$('#myModalDetailRegister').on('hidden.bs.modal', function () {
		$('#DetallRegister').empty()
		$('#DetallRegister').append('Detalles de Rubros implicados del Beneficiaro ')
	})


	

	
	
	$('#myModalNewAccount').on('hidden.bs.modal', function () {
		accountRubro = []
				
		$("#tablaDebito").css("display", "block");
		$("#CreateDebito").css("display", "none");
		$("#buttonConfirm").css("display", "block");

		$("#tablaCredito").css("display", "block");
		$("#CreateCredito").css("display", "none");
		$("#buttonConfirm").css("display", "block");
				
	})

	$('#myModalRubroImplicado').on('hidden.bs.modal', function () {
				if ($('.modal:visible').length) {
				$('body').addClass('modal-open');
				}

				addDisponibilityUpdate = []
				rubrosToOperationUpdate = []
				totalOperateArrayUpdate = []
				totalDetall=0;
				totalDetallDisponibility=0;
				
	})
		$('#dataTableTest').DataTable( {
			"autoWidth": false,
			"columnDefs": [
            {
                "targets": [ 0 ],
                "visible": false
            },
        ]
		,
		  "destroy":true,
		  "language": idioma_español,
		  
			dom: 'Bfrtip',			
		  }
		  );
		  
		  $('#dataTableRubroTem').DataTable( {
			"columns": [
				null,
				{ "type": "string" },
				null,
				null,
				null,
				null,
				null,
			],
			"columnDefs": [
            {
                "targets": [ 0 ],
                "visible": false
            }
        ],
		  "language": idioma_español,
		  
			dom: 'Bfrtip',			
		  }
		  );
} );
$(document).ready(function() {
		$('#datatableAccountButtonVoucher').DataTable( {
			
			"bFilter": false,
			"searching": true,
			"columns": [
					{ "type": "string" },
					null,
					null,
				],
			"language": idioma_español,
			
			dom: 'tp',			
		})	
		$('#datatableAccountButton').DataTable( {
			
			"bFilter": false,
			"searching": true,
			"columns": [
					{ "type": "string" },
					null,
					null,
				],
			"language": idioma_español,
			
			dom: 't',			
		})	

		$('#dataTableSelectDisponibility').DataTable( {
			
		  "destroy":true,
		  "language": idioma_español,
		  
			dom: 'Bfrtip',			
		  }
		  );		
		  
		  $.ajax({
				url: '{% url "getDatePeriod"  0 %}'.replace('0', localStorage.getItem('userID')),
				data: {
					'id':localStorage.getItem('idAC'),
				},
				dataType: 'json',
				success: function (data) {
					datesPeriod = data.LCP
					console.log(datesPeriod)
					var dateMin = new Date()
					dateMin.setDate(1)
					dateMin.setMonth(data.LCP[0]['month'])
					dateMin.setFullYear(data.LCP[0]['year'])
					var monthDatePM = dateMin.getMonth()
					if(monthDatePM.toString().length==1){

						monthDatePM = "0"+dateMin.getMonth()
					}else{
						 monthDatePM = dateMin.getMonth()
					}

					var dateMax = new Date(parseInt(data.LCP[data.LCP.length-1]['year']),parseInt(data.LCP[data.LCP.length-1]['month']),0)
					dateMax.setMonth(parseInt(data.LCP[data.LCP.length-1]['month']))
					var monthDatePX = dateMax.getMonth()
					if(monthDatePX.toString().length==1){
						monthDatePX = "0"+dateMax.getMonth()
					}else{
						monthDatePX = dateMax.getMonth()
					}
					
				}
			}) 
} );


$(document).on('change', '#date', function() {
	var selectDateString = $(this).val()
	var selectDateArray = selectDateString.split('-')
	const found = datesPeriod.filter(function(element) {
		if(element['month'].toString().length==1){
			var monthDB = "0"+element['month']
			return monthDB === selectDateArray[1]
		}else{
			var monthDB = element['month']
			return monthDB === selectDateArray[1]
		}
		
	})

	if(!found[0]['activate']){
		swal("Error", "Este mes se encuentra cerrado", "error");
		$(this).val("")
		$("#disponibilityIn").val(""); 
	}else{
		$.ajax({
				url: '{% url "getDisponibility" 0 %}'.replace('0', localStorage.getItem('userID')),
				data: {
					'bussines':localStorage.getItem('idBussines'),
					'origin': originID,
					'dateCreateDP': selectDateString
				},
				dataType: 'json',
				success: function (data) {
					console.log(data)
					$("#disponibilityIn").val(data.DI); 

					var table = $('#dataTableDispo').DataTable(); 
					var rows = table.rows().remove().draw();
					for (var i=0; i<data.MV.length; i++){

						table.row.add( [
						data.MV[i].disponibility,
						data.MV[i].observation,
						data.MV[i].value,
						data.MV[i].balance,
						data.MV[i].date,
						"<a data-toggle='tooltip' title='Ver detalles de disponibilidad'><button onclick='getDetall("+data.MV[i].id+")' data-toggle='modal' data-target='#myModalDetall' class='btn btn-primary btn-sm'><i class='fa fa-info-circle' aria-hidden='true'></i></button></a>"+			
						"<a data-toggle='tooltip'  id='deleteDisponibility' title='Eliminar disponibilidad'><button onclick=\'deleteDisponibility("+JSON.stringify(data.MV[i].id)+','+JSON.stringify(data.MV[i].disponibility)+")\' class='btn btn-primary btn-sm'><i class='fa fa-trash'></i></button></a>"+
						"<a data-toggle='tooltip'  id='updateDisponibility' title='Modificar disponibilidad'><button onclick=\'getRubroImplicadoDisp("+JSON.stringify(data.MV[i].id)+','+JSON.stringify(data.MV[i].disponibility)+")\' data-toggle='modal' data-target='#myModalRubroImplicado' class='btn btn-primary btn-sm'><i class='fa fa-pencil'></i></button></a>"
				
						])
					}
					table.draw( false );
							
				}
		});	
	}
	console.log($(this).val(),found)
})

$(document).on('change', '#dateRegister', function() {
	var selectDateString = $(this).val()
	var selectDateArray = selectDateString.split('-')
	const found = datesPeriod.filter(function(element) {
		if(element['month'].toString().length==1){
			var monthDB = "0"+element['month']
			return monthDB === selectDateArray[1]
		}else{
			var monthDB = element['month']
			return monthDB === selectDateArray[1]
		}
		
	})

	if(!found[0]['activate']){
		swal("Error", "Este mes se encuentra cerrado", "error");
		$(this).val("")
		$("#disponibilityIn").val(""); 
	}else{
		$.ajax({
			url: '{% url "getRegisterSerial"  0 %}'.replace('0', localStorage.getItem('userID')),
			data: {
				'bussines':localStorage.getItem('idBussines'),
				'origin': originID,
				'dateCreateDP': selectDateString
			},
			dataType: 'json',
			success: function (data) {
				$("#registerNumber").val(data.RE); 
			}
	});
	}
	console.log($(this).val(),found)
})


$(document).on('change', '#dateObligation', function() {
	var selectDateString = $(this).val()
	var selectDateArray = selectDateString.split('-')
	const found = datesPeriod.filter(function(element) {
		if(element['month'].toString().length==1){
			var monthDB = "0"+element['month']
			return monthDB === selectDateArray[1]
		}else{
			var monthDB = element['month']
			return monthDB === selectDateArray[1]
		}
		
	})

	if(!found[0]['activate']){
		swal("Error", "Este mes se encuentra cerrado", "error");
		$(this).val("")
		$("#disponibilityIn").val(""); 
	}else{
		$.ajax({
				url: '{% url "getObligationSerial" 0 %}'.replace('0', localStorage.getItem('userID')),
				data: {
					'bussines':localStorage.getItem('idBussines'),
					'origin': originID,
					'dateCreateDP': selectDateString
				},
				dataType: 'json',
				success: function (data) {
					console.log(data)
					$("#numberObligation").val(data.OB); 
				}
		});	
	}
})


$(document).on('change', '#dateVoucherPayment', function() {
	var selectDateString = $(this).val()
	var selectDateArray = selectDateString.split('-')
	const found = datesPeriod.filter(function(element) {
		if(element['month'].toString().length==1){
			var monthDB = "0"+element['month']
			return monthDB === selectDateArray[1]
		}else{
			var monthDB = element['month']
			return monthDB === selectDateArray[1]
		}
		
	})

	if(!found[0]['activate']){
		swal("Error", "Este mes se encuentra cerrado", "error");
		$(this).val("")
		$("#disponibilityIn").val(""); 
	}else{
		$.ajax({
				url: '{% url "getSerialVoucherPayment" 0 %}'.replace('0', localStorage.getItem('userID')),
				data: {
					'bussines':localStorage.getItem('idBussines'),
					'origin': originID,
					'dateCreateDP': selectDateString
				},
				dataType: 'json',
				success: function (data) {
					console.log(data)
					$("#numberVoucherPayment").val(data.VP); 
				}
		});	
	}
})


$('#id_search').on('input', function() { 
    console.log($(this).val())
    var table = $("#datatableAccountButton").DataTable();
    table.column(0).search("^" + $(this).val(), true, false, true).draw();
});

$('#id_search_voucher').on('input', function() { 
    console.log($(this).val())
    var table = $("#datatableAccountButtonVoucher").DataTable();
    table.column(0).search("^" + $(this).val(), true, false, true).draw();
});


$(document).ready(function() {
		$('#datatableAccountToVoucher').DataTable( {
			
		  "destroy":true,
		  "columnDefs": [
            {
                "targets": [ 0 ],
                "visible": false
            } ],
		  "language": idioma_español,
		  
		  dom: 'tp',			
		
		  }
		  );		 	
} );



					
$(document).ready(function() {
	$('#myModalRepeti').on('hidden.bs.modal', function () {
			var esVisible = $("#visualinform").is(":hidden");
			$("#CuentasAuxiliares").css("display", "none");
			$("#CuentasAuxiliaresCredito").css("display", "none");
			const $selectACredito = document.querySelector("#typeAccountSelectAC");

			for (let i = $selectACredito.options.length; i >= 0; i--) {
					$selectACredito.remove(i);
			}
			const $selectADebito = document.querySelector("#typeAccountSelectAD");

			for (let i = $selectADebito.options.length; i >= 0; i--) {
					$selectADebito.remove(i);
			}
		})
		$('#datatableResultsFilterAccountDebito').DataTable({
			"destroy":true,
		  "language": idioma_español,
		  
			dom: 'tp',		
		})

		$('#datatableResultsFilterAccountCredito').DataTable({
			"destroy":true,
		  "language": idioma_español,
		  
			dom: 'Bfrtip',		
		})

		$('#datatableResultsFilter').DataTable({
			"language": idioma_español,
			"bPaginate": true,
			"bLengthChange": false,
			"bFilter": true,
			"bInfo": false,
			"bAutoWidth": false,
			"destroy":true,
			"searching": false
		})
		$('#dataTableSelecRegister').DataTable( {
			
		  "destroy":true,
		  "language": idioma_español,
		  
			dom: 'Bfrtip',			
		  }
		  );		 	
} );
$(document).ready(function() {
		$('#dataTableObligation').DataTable( { 
			
		  "destroy":true,
		  "language": idioma_español,
		  
			dom: 'Bfrtip',			
		  }
		  );		 	
} );
$(document).ready(function() {
		$('#dataTableGetObligation').DataTable( { 
			
		  "destroy":true,
		  "language": idioma_español,
		  
			dom: 'Bfrtip',			
		  }
		  );		 	
} );
$(document).ready(function() {
		$('#dataTableGetRegisters').DataTable( {
			
		  "destroy":true,
		  "language": idioma_español,
		  
			dom: 'Bfrtip',			
		  }
		  );		 	
} );
$(document).ready(function() {
		$('#dataTableGetAccountsObligation').DataTable( {
			"ordering": false,	
			"columnDefs": [
            {
                "targets": [ 0 ],
                "visible": false
            }
        ],
		  "destroy":true,
		  "language": idioma_español,
		  
			dom: 'Bfrtip',			
		  }
		  );		 	
} );
$(document).ready(function() {
		$('#dataTableThirds').DataTable( {
			
		  "destroy":true,
		  "language": idioma_español,
		  
			dom: 'Bfrtip',			
		  }
		  );		 	
} );$(document).ready(function() {
		$('#dataTableRegister').DataTable( {
			
		  "destroy":true,
		  "language": idioma_español,
		  
			dom: 'Bfrtip',			
		  }
		  );		 	
} );
$(document).ready(function() {
		$('#dataTableDispo').DataTable( {
			
		  "destroy":true,
		  "language": idioma_español,
		  
			dom: 'Bfrtip',			
		  }
		  );		 	
} );
$(document).ready(function() {
		$('#datatableDetalles').DataTable( {
			
		  "destroy":true,
		  "language": idioma_español,
		  
			dom: 'Bfrtip',			
		  }
		  );		 	
} );
$(document).ready(function() {
		$('#dataTableSelectRubro').DataTable( {
			"ordering": false,
			"columnDefs": [
            {
                "targets": [ 0 ],
                "visible": false
            }
        ],
		  "destroy":true,
		  "language": idioma_español,
		  
			dom: 'Bfrtip',			
		  }
		  );		 	
} );
$(document).ready(function() {
		$('#datatableRubroImplicadoDisponibility').DataTable( {
			
		  "destroy":true,
		  "language": idioma_español,
		  
			dom: 'Bfrtip',			
		  }
		  );		 	
} );
$(document).ready(function() {
		$('#datatableRubroImplicadoRegister').DataTable( {
			
		  "destroy":true,
		  "language": idioma_español,
		  
			dom: 'Bfrtip',			
		  }
		  );		 	
} );
$(document).ready(function() {


		$('#datatableDetailAccountObligation').DataTable( {
			
			"destroy":true,
			"language": idioma_español,
			
			dom: 'tp',				
		});		 




		$('#datatableDetailRegister').DataTable( {
			
		  "destroy":true,
		  "language": idioma_español,
		  
			dom: 'Bfrtip',			
		  }
		  );		 	
} );
$(document).ready(function() {
		$('#datatableDetailObligation').DataTable( {
			
		  "destroy":true,
		  "language": idioma_español,
		  
			dom: 'Bfrtip',			
		  }
		  );		 	
} );
$(document).ready(function() {
		$('#datatableRubroImplicadoObligation').DataTable( {
			
		  "destroy":true,
		  "language": idioma_español,
		  
			dom: 'Bfrtip',			
		  }
		  );		 	
} );
$(document).ready(function() {
		$('#dataTableVoucher').DataTable( {
			
		  "destroy":true,
		  "language": idioma_español,
		  
			dom: 'Bfrtip',			
		  }
		  );		 	
} );


$(document).ready(function() {

	

		$('#dataTableAccountingOp').DataTable( {
			
			"destroy":true,
			"bFilter": false,
        	"searching": true,
			"language": idioma_español,
			
			  dom: 'tp',			
			}
			);

		$('#dataTableGetDiscounts').DataTable( {
			
		  "destroy":true,
		  "columnDefs": [
            {
                "targets": [ 0 ],
                "visible": false
            }
        	],
		 
		  "language": idioma_español,
		  
			dom: 'Bfrtip',			
		  }
		  );	
		  
		  $('#dataTableSelectDiscount').DataTable( {
			
			"destroy":true,
			"columnDefs": [
			  {
				  "targets": [ 0 ],
				  "visible": false
			  }
			  ],
		   
			"language": idioma_español,
			
			  dom: 'Bfrtp',			
			}
			);	
} );


$('#id_searchRB').on('input', function() { 

    var table = $("#dataTableAccountingOp").DataTable();
    table.column(0).search("^" + $(this).val(), true, false, true).draw();
});


function changeRE(){
	if(checkEconomicsRight=="FALSE"){
		checkEconomicsRight="TRUE";
		
		$('#terceroSelectObligation> option[value='+$("#terceroSelectRegister option:selected").val()+']').prop('selected', true);
		$('#terceroSelectObligation').prop('disabled', 'disabled');
	}else{
		
		$('#terceroSelectObligation').prop('disabled', false);
		checkEconomicsRight="FALSE";
	}
}
function loadTest() {	
	$.ajax({
		url: '{% url "getVoucher"  0 %}'.replace('0', localStorage.getItem('userID')),
		data: {
			'option': '1',
			'idBussines': localStorage.getItem('idBussines'),
		},
		dataType: 'json',
		success: function (data) {
		$('#separator')
				.append(`
				<div class="custom-control custom-radio custom-control-inline">
					<input  onclick="getRadioButon()" value="DISPONIBILIDAD" type="radio" class="custom-control-input" id="DISPONIBILIDAD" name="typeComprobante">
					<label class="custom-control-label" for="DISPONIBILIDAD">DISPONIBILIDAD</label>
				</div>
				<div class="custom-control custom-radio custom-control-inline">
					<input  onclick="getRadioButon()" value="REGISTRO" type="radio" class="custom-control-input" id="REGISTRO" name="typeComprobante">
					<label class="custom-control-label" for="REGISTRO">REGISTRO</label>
				</div>
				<div class="custom-control custom-radio custom-control-inline">
					<input onclick="getRadioButon()" value="OBLIGACIÓN" type="radio" class="custom-control-input" id="OBLIGACIÓN" name="typeComprobante">
					<label class="custom-control-label" for="OBLIGACIÓN">OBLIGACIÓN</label>
				</div>
				<div class="custom-control custom-radio custom-control-inline">
					<input  onclick="getRadioButon()" value="COMPROBANTEPAGO" type="radio" class="custom-control-input" id="COMPROBANTEPAGO" name="typeComprobante">
					<label class="custom-control-label" for="COMPROBANTEPAGO">COMPROBANTE DE PAGO</label>
				</div>`)
		/* for (var i=0; i<data.VH.length; i++){
			$('#separator')
			.append(`<div class="custom-control custom-radio custom-control-inline">
			<input onclick="getRadioButon()" type="radio" class="custom-control-input" value="`+data.VH[i].name+`" id="`+data.VH[i].name+`"name="typeComprobante">
			<label class="custom-control-label" for="`+data.VH[i].name+`">`+data.VH[i].name+`</label>
			</div>`)
			} */
		}			
	});		
}
$('#dataTableTest tbody').on('click', 'tr', function () {	
	indexTable=$(this).index();
} );
$('#dataTableSelectRubro tbody').on('click', 'tr', function () {	
	indexTable=$(this).index();
} );
function getRadioButon(){

	$("#divCreate").css("display", "none");
	$("#separatorButton").css("display", "none");
	$("#divRegister").css("display", "none");
	$("#divObligation").css("display", "none");
	$("#divVoucherPayment").css("display", "none");

	$("#DetalltypeContract").css("display", "none");

	$('textarea[name="observation"]').val("");
	$('textarea[name="observationRegister"]').val("");
	$('textarea[name="observationObligation"]').val("");
	
	cantidad = 0;
	addDisponibility.length=0;
	totalOperate=0;
	totalOperateArray.length=0;
	totalDisponibility=0;
	rubrosToOperation.length=0;
	var table = $('#dataTableTest').DataTable(); 
	var rows = table.rows().remove().draw();
	table = $('#dataTableRegister').DataTable(); 
	rows = table.rows().remove().draw();
	totalDisponibility
	totalBalance
	$("#totalDisponibility").text("DISPONIBILIDAD: "+ totalOperateRegister);														
	$("#totalBalance").text("SALDO: "+ totalRegister);
	addRegister.length=0;
	totalRegister=0;
	totalOperateArrayRegister.length=0;
	totalOperateRegister=0;
	$("#totalRegister").text("SALDO: "+ totalOperateRegister);														
	$("#totalRegisterBalance").text("REGISTRO: "+ totalRegister);
	addObligation.length=0;
	totalObligation=0;
	totalOperateArrayObligation.length=0;
	totalOperateObligation=0;
	var table = $('#dataTableObligation').DataTable(); 
	var rows = table.rows().remove().draw();
	$("#totalObligation").text("SALDO: "+ totalOperateObligation);														
	$("#totalObligationBalance").text("OBLIGACIÓN: "+ totalObligation);	
	var table = $('#dataTableGetAccountsObligation').DataTable(); 
	var rows = table.rows().remove().draw();
	checkEconomicsRight="False";

	countAccountOB = 0
	$('#id_input_filter').val("")
	$('input[name=filterCheck]:checked', '#addFilter').attr('checked',false)
	var tableV = $('#dataTableVoucher').DataTable(); 
	var rowsV = tableV.rows().remove().draw();
	var tableD = $('#dataTableGetDiscounts').DataTable(); 
	var rowsD = tableD.rows().remove().draw();
	var tableAV = $('#datatableAccountToVoucher').DataTable(); 
	var rowsAV = tableAV.rows().remove().draw();
	listComprobante = []
	$("#postSelection").css("display", "none");
	$("#countingToVoucher").css("display", "none");
	totalOperateVoucher = 0
	totalVoucher = 0
	$("#totalVoucher").text("SALDO: "+ totalOperateObligation);														
	$("#totalVoucherBalance").text("COMPROBANTE DE PAGO: "+ totalObligation);	


	
	
	

	if($('input[name=typeComprobante]:checked', '#addVoucher').val()=="DISPONIBILIDAD"){
		getVoucher();
	}
	if($('input[name=typeComprobante]:checked', '#addVoucher').val()=="REGISTRO"){
		getVoucher();

	}
	if($('input[name=typeComprobante]:checked', '#addVoucher').val()=="OBLIGACIÓN"){
		getVoucher();

	}
	if($('input[name=typeComprobante]:checked', '#addVoucher').val()=="COMPROBANTEPAGO"){
		getVoucher();

	}
}
function getFilter(){

	if($('input[name=filterCheck]:checked', '#addFilter').val()=="DOCUMENT"){	
		$("#div_filter").show();
		$("#id_label_filter").text('Ingrese el documento');
	}else{
		$("#div_filter").show();
		$("#id_label_filter").text('Ingrese el nombre');
	}
}

function getThirdsOb(){
	if($("#id_input_filter").val() != ''){
		$.ajax({
				url: '{% url "thirdfilter"  0 %}'.replace('0', localStorage.getItem('userID')),
				data: {
					'idBussines': localStorage.getItem('idBussines'),
					'typefilter': $('input[name=filterCheck]:checked', '#addFilter').val(),
					'filter': $("#id_input_filter").val()
				},
				dataType: 'json',
				success: function (data) {
					console.log(data)
					var table = $('#datatableResultsFilter').DataTable(); 
					var rows = table.rows().remove().draw();
					var textValidate = ''

					for (var i=0; i<data.LB.length; i++){
						if(data.LB[i]['movement']=="OBLIGACION"){
							console.log(data.MV)
							operate = data.LB[i]['operation']
							$("#observationVoucherPayment").val(operate[0].movement__observation)
							
							for (var x=0; x< data.LB[i]['operation'].length; x++){
								const found = listComprobante.findIndex(element => element['id'] == "id"+x+""+i);
								if(found == -1){
									textValidate = "Sin Seleccionar"
								}else{
									textValidate = "Seleccionado"
								}
								
								table.row.add([
									operate[x].movement__origin__nameOrigin,
									data.LB[i].name +' '+ data.LB[i].surnames,
									data.LB[i].identification,
									data.LB[i].regiter,
									operate[x].movement__obligation,	
									operate[x].nameRubro_id,
									operate[x].rubromove,	
									operate[x].rubromove,
									operate[x].date,		
									"<a data-toggle='tooltip' type='button' title='Seleccionar'><button  onclick=\'selectObligationComprobante("+JSON.stringify("id"+x+""+i)+','+data.LB[i].regiter+','+ operate[x].movement__obligation+','+JSON.stringify(operate[x].nameRubro_id)+','+operate[x].value+','+JSON.stringify(operate[x].date)+','+JSON.stringify(data.LB[i].origen)+','+JSON.stringify(operate[x].description)+','+operate[x].rubromove+','+operate[x].Rubro_id+','+operate[x].idobligation+','+operate[x].movement+")\' class='btn btn-primary btn-sm'><i class='fa fa-check' aria-hidden='true'></i></button><label id='validateid"+x+""+i+"''>"+textValidate+"</label></a>"
								])
							}
						}
					
					}
						
					/* for (var i=0; i<data.TH.length; i++){

						table.row.add([
						data.TH[i].name,
						data.TH[i].surnames,
						data.TH[i].identification,
						data.TH[i].typeIdentification,				
						"<a data-toggle='tooltip' type='button' title='Seleccionar'><button  onclick=\'selectThirdToVoucher("+JSON.stringify(data.TH[i].id)+")\' class='btn btn-primary btn-sm'><i class='fa fa-check' aria-hidden='true'></i></button></a>"
						])
					} */
					table.draw( false );
					$('#myModalResult').modal('toggle');

				}
		});	

	}
	

}

function generateButton(){
	var nameOrigin = $('input[name=origins]:checked', '#addVoucher').val();
	var nameVoucher = $('input[name=typeComprobante]:checked', '#addVoucher').val();

	if(nameVoucher=="DISPONIBILIDAD"){
		$("#divCreate").css("display", "none");
		$("#generator").text("GENERAR DISPONIBILIDAD DE PRESUPUESTO DE "+ nameOrigin)															
		$("#separatorButton").css("display", "block");
		$.ajax({
			url: '{% url "getVoucher"  0 %}'.replace('0', localStorage.getItem('userID')),
			data: {
				'option': '3',
				'nameAC': localStorage.getItem('nameAC'),
				'idBussines': localStorage.getItem('idBussines'),
				'origin': nameOrigin
			},
			dataType: 'json',
			success: function (data) {
				originID = data.ID;
			}
		});
	}
	if(nameVoucher=="REGISTRO"){
		$("#divCreate").css("display", "none");
		$("#generator").text("GENERAR REGISTRO DE PRESUPUESTO DE "+ nameOrigin);
		$("#separatorButton").css("display", "block");
		$('#disponibilitySelectRegister').attr('disabled', false);
		$("#labelGetDisponibility").text("Disponibilidad:");	
		$.ajax({
			url: '{% url "getVoucher"  0 %}'.replace('0', localStorage.getItem('userID')),
			data: {
				'option': '3',
				'nameAC': localStorage.getItem('nameAC'),
				'idBussines': localStorage.getItem('idBussines'),
				'origin': nameOrigin
			},
			dataType: 'json',
			success: function (data) {
				originID = data.ID;
			}
		});																	
	}
	if(nameVoucher=="OBLIGACIÓN"){
		$('#registerObligation').prop('disabled', false);
		$('#terceroSelectObligation').prop('disabled', false);
		$("#buttonRegisterSelectObligation").css("display", "block");     
		$("#buttonThirdSelectObligation").css("display", "block");
		$("#labelRegisterSelectObligation").text("Registro:");
		$("#divCreate").css("display", "none");
		$("#generator").text("GENERAR OBLIGACIÓN DE PRESUPUESTO DE "+ nameOrigin);
		$("#separatorButton").css("display", "block");
		$('#registerObligation').prop('enable', 'enable');
		$('#terceroSelectObligation').prop('enable', 'enable');
		$("#buttonRegisterSelectObligation").css("display", "block");     
		$("#buttonThirdSelectObligation").css("display", "block");
		$("#labelRegisterSelectObligation").text("Registro:");
		$("#ThirdsToObligation").text("Terceros:");	
		
		var table = $('#dataTableGetAccountsObligation').DataTable(); 
 		var rows = table.rows().remove().draw();
		auxiliarAccountList = []
		accountsWithValues = []
		arrayIdAccount = []														

		$.ajax({
			url: '{% url "getVoucher"  0 %}'.replace('0', localStorage.getItem('userID')),
			data: {
				'option': '3',
				'nameAC': localStorage.getItem('nameAC'),
				'idBussines': localStorage.getItem('idBussines'),
				'origin': nameOrigin
			},
			dataType: 'json',
			success: function (data) {
				originID = data.ID;
			}
		});																	
	}
	if(nameVoucher=="COMPROBANTEPAGO"){
		$("#divCreate").css("display", "none");
		$("#generator").text("GENERAR COMPROBANTE DE PAGO DE PRESUPUESTO DE "+ nameOrigin);
		$("#separatorButton").css("display", "block");
		$.ajax({
			url: '{% url "getVoucher"  0 %}'.replace('0', localStorage.getItem('userID')),
			data: {
				'option': '3',
				'nameAC': localStorage.getItem('nameAC'),
				'idBussines': localStorage.getItem('idBussines'),
				'origin': nameOrigin
			},
			dataType: 'json',
			success: function (data) {
				originID = data.ID;
			}
		});																	
	}
	else{
		
	}	
}

function getVoucher(){
	$.ajax({
		url: '{% url "getVoucher"  0 %}'.replace('0', localStorage.getItem('userID')),
		data: {
			'option': '2',
			'nameAC': localStorage.getItem('nameAC'),
			'idBussines': localStorage.getItem('idBussines'),

		},
		dataType: 'json',
		success: function (data) {
			$("#separatorOP").empty()
			for (var i=0; i<data.OR.length; i++){
				$('#separatorOP')
				.append(`<div class="custom-control custom-radio custom-control-inline">
				<input type="radio" onclick="generateButton()" class="custom-control-input" value="`+data.OR[i].nameOrigin+`" id="`+data.OR[i].nameOrigin+`"name="origins">
				<label class="custom-control-label" for="`+data.OR[i].nameOrigin+`">`+data.OR[i].nameOrigin+`</label>
				</div>`)
				}   
			}			
		});	
}

function getRubrosByOrigin(option){
	$.ajax({
			url: '{% url "getRubrosOrigin" 0 %}'.replace('0', localStorage.getItem('userID')),
			data: {
				'bussines':localStorage.getItem('idBussines'),
				'origin': originID
			},
			dataType: 'json',
			success: function (data) {
				var table = $('#dataTableSelectRubro').DataTable(); 
 				var rows = table.rows().remove().draw();
				
				for (var i=0; i<data.RUBRO.length; i++){

				table.row.add( [
				data.RUBRO[i].id,
				data.RUBRO[i].rubro,
				data.RUBRO[i].description,
				data.RUBRO[i].initialBudget,
				data.RUBRO[i].realBudget,
				data.RUBRO[i].budgetEject,
				"<a data-toggle='tooltip' title='Seleccionar rubro'><button  id="+JSON.stringify(data.RUBRO[i].id)+" onclick=\'getRubroByDisponibilty("+JSON.stringify(data.RUBRO[i].id)+','+ JSON.stringify(data.RUBRO[i].rubro)+','+JSON.stringify(data.RUBRO[i].description)+','+JSON.stringify(data.RUBRO[i].budgetEject)+','+JSON.stringify(data.RUBRO[i].typeRubro)+','+option+")\' class='btn btn-primary btn-sm'><i class='fa fa-check' aria-hidden='true'></i></button></a>"														
				])
			}
			table.draw( false );
			}
		});
}

function validaNumericos(event) {
    if(event.charCode >= 48 && event.charCode <= 57){
      return true;
     }
     return false;        
}

function getRubroByDisponibilty(id,rubro,description,budgetEject,typeRubro,option){
	if(rubrosToOperation.includes("#balance"+id) || rubrosToOperationUpdate.includes("#balance"+id)){
		swal("Este rubro ya fue añadido", "No se puede añadir el mismo rubro", "error");
	}else{
		if(typeRubro=='A'){
			if(option == 1){
				console.log(id,rubro,description,budgetEject,typeRubro,option)
				rubrosToOperation.push("#balance"+id);	
				var table = $('#dataTableTest').DataTable(); 
				$('#myModalRubroOrigin').modal('toggle');
				table.row.add([
				id,
				rubro,
				description,
				"<input type='text'  onkeypress='return validaNumericos(event)'/   size='10'   id="+id+" class='form-control' name='inputOperations'>",
				budgetEject,
				"<label type='number' id=balance"+id+"></label>",
				"<a data-toggle='tooltip' title='Validar operación'><button  onclick='operateBalance("+id+','+JSON.stringify(rubro)+','+budgetEject+','+ JSON.stringify(description)+")' class='btn btn-primary btn-sm'><i class='fa fa-check' aria-hidden='true'></i></button></a>"+
				"<a data-toggle='tooltip' title='Eliminar rubro'><button onclick='deleteRubroSelected("+id+")' class='btn btn-primary btn-sm'><i class='fa fa-trash' aria-hidden='true'></i></button></a>"								
				]).node().id = rubro+"IDtr";
			}else{
				var table = $('#datatableRubroImplicadoDisponibility').DataTable(); 
				
				rubrosToOperationUpdate.push("#balance"+id);
				$('#myModalRubroOrigin').modal('toggle');
				table.row.add([
				rubro,
				description,
				"<input type='text'  onkeypress='return validaNumericos(event)'/   size='10'   id=Update"+id+" class='form-control' name='inputOperations'>",
				budgetEject,
				"<label type='number' id=balanceUpdate"+id+"></label>",
				"<a data-toggle='tooltip' title='Eliminar rubro'><button onclick='deleteRubroSelectedUpdate("+id+','+rubro+",this)' class='btn btn-primary btn-sm'><i class='fa fa-trash' aria-hidden='true'></i></button></a>"+								
				"<a data-toggle='tooltip' title='Validar operación'><button  onclick='operateBalanceUpdate("+id+','+rubro+','+budgetEject+','+ description+")' class='btn btn-primary btn-sm'><i class='fa fa-check' aria-hidden='true'></i></button></a>"
				
				]).node().id = rubro+"IDtr";
			}
			
			table.draw(false);
		}else{
			swal("Este rubro es mayor", "No se puede añadir", "error");
		}
	}

}

function operateBalance(id,rubro,budgetEject,description){
	
	var createId = "#"+id;
	var result= "#balance"+id
	var operate=0;
	var intBudget = parseInt(budgetEject);
	operate = budgetEject - parseInt($(createId).val());
	const found = addDisponibility.findIndex(element => element['id'] == id);
	if(found<0){

	if(operate<0){
			swal("El valor de "+ parseInt($(createId).val())+" es mayor a el valor del presupuesto actual de "+ intBudget, " No se puede realizar la disponibilidad", "error");
		}else{
			$(result).text(operate);
			addDisponibility.push({
				"id": id,
				"rubro": rubro,
				"description": description,
				"concept": "DISPONIBILIDAD",
				"value":parseInt($(createId).val()),
				"balance":operate,
				"realBudget": budgetEject
			})
			totalOperateArray.push({
				"id": id,
				"subtotal": operate,
				"disponibility":  parseInt($(createId).val())
			})
			totalOperate = totalOperate + operate;	
			totalDisponibility = totalDisponibility + parseInt($(createId).val());
			$("#totalBalance").text("SALDO: "+ totalOperate);														
			$("#totalDisponibility").text("DISPONIBILIDAD: "+ totalDisponibility);														

		}
		console.log(totalOperateArray)
		console.log(addDisponibility)
	}else{

		if(operate<0){
			swal("El valor de "+ parseInt($(createId).val())+" es mayor a el valor del presupuesto actual de "+ intBudget, " No se puede realizar la disponibilidad", "error");
		}else{
			$(result).text(operate);
			addDisponibility[found] ={
				"id": id,
				"rubro": rubro,
				"description": description,
				"concept": "DISPONIBILIDAD",
				"value":parseInt($(createId).val()),
				"balance":operate,
				"realBudget": budgetEject
			}
			totalOperate = totalOperate - totalOperateArray[found]['subtotal'];	
			totalDisponibility = totalDisponibility - totalOperateArray[found]['disponibility'];
			totalOperateArray[found] = {
				"id": id,
				"subtotal": operate,
				"disponibility":  parseInt($(createId).val())
			}
			totalOperate = totalOperate + totalOperateArray[found]['subtotal'];	
			totalDisponibility = totalDisponibility + totalOperateArray[found]['disponibility'];
			$("#totalBalance").text("PRESUPUESTO POR EJECUTAR: "+ totalOperate);														
			$("#totalDisponibility").text("VALOR: "+ totalDisponibility);														

		}
		console.log(totalOperateArray)
		console.log(addDisponibility)
	}


}

function deleteRubroSelected(id){
	
	var positionDelete;
	
	for (var i = 0; i < totalOperateArray.length; i++) {	
		if(totalOperateArray[i].id==id){
			positionDelete = i;
		}
	}

	oTable = $('#dataTableTest').DataTable();
	oTable.row(':eq('+indexTable +')').remove().draw();
	rubrosToOperation.splice(rubrosToOperation.indexOf(id), 1);
	addDisponibility.splice(addDisponibility.indexOf(id), 1);
	totalOperate = totalOperate - totalOperateArray[positionDelete].subtotal;
	totalDisponibility = totalDisponibility - totalOperateArray[positionDelete].disponibility;
	$("#totalBalance").text("SALDO: "+ totalOperate);	
	$("#totalDisponibility").text("DISPONIBILIDAD: "+ totalDisponibility);													
	totalOperateArray.splice(totalOperateArray.indexOf(id), 1);
}

$("form#createDisponibility").submit(function(e) {
	e.preventDefault()
});

function generateDisponibilty(){
	var nameVoucher = $('input[name=typeComprobante]:checked', '#addVoucher').val();
	var nameOrigin = $('input[name=origins]:checked', '#addVoucher').val();


	
	if(nameVoucher=="DISPONIBILIDAD"){
		$("#divCreate").css("display", "block");
		$("#divRegister").css("display", "none");
		$("#divObligation").css("display", "none");
		$("#divVoucherPayment").css("display", "none");
		
		var fecha = new Date(); //Fecha actual
		var mes = fecha.getMonth()+1; //obteniendo mes
		var dia = fecha.getDate(); //obteniendo dia
		var ano = fecha.getFullYear(); //obteniendo año
		if(dia<10)
			dia='0'+dia; //agrega cero si el menor de 10
		if(mes<10)
			mes='0'+mes //agrega cero si el menor de 10
		document.getElementById('date').value=ano+"-"+mes+"-"+dia;
		$.ajax({
				url: '{% url "getDisponibility" 0 %}'.replace('0', localStorage.getItem('userID')),
				data: {
					'bussines':localStorage.getItem('idBussines'),
					'origin': originID,
					'dateCreateDP': ano+"-"+mes+"-"+dia
				},
				dataType: 'json',
				success: function (data) {
					console.log(data)
					$("#divCreate").css("display", "block");
					$("#textTable").text("Lista de rubros por presupuesto de "+nameOrigin);
					$("#divTabDispoText").text("Lista de movimientos Disponibilidad del presupuesto de "+nameOrigin);
					$("#disponibilityIn").val(data.DI); 

					var table = $('#dataTableDispo').DataTable(); 
					var rows = table.rows().remove().draw();
					for (var i=0; i<data.MV.length; i++){

						table.row.add( [
						data.MV[i].disponibility,
						data.MV[i].observation,
						data.MV[i].value,
						data.MV[i].balance,
						data.MV[i].date,
						"<a data-toggle='tooltip' title='Ver detalles de disponibilidad'><button onclick='getDetall("+data.MV[i].id+")' data-toggle='modal' data-target='#myModalDetall' class='btn btn-primary btn-sm'><i class='fa fa-info-circle' aria-hidden='true'></i></button></a>"+			
						"<a data-toggle='tooltip'  id='deleteDisponibility' title='Eliminar disponibilidad'><button onclick=\'deleteDisponibility("+JSON.stringify(data.MV[i].id)+','+JSON.stringify(data.MV[i].disponibility)+")\' class='btn btn-primary btn-sm'><i class='fa fa-trash'></i></button></a>"+
						"<a data-toggle='tooltip'  id='updateDisponibility' title='Modificar disponibilidad'><button onclick=\'getRubroImplicadoDisp("+JSON.stringify(data.MV[i].id)+','+JSON.stringify(data.MV[i].disponibility)+")\' data-toggle='modal' data-target='#myModalRubroImplicado' class='btn btn-primary btn-sm'><i class='fa fa-pencil'></i></button></a>"
				
						])
					}
					table.draw( false );
							
				}
		});	
	}
	if(nameVoucher=="REGISTRO"){

		$("#divCreate").css("display", "none");
		$("#divRegister").css("display", "block");
		$("#divObligation").css("display", "none");
		$("#divVoucherPayment").css("display", "none");
		$("#textTableRubrosRegister").text("Rubros de registro de "+nameOrigin);
		$("#divTabRegisterText").text("Lista de registros realizados del presupuesto de "+nameOrigin);

		getDataToRegister();
	}
	if(nameVoucher=="OBLIGACIÓN"){

		$("#textTableRubrosObligText").text("Rubros de obligación de "+nameOrigin);
		$("#divTabObligationText").text("Lista de obligaciones realizadas del presupuesto de "+nameOrigin);

		getDataToObligation();
	}
	if(nameVoucher=="COMPROBANTEPAGO"){

		$("#divCreate").css("display", "none");
		$("#divRegister").css("display", "none");
		$("#divObligation").css("display", "none");
		$("#divVoucherPayment").css("display", "block");
		$("#div_filter").hide();
	}
														
}
//-----------------------parte de Crear Dispponibilidad para no perderce-----------
function createDisponibility(option){
	if(option==1){
		if(totalDisponibility==0){
		swal("No puede guardar una disponibilidad sin valores", "Por favor ingrese disponibilidades", "error");
		}else{
			swal({
			title: "Desea terminar la disponibilidad ?",
			text: "Al confirmar esta acción, la disponibilidad sera guardada",
			icon: "warning",
			buttons: true,
			dangerMode: true,
			}).then((willDelete) => {
			if (willDelete) {

				var disponibilityCode = $('input[name="disponibilityIn"]').val();
				var observation = $('textarea[name="observation"]').val();
				var date = $('input[name="date"]').val();
				if (disponibilityCode!='' && observation !='' && date!='') {
					// Create Ajax Call
					$.ajax({
						url: '{% url "createDisponibility"  0 %}'.replace('0', localStorage.getItem('userID')),
						data: {
							'bussines':localStorage.getItem('idBussines'), 
							'disponibilityCode': disponibilityCode,
							'origin': originID,
							'date': date,
							'observation': observation,
							'value':totalDisponibility,
							'balance': totalOperate,
							'disponibilitys': JSON.stringify(addDisponibility)
						},
						dataType: 'json',
						success: function (data) {
							$("#divCreate").css("display", "none");
							swal("Creado exitoso de la disponibilidad!", "Continua con tu proceso!", "success");
							$('textarea[name="observation"]').val("");
							addDisponibility.length=0;
							totalOperate=0;
							totalOperateArray.length=0;
							totalDisponibility=0;
							rubrosToOperation.length=0;
							var table = $('#dataTableTest').DataTable(); 
							var rows = table.rows().remove().draw();
							$("#totalBalance").text("SALDO: "+ totalOperate);	
							$("#totalDisponibility").text("DISPONIBILIDAD: "+ totalDisponibility);	
						}
					});
				} else {
					alert("Por favor llene todos los campos");
				}
				return false;
			}
			});

		}
	}else{
		if(totalDisponibility==0){
		swal("No puede guardar una disponibilidad sin valores", "Por favor ingrese disponibilidades", "error");
		}else{
			swal({
			title: "Desea terminar la disponibilidad ?",
			text: "Al confirmar esta acción, la disponibilidad sera guardada",
			icon: "warning",
			buttons: true,
			dangerMode: true,
			}).then((willDelete) => {
			if (willDelete) {

				var disponibilityCode = $('input[name="disponibilityIn"]').val();
				var observation = $('textarea[name="observation"]').val();
				var date = $('input[name="date"]').val();
				if (disponibilityCode !='' && observation!='' && date!='') {
					// Create Ajax Call
					$.ajax({
						url: '{% url "createDisponibility"  0 %}'.replace('0', localStorage.getItem('userID')),
						data: {
							'bussines':localStorage.getItem('idBussines'), 
							'disponibilityCode': disponibilityCode,
							'origin': originID,
							'date': date,
							'observation': observation,
							'value':totalDisponibility,
							'balance': totalOperate,
							'disponibilitys': JSON.stringify(addDisponibility)
						},
						dataType: 'json',
						success: function (data) {
							
							getDataToRegister();
							
							setTimeout(function(){
								$('#disponibilitySelectRegister> option[value='+data.ID+']').attr('selected', 'selected'); 
								$('#disponibilitySelectRegister').prop('disabled', 'disabled');
							}, 1000);
							
							selectDisponibiltyToRegister(JSON.stringify(data.ID));
							$("#divCreate").css("display", "none");
							swal("Creado exitoso de la disponibilidad!", "Continua con tu proceso!", "success");
							$('textarea[name="observation"]').val("");
							addDisponibility.length=0;
							totalOperate=0;
							totalOperateArray.length=0;
							totalDisponibility=0;
							rubrosToOperation.length=0;
							var table = $('#dataTableTest').DataTable(); 
							var rows = table.rows().remove().draw();

							$("#totalBalance").text("SALDO: "+ totalOperate);	
							$("#totalDisponibility").text("DISPONIBILIDAD");	
							$("#observationRegister").val(observation);
							$("#dateRegister").val(date); 
							dateValidation =  date;
							$("#buttonGetDisponibility").css("display", "none");
							$("#labelGetDisponibility").text("Disponibilidad:"+ data.DP);	
							var dateRegister = document.getElementById("dateRegister");
							dateRegister.value = date;





							$('input[name=typeComprobante]:checked', '#addVoucher').attr('checked',false)

							$('#REGISTRO', '#addVoucher').attr('checked',true)
							var nameOrigin = $('input[name=origins]:checked', '#addVoucher').val();
							$("#generator").text("GENERAR REGISTRO DE PRESUPUESTO DE "+ nameOrigin);
							$('input[name=typeComprobante]:checked', '#addVoucher').val('REGISTRO')
							$('input[name=typeComprobante]:checked', '#addVoucher').attr('checked',true)


						}
					});
				} else {
					alert("Por favor llene todos los campos");
				}
				return false;
			}
			});

		}
	}
}
function getDetall(id){
	var totalDetall=0;
	var totalDetallDisponibility=0;
	$.ajax({
			url: '{% url "getDetallsDisponibility"  0 %}'.replace('0', localStorage.getItem('userID')),
			data: {
				'disponibility':id,
			},
			dataType: 'json',
			success: function (data) {
				console.log(data);
				
				var table = $('#datatableDetalles').DataTable(); 
 				var rows = table.rows().remove().draw();
				for (var i=0; i<data.RUBRO.length; i++){

				table.row.add( [
				data.RUBRO[i].rubro,
				data.RUBRO[i].description,
				data.RUBRO[i].value,
				data.RUBRO[i].valueR,
				data.RUBRO[i].balance,
				])
				totalDetall = totalDetall + data.RUBRO[i].balance;
				totalDetallDisponibility = totalDetallDisponibility + data.RUBRO[i].value;				
			}
			table.draw( false );

			$("#totalBalanceDetail").text("POR EJECUTAR: "+ totalDetall);	
			$("#totalDisponibilityDetail").text("VALOR: "+ totalDetallDisponibility);

		}
	});
}
function deleteDisponibility(id, numero){
  
	swal({
	title: "Desea eliminar disponibilidad número " + numero + "?",
	text: "Al confirmar esta acción, la disponibilidad número " + numero + " sera eliminado.",
	icon: "warning",
	buttons: true,
	dangerMode: true,
	})
	.then((willDelete) => {
	if (willDelete) {
	
		$.ajax({
			url: '{% url "deleteAll"  0 %}'.replace('0', localStorage.getItem('userID')),
			data: {
				'origin': originID,
				'id': id,
				'option': '9'
			},
			dataType: 'json',
			success: function (data) { 
				if(data.Eliminado=='True'){
					var table = $('#dataTableDispo').DataTable(); 
					var rows = table.rows().remove().draw();
					for (var i=0; i<data.MV.length; i++){

						table.row.add( [
						data.MV[i].disponibility,
						data.MV[i].observation,
						data.MV[i].value,
						data.MV[i].balance,
						data.MV[i].date,
						"<a data-toggle='tooltip' title='Ver detalles de disponibilidad'><button onclick='getDetall("+data.MV[i].id+")' data-toggle='modal' data-target='#myModalDetall' class='btn btn-primary btn-sm'><i class='fa fa-info-circle' aria-hidden='true'></i></button></a>"+			
						"<a data-toggle='tooltip'  id='deleteDisponibility' title='Eliminar disponibilidad'><button onclick=\'deleteDisponibility("+JSON.stringify(data.MV[i].id)+','+JSON.stringify(data.MV[i].disponibility)+")\' class='btn btn-primary btn-sm'><i class='fa fa-trash'></i></button></a>"+
						"<a data-toggle='tooltip'  id='updateDisponibility' title='Modificar disponibilidad'><button onclick=\'getRubroImplicadoDisp("+JSON.stringify(data.MV[i].id)+','+JSON.stringify(data.MV[i].disponibility)+','+JSON.stringify(data.MV[i].rubroID)+','+JSON.stringify(data.MV[i].budgetEject)+")\' data-toggle='modal' data-target='#myModalRubroImplicado' class='btn btn-primary btn-sm'><i class='fa fa-pencil'></i></button></a>"
						])
					}
					table.draw( false );
					swal("La disponibilidad número " + numero + " se ha eliminado con éxito."," ","success");
				}else{
					swal("La disponibilidad número " + numero + " contiene registros."," ","error");
				}		  
			}
		});
	}
	});
}

function deleteRID(id,rubro,dispoID,disponibility,budgetEject){
	var totalDetall=0;
	var totalDetallDisponibility=0;
	swal({
	title: "Desea eliminar el rubro implicado en disponibilidad número " + rubro + "?",
	text: "Al confirmar esta acción, el rubro implicado en disponibilidad número " + rubro + " sera eliminado.",
	icon: "warning",
	buttons: true,
	dangerMode: true,
	})
	.then((willDelete) => {
	if (willDelete) {

		$.ajax({
			url: '{% url "deleteAll"  0 %}'.replace('0', localStorage.getItem('userID')),
			data: {
				'id': id,
				'origin':  originID,
				'option': '12',
				'dispoID': dispoID,
				'budgetEject': parseInt(budgetEject),
				'disponibility': parseInt(disponibility)
			},
			dataType: 'json',
			success: function (data) {
				if(data.PERMITIR == "TRUE"){
					if(data.RUBRO.length==0){
						var table = $('#dataTableDispo').DataTable(); 
						var rows = table.rows().remove().draw();
						for (var i=0; i<data.MV.length; i++){

							table.row.add( [
							data.MV[i].disponibility,
							data.MV[i].observation,
							data.MV[i].value,
							data.MV[i].balance,
							data.MV[i].date,
							"<a data-toggle='tooltip' title='Ver detalles de disponibilidad'><button onclick='getDetall("+data.MV[i].id+")' data-toggle='modal' data-target='#myModalDetall' class='btn btn-primary btn-sm'><i class='fa fa-info-circle' aria-hidden='true'></i></button></a>"+			
							"<a data-toggle='tooltip'  id='deleteDisponibility' title='Eliminar disponibilidad'><button onclick=\'deleteDisponibility("+JSON.stringify(data.MV[i].id)+','+JSON.stringify(data.MV[i].disponibility)+")\' class='btn btn-primary btn-sm'><i class='fa fa-trash'></i></button></a>"+
							"<a data-toggle='tooltip'  id='updateDisponibility' title='Modificar disponibilidad'><button onclick=\'getRubroImplicadoDisp("+JSON.stringify(data.MV[i].id)+','+JSON.stringify(data.MV[i].disponibility)+','+JSON.stringify(data.MV[i].rubroID)+','+JSON.stringify(data.MV[i].budgetEject)+")\' data-toggle='modal' data-target='#myModalRubroImplicado' class='btn btn-primary btn-sm'><i class='fa fa-pencil'></i></button></a>"
							])
						}
						table.draw( false );
						swal("El rubro implicado en disponibilidad número " + rubro + " y su disponibildad se ha eliminadon con éxito."," ","success");
						$('#myModalRubroImplicado').modal('toggle');

					}else{
						var table = $('#datatableRubroImplicadoDisponibility').DataTable(); 
						var rows = table.rows().remove().draw();
						for (var i=0; i<data.RUBRO.length; i++){

						table.row.add( [
						data.RUBRO[i].rubro,
						data.RUBRO[i].description,
						data.RUBRO[i].value,
						data.RUBRO[i].budgetEject,
						data.RUBRO[i].balance,

						"<a data-toggle='tooltip'  id='deleteRID' title='Eliminar rubro implicado en disponibilidad'><button onclick=\'deleteRID("+JSON.stringify(data.RUBRO[i].id)+','+JSON.stringify(data.RUBRO[i].rubro)+','+JSON.stringify(data.RUBRO[i].dispoID)+','+JSON.stringify(id)+','+JSON.stringify(data.RUBRO[i].budgetEject)+")\' class='btn btn-primary btn-sm'><i class='fa fa-trash'></i></button></a>"+
						"<a data-toggle='tooltip'  id='updateDisponibility' title='Actualizar rubro implicado en disponibilidad'><button onclick=\'updateRID("+JSON.stringify(data.RUBRO[i].dispoID)+','+id+','+JSON.stringify(data.RUBRO[i].id)+','+JSON.stringify(data.RUBRO[i].value)+','+JSON.stringify(data.RUBRO[i].budgetEject)+")\' class='btn btn-primary btn-sm'><i class='fa fa-pencil'></i></button></a>"
						])
						totalDetall = totalDetall + data.RUBRO[i].balance;
						totalDetallDisponibility = totalDetallDisponibility + data.RUBRO[i].value;				
					}
					table.draw( false );
					
					$("#totalBalanceRID").text("POR EJECUTAR: "+ totalDetall);	
					$("#totalDisponibilityRID").text("VALOR: "+ totalDetallDisponibility);
					swal("El rubro implicado en disponibilidad número " + rubro + "  se ha eliminado con éxito."," ","success");
					}	
				}else{
					swal({
						title: "No se puede elimninar",
						text: "El rubro implicado en disponibilidad número " + rubro + "  se encuentran registro",
						icon: "error"
					})
				}		
			}
		});
	}
	});
}

var idmovementDip;
var disponibilityidupdate;
var addDisponibilityUpdate = []
var rubrosToOperationUpdate = []
var totalOperateArrayUpdate = []
var totalDetall=0;
var totalDetallDisponibility=0;
function getRubroImplicadoDisp(id,disponibility){
	idmovementDip = id;
	disponibilityidupdate = disponibility;
	disponibilityUpdateTemporalyData=id;
	
	$.ajax({
			url: '{% url "getRubroImpDisponibility"  0 %}'.replace('0', localStorage.getItem('userID')),
			data: {
				'disponibility':id,
				'origin':  originID,
			
			},
			
			dataType: 'json',
			
			success: function (data) {
				console.log(data)

				var table = $('#datatableRubroImplicadoDisponibility').DataTable(); 
				var rows = table.rows().remove().draw();
				for (var i=0; i<data.RUBRO.length; i++){
				rubrosToOperationUpdate.push("#balance"+data.RUBRO[i].id);
				table.row.add( [
				data.RUBRO[i].rubro,
				data.RUBRO[i].description,
				"<input type='text'     size='10' value="+data.RUBRO[i].value+"  id=valueDataUpdateID"+data.RUBRO[i].id+" class='form-control'>",
				data.RUBRO[i].budgetEject,
				data.RUBRO[i].balance,

				"<a data-toggle='tooltip'  id='deleteRID' title='Eliminar rubro implicado en disponibilidad'><button onclick=\'deleteRID("+JSON.stringify(data.RUBRO[i].id)+','+JSON.stringify(data.RUBRO[i].rubro)+','+JSON.stringify(data.RUBRO[i].dispoID)+','+JSON.stringify(id)+','+JSON.stringify(data.RUBRO[i].budgetEject)+")\' class='btn btn-primary btn-sm'><i class='fa fa-trash'></i></button></a>"+
				"<a data-toggle='tooltip'  id='updateDisponibility' title='Modificar rubro implicado en disponibilidad'><button onclick=\'updateRID("+JSON.stringify(data.RUBRO[i].dispoID)+','+id+','+JSON.stringify(data.RUBRO[i].id)+','+JSON.stringify(data.RUBRO[i].value)+','+JSON.stringify(data.RUBRO[i].budgetEject)+','+disponibility+','+JSON.stringify(data.RUBRO[i].balance)+")\' class='btn btn-primary btn-sm'><i class='fa fa-pencil'></i></button></a>"
				])
				totalDetall = totalDetall + data.RUBRO[i].balance;
				totalDetallDisponibility = totalDetallDisponibility + data.RUBRO[i].value;

				$("#dateUpdate").val(data.MV[0].date); 
				$("#observationUpdate").val(data.MV[0].observation); 
				oldDateDisp= data.MV[0].date;
				oldObservationDisp = data.MV[0].observation;


			}
			table.draw( false );

			$("#totalBalanceRID").text("POR EJECUTAR: "+ totalDetall);	
			$("#totalDisponibilityRID").text("VALOR: "+ totalDetallDisponibility);

			
		}
	});
}

function operateBalanceUpdate(id,rubro,budgetEject,description){
	var createId = "#Update"+id;
	console.log(parseInt($(createId).val()))
	var result= "#balanceUpdate"+id
	var operate=0;
	var intBudget = parseInt(budgetEject);
	operate = budgetEject - parseInt($(createId).val());
	const found = addDisponibilityUpdate.findIndex(element => element['id'] == id);
	if(operate<0){
			swal("El valor de "+ parseInt($(createId).val())+" es mayor a el valor del presupuesto actual de "+ intBudget, " No se puede realizar la disponibilidad", "error");
		}else{
			$(result).text(operate);
			addDisponibilityUpdate.push({
				"id": id,
				"rubro": rubro,
				"description": description,
				"concept": "DISPONIBILIDAD",
				"value":parseInt($(createId).val()),
				"balance":operate,
				"realBudget": budgetEject
			})
			totalOperateArrayUpdate.push({
				"id": id,
				"subtotal": operate,
				"disponibility":  parseInt($(createId).val())
			})
			console.log(totalDetallDisponibility, parseInt($(createId).val()))
			totalDetall = totalDetall + operate;	
			totalDetallDisponibility = totalDetallDisponibility + parseInt($(createId).val());
			$("#totalDisponibilityRID").text("VALOR: "+ totalDetallDisponibility);														
			$("#totalBalanceRID").text("POR EJECUTAR: "+ totalDetall);														

		}
}


function deleteRubroSelectedUpdate(id,rubro,row){
	
	var table = $('#datatableRubroImplicadoDisponibility').DataTable()
	addDisponibilityUpdate.splice(addDisponibilityUpdate.findIndex(el=> el.id ==id), 1);
	var index = totalOperateArrayUpdate.findIndex(el=> el.id ==id)
	
	if($("#Update"+id).val()!='' && index!=-1){
		totalDetall = totalDetall - totalOperateArrayUpdate[index].subtotal;
		totalDetallDisponibility = totalDetallDisponibility - totalOperateArrayUpdate[index].disponibility;		
	}

	$("#totalDisponibilityRID").text("VALOR: "+ totalDetallDisponibility);														
	$("#totalBalanceRID").text("POR EJECUTAR: "+ totalDetall);	
	totalOperateArrayUpdate.splice(totalOperateArrayUpdate.findIndex(el=> el.id ==id), 1);
	rubrosToOperationUpdate.splice(rubrosToOperationUpdate.indexOf("#balance"+rubro), 1);
	table.row(row.closest('tr')).remove().draw(false);
}

function updateRID(id,disponibility,rubroID,oldValue,budgetEject,numberDisponibility,balance){
	
	var totalDetall=0;
	var totalDetallDisponibility=0;
	var newValue =  parseInt($("#valueDataUpdateID"+rubroID).val()); //ESTE ES EL VALOR nuevo
	
	var newDate = $('input[name="dateUpdate"]').val();
    var newObservation = $('textarea[name="observationUpdate"]').val();

	if(newDate >= oldDateDisp){

		if(newValue<=budgetEject){
			var newBalance = parseInt(budgetEject)-newValue;

			$.ajax({
				url: '{% url "updateRID"  0 %}'.replace('0', localStorage.getItem('userID')),
				data: {
					'id':id,
					'disponibility':disponibility,
					'sendValue':newValue,
					'oldValue' : oldValue,
					'rubro':rubroID,
					'budgetEject':budgetEject,
					'newBalance':newBalance,
					'balance':balance,
					'observation': newObservation,
					'date': newDate,
					

				},			
				dataType: 'json',				
				success: function (data) {
					console.log(data)
					if(data.OPERO == "SI"){
						getRubroImplicadoDisp(disponibility,numberDisponibility);
						generateDisponibilty();		
						swal("Modificación exitosa!", "Continua con tu proceso!", "success");
						$('#myModalRubroImplicado').modal('toggle');	
					}else{
						swal("error","La disponibilidad "+ disponibility+" contiene registros", "error");
					}
				}
			});

		}else{
			swal("El valor de "+ newValue+" no puede ser mayor al valor por ejecutar del rubro ( "+ budgetEject+")", " Por favor verifique su operación", "error");
			}

	}else{
	swal("No se puede modificar los datos la fecha nueva "+ newDate+" ya que es menor a la de disponibilidad creada ("+ oldDateDisp+")", " Por favor verifique su proceso", "error");	
	}
}

function getFinishProcessUpdateRID(){
	var newDate = $('input[name="dateUpdate"]').val();
    var newObservation = $('textarea[name="observationUpdate"]').val();
	if(newDate >= oldDateDisp){
		$.ajax({
			url: '{% url "updateRIDDetall"  0 %}'.replace('0', localStorage.getItem('userID')),
			data: {
				'id':idmovementDip,
				'bussines':localStorage.getItem('idBussines'), 
				'origin': originID,
				'disponibility':disponibilityidupdate,
				'observation': newObservation,
				'date': newDate,
				'newDate': JSON.stringify(addDisponibilityUpdate)	
				

			},			
			dataType: 'json',				
			success: function (data) {
				getRubroImplicadoDisp(idmovementDip,disponibilityidupdate);
				generateDisponibilty();	
				$('#myModalRubroImplicado').modal('toggle');
				addDisponibilityUpdate = []
				rubrosToOperationUpdate = []
				totalOperateArrayUpdate = []
				totalDetall=0;
				totalDetallDisponibility=0;	
			}
		});
	}else{
	swal("No se puede modificar los datos la fecha nueva "+ newDate+" ya que es menor a la de disponibilidad creada ("+ oldDateDisp+")", " Por favor verifique su proceso", "error");	
	}
}
 

//-----------------------parte de registro para no perderce-----------

function getDataToRegister(){
	
	$.ajax({
			url: '{% url "getDataToRegister"  0 %}'.replace('0', localStorage.getItem('userID')),
			data: {
				'bussines':localStorage.getItem('idBussines'),
				'origin': originID
			},
			dataType: 'json',
			success: function (data) {
				console.log(data.RG)
				const $select = document.querySelector("#typeContract");
				const $selectTH = document.querySelector("#terceroSelectRegister");
				const $selectTC = document.querySelector("#disponibilitySelectRegister");

				for (let i = $select.options.length; i >= 0; i--) {
						$select.remove(i);
				}
				for (let i = $selectTC.options.length; i >= 0; i--) {
						$selectTC.remove(i);
				}
				for (let i = $selectTH.options.length; i >= 0; i--) {
						$selectTH.remove(i);
				}  

				$('#disponibilitySelectRegister').append(`<option  hidden  selected"> Selecciona una opción</option>`);
				$('#terceroSelectRegister').append(`<option  hidden  selected"> Selecciona una opción</option>`);
				$('#typeContract').append(`<option  hidden  selected"> Selecciona una opción</option>`);

				for (var i=0; i<data.MV.length; i++){
					$('#disponibilitySelectRegister').append('<option value='+data.MV[i].id+'>'+data.MV[i].disponibility+'</option>')
				}
				for (var i=0; i<data.TH.length; i++){
					$('#terceroSelectRegister').append('<option value='+data.TH[i].id+'>'+data.TH[i].name + " " +data.TH[i].surnames+'</option>')
				}
				for (var i=0; i<data.TC.length; i++){
					$('#typeContract').append('<option value='+data.TC[i].id+'>'+data.TC[i].nameTC+'</option>')
				}
				$("#divRegister").css("display", "block");

				var table = $('#dataTableGetRegisters').DataTable(); 
				var rows = table.rows().remove().draw();
				for (var i=0; i<data.RG.length; i++){

					table.row.add( [
					data.RG[i].register,
					data.RG[i].observation,
					data.RG[i].value,
					data.RG[i].balance,
					data.RG[i].date,
					"<a data-toggle='tooltip' title='Ver detalles de registro'><button onclick='getDetailRegister("+data.RG[i].id+")' data-toggle='modal' data-target='#myModalDetailRegister' class='btn btn-primary btn-sm'><i class='fa fa-info-circle' aria-hidden='true'></i></button></a>"+			
					"<a data-toggle='tooltip'  type='button'  title='Eliminar registro'><button onclick=\'deleteRegister("+JSON.stringify(data.RG[i].id)+','+JSON.stringify(data.RG[i].register)+")\' class='btn btn-primary btn-sm'><i class='fa fa-trash'></i></button></a>"+
					"<a data-toggle='tooltip'  id='updateRegistro' title='Modificar registro'><button onclick=\'getRubroImplicadoRD("+JSON.stringify(data.RG[i].id)+','+JSON.stringify(data.RG[i].register)+")\' data-toggle='modal' data-target='#myModalRubroImplicadoRegister' class='btn btn-primary btn-sm'><i class='fa fa-pencil'></i></button></a>"
					
					])   
				}
				table.draw( false );

				

			}
	});
	var fecha = new Date(); //Fecha actual
	var mes = fecha.getMonth()+1; //obteniendo mes
	var dia = fecha.getDate(); //obteniendo dia
	var ano = fecha.getFullYear(); //obteniendo año
	if(dia<10)
		dia='0'+dia; //agrega cero si el menor de 10
	if(mes<10)
		mes='0'+mes //agrega cero si el menor de 10
	document.getElementById('dateRegister').value=ano+"-"+mes+"-"+dia;
	$.ajax({
			url: '{% url "getRegisterSerial"  0 %}'.replace('0', localStorage.getItem('userID')),
			data: {
				'bussines':localStorage.getItem('idBussines'),
				'origin': originID,
				'dateCreateDP': ano+"-"+mes+"-"+dia
			},
			dataType: 'json',
			success: function (data) {
				$("#registerNumber").val(data.RE); 

			}
	});
}
function getDetailRegister(id){
	var totalDetailR=0;
	var totalDetailRegister=0;
	$.ajax({
			url: '{% url "getDetailRegister"  0 %}'.replace('0', localStorage.getItem('userID')),
			data: {
				'register':id,
			},
			dataType: 'json',
			success: function (data) {
				console.log(data	)
				$('#DetallRegister')
				.append(` `+data.Third[0]['third__name'] + ` ` + data.Third[0]['third__surnames'])
				var table = $('#datatableDetailRegister').DataTable(); 
 				var rows = table.rows().remove().draw();
				for (var i=0; i<data.DRG.length; i++){

				table.row.add( [

				data.DRG[i].rubro,
				data.DRG[i].description,
				data.DRG[i].value,
				data.DRG[i].budgetEject,
				data.DRG[i].balance,
				
				])
				totalDetailR = totalDetailR + data.DRG[i].balance;
				totalDetailRegister = totalDetailRegister + data.DRG[i].value;				
			}
			table.draw( false );

			$("#totalDetailRegister").text("SALDO: "+ totalDetailR);	
			$("#totalBalanceDetailRegister").text("REGISTRO: "+ totalDetailRegister);

		}
	});
}
function deleteRegister(id, numero){
  
	swal({
	title: "Desea eliminar el registro con número " + numero + "?",
	text: "Al confirmar esta acción, el registro con número " + numero + " sera eliminado.",
	icon: "warning",
	buttons: true,
	dangerMode: true,
	})
	.then((willDelete) => {
	if (willDelete) {
	
		$.ajax({
			url: '{% url "deleteAll"  0 %}'.replace('0', localStorage.getItem('userID')),
			data: {
				'origin': originID,
				'id': id,
				'option': '10'
			},
			dataType: 'json',
			success: function (data) { 
				console.log(data)
				if(data.Eliminado=='True'){

					var table = $('#dataTableGetRegisters').DataTable(); 
					var rows = table.rows().remove().draw();
					for (var i=0; i<data.RG.length; i++){

						table.row.add( [
						data.RG[i].register,
						data.RG[i].observation,
						data.RG[i].value,
						data.RG[i].balance,
						data.RG[i].date,
						"<a data-toggle='tooltip' title='Ver detalles de registro'><button onclick='getDetailRegister("+data.RG[i].id+")' data-toggle='modal' data-target='#myModalDetailRegister' class='btn btn-primary btn-sm'><i class='fa fa-info-circle' aria-hidden='true'></i></button></a>"+			
						"<a data-toggle='tooltip'  type='button'  title='Eliminar registro'><button onclick=\'deleteRegister("+JSON.stringify(data.RG[i].id)+','+JSON.stringify(data.RG[i].register)+")\' class='btn btn-primary btn-sm'><i class='fa fa-trash'></i></button></a>"+
						"<a data-toggle='tooltip'  id='updateRegistro' title='Modificar registro'><button onclick=\'getRubroImplicadoRD("+JSON.stringify(data.RG[i].id)+','+JSON.stringify(data.RG[i].register)+")\' data-toggle='modal' data-target='#myModalRubroImplicadoRegister' class='btn btn-primary btn-sm'><i class='fa fa-pencil'></i></button></a>"
						])
					}
					table.draw( false );
					swal("El registro con número " + numero + " se ha eliminado con éxito."," ","success");
				}else{
					swal("El registro con número " + numero + " contiene obligaciones."," ","error");
				}		  
			}
		});
	}
	});
}

function getRubroImplicadoRD(id,register){

	var totalDetailReg=0;
	var totalDetailRegister=0;

	$.ajax({
			url: '{% url "getRubroImpDetailRegister"  0 %}'.replace('0', localStorage.getItem('userID')),
			data: {
				'register':id,
				'bussines':localStorage.getItem('idBussines'),
				'origin': originID,

			},
			
			dataType: 'json',	
			success: function (data) {
				console.log(data)
				const $selectTC = document.querySelector("#typeContractUpdate");
				const $selectTH = document.querySelector("#terceroSelectRegisterUpdate");
				const $selectTCD = document.querySelector("#selectDetalltypeContractUpdate");
				
				for (let i = $selectTC.options.length; i >= 0; i--) {
						$selectTC.remove(i);
				}
				for (let i = $selectTH.options.length; i >= 0; i--) {
						$selectTH.remove(i);
				} 
				
				for (let i = $selectTCD.options.length; i >= 0; i--) {
						$selectTCD.remove(i);
				}  

				$('#terceroSelectRegisterUpdate').append(`<option  hidden  selected"> Selecciona una opción</option>`);				
				$('#typeContractUpdate').append(`<option  hidden  selected"> Selecciona una opción</option>`);

				$('#selectDetalltypeContractUpdate').append(`<option  hidden  selected"> Selecciona una opción</option>`);

				for (var i=0; i<data.TH.length; i++){
					$('#terceroSelectRegisterUpdate').append('<option value='+data.TH[i].id+'>'+data.TH[i].name + " " +data.TH[i].surnames+'</option>')
				}
				for (var i=0; i<data.TC.length; i++){
					$('#typeContractUpdate').append('<option value='+data.TC[i].id+'>'+data.TC[i].nameTC+'</option>')
				}

				for (var i=0; i<data.TCD.length; i++){
					$('#selectDetalltypeContractUpdate').append('<option value='+data.TCD[i].id+'>'+data.TCD[i].digitstc+' '+data.TCD[i].value+'</option>')
				}


				$('#idMovementTC').val(data.STC[0]['id'])
				$('#MovementTC').val(data.RG[0]['id'])
				$('#typeContractUpdate').val(data.STC[0]['typeContractdetail__id'])
				$('#terceroSelectRegisterUpdate').val(data.STH[0]['third_id'])
				$('#selectDetalltypeContractUpdate').val(data.STC[0]['typeContractdetail__id'])

				var table = $('#datatableRubroImplicadoRegister').DataTable(); 
 				var rows = table.rows().remove().draw();
				for (var i=0; i<data.DRG.length; i++){

				table.row.add([
				data.DRG[i].rubro,
				data.DRG[i].description, 
				"<label type='number' id=valueDisponibilityUpdateDR"+data.DRG[i].id+">"+ JSON.stringify(data.DRG[i].value)+"</label>",
				"<input type='text'  onkeypress='return validaNumericos(event)'/   size='10' value="+data.DRG[i].budgetEject+"  id=valueRegisterUpdateDR"+data.DRG[i].id+" class='form-control'>",
				"<label type='number' id=valueBalanceUpdateDR"+data.DRG[i].id+">"+ JSON.stringify(data.DRG[i].balance)+"</label>",
				
				"<a data-toggle='tooltip'  id='deleteDetailRegister' title='Eliminar rubro implicado en registro'><button onclick=\'deleteDR("+JSON.stringify(data.DRG[i].registerID)+','+id+','+JSON.stringify(data.DRG[i].rubro)+','+register+")\' class='btn btn-primary btn-sm'><i class='fa fa-trash'></i></button></a>"+
				"<a data-toggle='tooltip'  id='updateDatailRegister' title='Modificar rubro implicado en registro'><button onclick=\'updateDetailRegister("+JSON.stringify(data.DRG[i].registerID)+','+id+','+JSON.stringify(data.DRG[i].id)+','+JSON.stringify(data.DRG[i].value)+','+JSON.stringify(data.DRG[i].budgetEject)+','+register+','+JSON.stringify(data.DRG[i].balance)+")\' class='btn btn-primary btn-sm'><i class='fa fa-pencil'></i></button></a>"
				])
				totalDetailReg = totalDetailReg + data.DRG[i].balance;
				totalDetailRegister = totalDetailRegister + data.DRG[i].budgetEject;

				$("#dateUpdateRegister").val(data.RG[i].date); 
				$("#observationUpdateRegister").val(data.RG[i].observation);
				oldDateRegister = data.RG[i].date;
				oldObservationRegister = data.RG[i].observation;
				

			}
			table.draw( false );

			$("#totalBalanceDR").text("SALDO: "+ totalDetailReg);	
			$("#totalRegisterDR").text("REGISTRO: "+ totalDetailRegister);
			valueRegisterFromValidation = totalDetailRegister;
			
		}

	});
}



function deleteDR(id,registerID,rubro,register){
	var totalDetailReg=0;
	var totalDetailRegister=0;
	swal({
	title: "Desea eliminar el rubro " + rubro + "implicado en el registro número " + register + "?",
	text: "Al confirmar esta acción, el rubro implicado en el registro número " + register + " sera eliminado.",
	icon: "warning",
	buttons: true,
	dangerMode: true,
	})
	.then((willDelete) => {
	if (willDelete) {

		$.ajax({
			url: '{% url "deleteAll"  0 %}'.replace('0', localStorage.getItem('userID')),
			data: {
				'id': id,
				'option': '16',
				'registerID': registerID,
				'origin': originID,
				'register': register
			},
			dataType: 'json',
			success: function (data) {
				if(data.DRG.length==0){
					var table = $('#dataTableGetRegisters').DataTable(); 
					var rows = table.rows().remove().draw();
					for (var i=0; i<data.RG.length; i++){

						table.row.add( [
						data.RG[i].register,
						data.RG[i].observation,
						data.RG[i].value,
						data.RG[i].balance,
						data.RG[i].date,
						"<a data-toggle='tooltip' title='Ver detalles de registro'><button onclick='getDetailRegister("+data.RG[i].id+")' data-toggle='modal' data-target='#myModalDetailRegister' class='btn btn-primary btn-sm'><i class='fa fa-info-circle' aria-hidden='true'></i></button></a>"+			
						"<a data-toggle='tooltip'  type='button'  title='Eliminar registro'><button onclick=\'deleteRegister("+JSON.stringify(data.RG[i].id)+','+JSON.stringify(data.RG[i].register)+")\' class='btn btn-primary btn-sm'><i class='fa fa-trash'></i></button></a>"+
						"<a data-toggle='tooltip'  id='updateRegistro' title='Modificar registro'><button onclick=\'getRubroImplicadoRD("+JSON.stringify(data.RG[i].id)+','+JSON.stringify(data.RG[i].register)+")\' data-toggle='modal' data-target='#myModalRubroImplicadoRegister' class='btn btn-primary btn-sm'><i class='fa fa-pencil'></i></button></a>"					
						])   
					}
					table.draw( false );
					swal("El rubro implicado en el registro número " + register + " y su registro se ha eliminado con éxito."," Continua con tu proceso ","success");
					$('#myModalRubroImplicadoRegister').modal('toggle');

				}else{
					var table = $('#datatableRubroImplicadoRegister').DataTable(); 
					var rows = table.rows().remove().draw();
					for (var i=0; i<data.DRG.length; i++){

					table.row.add( [
					data.DRG[i].rubro,
					data.DRG[i].description,
					data.DRG[i].value,
					data.DRG[i].budgetEject,
					data.DRG[i].balance,

					"<a data-toggle='tooltip'  id='deleteDetailRegister' title='Eliminar rubro implicado en registro'><button onclick=\'deleteDR("+JSON.stringify(data.DRG[i].registerID)+','+register+','+JSON.stringify(data.DRG[i].rubro)+','+register+")\' class='btn btn-primary btn-sm'><i class='fa fa-trash'></i></button></a>"+
					"<a data-toggle='tooltip'  id='updateDatailRegister' title='Modificar rubro implicado en registro'><button onclick=\'updateDetailRegister("+JSON.stringify(data.DRG[i].registerID)+','+id+','+JSON.stringify(data.DRG[i].id)+','+JSON.stringify(data.DRG[i].value)+','+JSON.stringify(data.DRG[i].budgetEject)+','+register+','+JSON.stringify(data.DRG[i].balance)+")\' class='btn btn-primary btn-sm'><i class='fa fa-pencil'></i></button></a>"
					])
					totalDetailReg = totalDetailReg + data.DRG[i].balance;
					totalDetailRegister = totalDetailRegister + data.DRG[i].value;				
				}
				table.draw( false );

				$("#totalBalanceDR").text("SALDO: "+ totalDetailReg);	
				$("#totalRegisterDR").text("REGISTRO: "+ totalDetailRegister);
				
				swal("El rubro implicado en el registro número " + register + "  se ha eliminado con éxito."," ","success");
				}				
			}
		});
	}
	});
}

function updateDetailRegister(id,register,rubroID,disponibility,oldValue,numberRegister,balance){

	var totalDetailReg=0;
	var totalDetailRegister=0;
	var oldValue;
	var disponibilityChange =   parseInt($("#valueDisponibilityUpdateDR"+rubroID).text()); 
	var registerChange =   parseInt($("#valueRegisterUpdateDR"+rubroID).val()); //ESTE ES EL VALOR nuevo
	var balanceChange =  disponibilityChange-registerChange; 
	
	var newDateRegister = $('input[name="dateUpdateRegister"]').val();
    var newObservationRegister = $('textarea[name="observationUpdateRegister"]').val();

	var contractualInformation = $("#typeContractUpdate").val();
	var typeContract = $("#selectDetalltypeContractUpdate").val();
	if(newDateRegister >= oldDateRegister){	
			
		if(registerChange<=disponibility){

			console.log(contractualInformation,typeContract)
			
			$.ajax({
					url: '{% url "updateDetailRegister"  0 %}'.replace('0', localStorage.getItem('userID')),
					data: {
						'bussines':localStorage.getItem('idBussines'),
						'id':id,
						'register':register,
						'sendValue':registerChange,
						'balanceChange': balanceChange,
						'oldValue': oldValue,
						'balance':balance,
						'date': newDateRegister,
						'observation': newObservationRegister,
						
					},
					
					dataType: 'json',
					
					success: function (data) {

						getRubroImplicadoRD(register,numberRegister);
						generateDisponibilty();
						swal("Modificación exitosa!", "Continua con tu proceso!", "success");
						$('#myModalRubroImplicadoRegister').modal('toggle');
					}
					
			});

		}else{
			swal("El valor de registro "+ registerChange+" no puede ser mayor al valor de la disponibilidad "+ disponibilityChange, " Por favor verifique su operación", "error");
			
		}
	}else{
		
		$('#dateUpdateRegister').val(oldDateRegister)
		swal("No se puede modificar los datos la fecha nueva para el registro "+ newDateRegister+" es menor a la de disponibilidad creada ("+ oldDateRegister+")", " Por favor verifique su proceso", "error");
	}
	
}
//-----------parte de obligación-----------
function getDataToObligation(){

	$("#divCreate").css("display", "none");
	$("#divRegister").css("display", "none");
	$("#divObligation").css("display", "block");
	$("#divVoucherPayment").css("display", "none");

	$.ajax({
			url: '{% url "getDataToObligation"  0 %}'.replace('0', localStorage.getItem('userID')),
			data: {
				'bussines':localStorage.getItem('idBussines'),
				'origin': originID
			},
			dataType: 'json',
			success: function (data) {
				const $selectTH = document.querySelector("#terceroSelectObligation");
				const $select = document.querySelector("#registerObligation");
				for (let i = $select.options.length; i >= 0; i--) {
						$select.remove(i);
				}
				for (let i = $selectTH.options.length; i >= 0; i--) {
						$selectTH.remove(i);
				}  
				$('#terceroSelectObligation').append(`<option  hidden  selected"> Selecciona una opción</option>`);
				$('#registerObligation').append(`<option  hidden  selected"> Selecciona una opción</option>`);	
				for (var i=0; i<data.MV.length; i++){
					$('#registerObligation').append('<option value='+data.MV[i].id+'>'+data.MV[i].register+'</option>')
				}
				for (var i=0; i<data.TH.length; i++){
					$('#terceroSelectObligation').append('<option value='+data.TH[i].id+'>'+data.TH[i].name + " " +data.TH[i].surnames+'</option>')
				}

				var table = $('#dataTableGetObligation').DataTable(); 
				var rows = table.rows().remove().draw();
				for (var i=0; i<data.OB.length; i++){

					table.row.add( [
					data.OB[i].obligation,
					data.OB[i].observation,
					data.OB[i].value,
					data.OB[i].balance,
					data.OB[i].date,
					
					"<a data-toggle='tooltip' title='Ver detalles de obligación'><button onclick='getDetailObligation("+data.OB[i].id+")' data-toggle='modal' data-target='#myModalDetailObligation' class='btn btn-primary btn-sm'><i class='fa fa-info-circle' aria-hidden='true'></i></button></a>"+			
					"<a data-toggle='tooltip' type='button' title='Eliminar obligación'><button onclick=\'deleteObligation("+JSON.stringify(data.OB[i].id)+','+JSON.stringify(data.OB[i].obligation)+")\' class='btn btn-primary btn-sm'><i class='fa fa-trash'></i></button></a>"+
					"<a data-toggle='tooltip'  id='updateObligation' title='Modificar obligación'><button onclick=\'getRubroImplicadoObligation("+JSON.stringify(data.OB[i].id)+','+JSON.stringify(data.OB[i].obligation)+")\' data-toggle='modal' data-target='#myModalRubroImplicadoObligation' class='btn btn-primary btn-sm'><i class='fa fa-pencil'></i></button></a>"
					])
				}
				table.draw( false );
			}
	});
	var fecha = new Date(); //Fecha actual
	var mes = fecha.getMonth()+1; //obteniendo mes
	var dia = fecha.getDate(); //obteniendo dia
	var ano = fecha.getFullYear(); //obteniendo año
	if(dia<10)
		dia='0'+dia; //agrega cero si el menor de 10
	if(mes<10)
		mes='0'+mes //agrega cero si el menor de 10
	document.getElementById('dateObligation').value=ano+"-"+mes+"-"+dia;
	$.ajax({
			url: '{% url "getObligationSerial"  0 %}'.replace('0', localStorage.getItem('userID')),
			data: {
				'bussines':localStorage.getItem('idBussines'),
				'origin': originID,
				'dateCreateDP':ano+"-"+mes+"-"+dia
			},
			dataType: 'json',
			success: function (data) {
				$("#numberObligation").val(data.OB); 

			}
	});
}
function getDetailObligation(id){
	var totalDetailOblig=0;
	var totalDetailObligation=0;
	$.ajax({
			url: '{% url "getDetailObligation"  0 %}'.replace('0', localStorage.getItem('userID')),
			data: {
				'obligation':id,
			},
			dataType: 'json',
			success: function (data) {

				console.log(data,"obli")
				$('#DetallObligation')
				.append(``+data.Thrid[0]['third__name']+` `+data.Thrid[0]['third__surnames']+``) 

				
				var table = $('#datatableDetailObligation').DataTable(); 
 				var rows = table.rows().remove().draw();
				for (var i=0; i<data.OB.length; i++){

				table.row.add( [

				data.OB[i].rubro,
				data.OB[i].description,
				data.OB[i].value,
				data.OB[i].valueP,
				(data.OB[i].value - data.OB[i].valueP),
				"<a data-toggle='tooltip' title='Ver cuentas'><button onclick='getAccountObli("+data.OB[i].idMov+")' class='btn btn-primary btn-sm'><i class='fa fa-info-circle' aria-hidden='true'></i></button></a>"	
				
				])
				totalDetailOblig = totalDetailOblig + data.OB[i].balance;
				totalDetailObligation = totalDetailObligation + data.OB[i].value;				
			}
			table.draw( false );

			$("#totalDetailObligation").text("SALDO: "+ totalDetailOblig);	
			$("#totalBalanceDetailObligation").text("OBLIGACIÓN: "+ totalDetailObligation);

		}
	});
}  

function getAccountObli(id){
	totalD = 0
	TotalC = 0
	if(document.getElementById('detailAccount').style.display == 'none'){
		
		$('#detailAccount').css('display','block')

	}else{
		$('#detailAccount').css('display','none')

	}
	$.ajax({
			url: '{% url "getDetailAccountObligation"  0 %}'.replace('0', localStorage.getItem('userID')),
			data: {
				'id': id,
			},
			dataType: 'json',
			success: function (data) { 
				console.log(data,"dartos")
				var table = $('#datatableDetailAccountObligation	').DataTable(); 
 				var rows = table.rows().remove().draw();
				for (var i=0; i<data.AO.length; i++){

					table.row.add( [

						data.AO[i].account__account__code,
						data.AO[i].account__account__description,
						data.AO[i].typeAccount,
						data.AO[i].value,
					])

					if(data.AO[i].typeAccount == "Debito"){
						totalD += data.AO[i].value
					}else{
						TotalC += data.AO[i].value
					}
				}

				$('#totalBalanceDetailDebitoObligation').text('Total Debito:' + totalD)


				$('#totalBalanceDetailCreditoObligation').text('Total Credito:' + TotalC)



				table.draw()
			}
			
		})



	
}
function deleteObligation(id, numero){
  
	swal({
	title: "Desea eliminar la obligación con número " + numero + "?",
	text: "Al confirmar esta acción, la obligación con número " + numero + " sera eliminado.",
	icon: "warning",
	buttons: true,
	dangerMode: true,
	})
	.then((willDelete) => {
	if (willDelete) {
	
		$.ajax({
			url: '{% url "deleteAll"  0 %}'.replace('0', localStorage.getItem('userID')),
			data: {
				'origin': originID,
				'id': id,
				'option': '11'
			},
			dataType: 'json',
			success: function (data) { 
				if(data.Eliminado=='True'){

					var table = $('#dataTableGetObligation').DataTable(); 
					var rows = table.rows().remove().draw();
					for (var i=0; i<data.OB.length; i++){

						table.row.add( [
						data.OB[i].obligation,
						data.OB[i].observation,
						data.OB[i].value,
						data.OB[i].balance,
						data.OB[i].date,
						"<a data-toggle='tooltip' title='Ver detalles de obligación'><button onclick='getDetailObligation("+data.OB[i].id+")' data-toggle='modal' data-target='#myModalDetailObligation' class='btn btn-primary btn-sm'><i class='fa fa-info-circle' aria-hidden='true'></i></button></a>"+			
						"<a data-toggle='tooltip' type='button' title='Eliminar obligación'><button onclick=\'deleteObligation("+JSON.stringify(data.OB[i].id)+','+JSON.stringify(data.OB[i].obligation)+")\' class='btn btn-primary btn-sm'><i class='fa fa-trash'></i></button></a>"+
						"<a data-toggle='tooltip'  id='updateObligation' title='Modificar obligación'><button onclick=\'getRubroImplicadoObligation("+JSON.stringify(data.OB[i].id)+','+JSON.stringify(data.OB[i].obligation)+")\' data-toggle='modal' data-target='#myModalRubroImplicadoObligation' class='btn btn-primary btn-sm'><i class='fa fa-pencil'></i></button></a>"
						])
					}
					table.draw( false );
					swal("La obligación con número " + numero + " se ha eliminado con éxito."," ","success");
				}else{
					swal("La obligación con número " + numero + " contiene comprobante de pagos."," ","error");
				}		  
			}
		});
	}
	});
}

function getRubroImplicadoObligation(id,obligation){
	var totalDetailOblig=0;
	var totalDetailObligation=0;
	$.ajax({
			url: '{% url "getRubroImpDetailObligation"  0 %}'.replace('0', localStorage.getItem('userID')),
			data: {
				'bussines': localStorage.getItem('idBussines'),
				'obligation':id,
			},
			
			dataType: 'json',
			
			success: function (data) {
				const $select = document.querySelector("#terceroSelectUpdateObligation");
				for (let i = $select.options.length; i >= 0; i--) {
						$select.remove(i);
				}
				oldDateObligation= data.OBM[0]['date']
				$('#terceroSelectUpdateObligation').append(`<option  hidden  selected"> Selecciona una opción</option>`);
				for (var i=0; i<data.TH.length; i++){
					$('#terceroSelectUpdateObligation').append('<option value='+data.TH[i].id+'>'+data.TH[i].name+' '+data.TH[i].surnames+'</option>')
				}
				$('#terceroSelectUpdateObligation').val(data.STH[0]['third_id'])
				$('#dateUpdateObligation').val(data.OBM[0]['date'])
				$('#MovementOB').val(id)
				$('#observationUpdateObligation').val(data.OBM[0]['observation'])
				var table = $('#datatableRubroImplicadoObligation').DataTable(); 
 				var rows = table.rows().remove().draw();
				for (var i=0; i<data.OB.length; i++){

				table.row.add( [
				data.OB[i].rubro,
				data.OB[i].description,			
				"<label type='number' id=valueDisponibilityUpdateDOblig"+data.OB[i].id+">"+ JSON.stringify(data.OB[i].value)+"</label>",
				"<input type='text'  onkeypress='return validaNumericos(event)'/   size='10' value="+data.OB[i].budgetEject+"  id=valueRegisterUpdateDOblig"+data.OB[i].id+" class='form-control'>",
				"<label type='number' id=valueBalanceUpdateDOblig"+data.OB[i].id+">"+ JSON.stringify(data.OB[i].balance)+"</label>",

				"<a data-toggle='tooltip'  id='deleteDetailObligation' title='Eliminar rubro implicado en obligación'><button onclick=\'DeleteRIDO("+JSON.stringify(data.OB[i].idObligation)+','+id+','+JSON.stringify(data.OB[i].rubro)+','+obligation+")\' class='btn btn-primary btn-sm'><i class='fa fa-trash'></i></button></a>"+
				"<a data-toggle='tooltip'  id='updateDatailObligation' title='Modificar rubro implicado en obligación'><button onclick=\'updateDetailObligation("+JSON.stringify(data.OB[i].idObligation)+','+id+','+JSON.stringify(data.OB[i].id)+','+JSON.stringify(data.OB[i].value)+','+JSON.stringify(data.OB[i].budgetEject)+','+obligation+','+JSON.stringify(data.OB[i].balance)+")\' class='btn btn-primary btn-sm'><i class='fa fa-pencil'></i></button></a>"
				])
				totalDetailOblig = totalDetailOblig + data.OB[i].balance;
				totalDetailObligation = totalDetailObligation + data.OB[i].budgetEject;
							
			}
			table.draw( false );

			$("#totalBalanceObligation").text("SALDO: "+ totalDetailOblig);	
			$("#totalObligationImp").text("OBLIGACIÓN: "+ totalDetailObligation);

		}
	});
} 
function DeleteRIDO(id,obligationID,rubro,obligation){
	var totalDetailOblig=0;
	var totalDetailObligation=0;
	swal({
	title: "Desea eliminar el rubro " + rubro + "implicado en la obligación número " + obligation + "?",
	text: "Al confirmar esta acción, el rubro implicado en la obligación con número " + obligation + " sera eliminado.",
	icon: "warning",
	buttons: true,
	dangerMode: true,
	})
	.then((willDelete) => {
	if (willDelete) {
	
		$.ajax({
			url: '{% url "deleteAll"  0 %}'.replace('0', localStorage.getItem('userID')),
			data: {
				'id': id,
				'option': '17',
				'obligationID': obligationID,
				'origin': originID,
				'obligation': obligation
			},
			dataType: 'json',
			success: function (data) { 

				if(data.OB.length==0){

					var table = $('#dataTableGetObligation').DataTable(); 
					var rows = table.rows().remove().draw();
					for (var i=0; i<data.MV.length; i++){

						table.row.add( [
						data.MV[i].obligation,
						data.MV[i].observation,
						data.MV[i].value,
						data.MV[i].balance,
						data.MV[i].date,
						
						"<a data-toggle='tooltip' title='Ver detalles de obligación'><button onclick='getDetailObligation("+data.MV[i].id+")' data-toggle='modal' data-target='#myModalDetailObligation' class='btn btn-primary btn-sm'><i class='fa fa-info-circle' aria-hidden='true'></i></button></a>"+			
						"<a data-toggle='tooltip' type='button' title='Eliminar obligación'><button onclick=\'deleteObligation("+JSON.stringify(data.MV[i].id)+','+JSON.stringify(data.MV[i].obligation)+")\' class='btn btn-primary btn-sm'><i class='fa fa-trash'></i></button></a>"+
						"<a data-toggle='tooltip'  id='updateObligation' title='Modificar obligación'><button onclick=\'getRubroImplicadoObligation("+JSON.stringify(data.MV[i].id)+','+JSON.stringify(data.MV[i].obligation)+")\' data-toggle='modal' data-target='#myModalRubroImplicadoObligation' class='btn btn-primary btn-sm'><i class='fa fa-pencil'></i></button></a>"
						])
					}
					table.draw( false );
					swal("El rubro implicado en la obligación número " + register + " y su obligacion se ha eliminado con éxito."," Continua con tu proceso ","success");

	
				}else{
					
					var table = $('#datatableRubroImplicadoObligation').DataTable(); 
					var rows = table.rows().remove().draw();
					for (var i=0; i<data.OB.length; i++){

						table.row.add( [
						data.OB[i].rubro,
						data.OB[i].description,
						"<input type='text'  onkeypress='return validaNumericos(event)'/   size='10' value="+data.OB[i].value+"  id=valueDataUpdateOblig"+data.OB[i].id+" class='form-control'>",
						data.OB[i].budgetEject,
						data.OB[i].balance,

						"<a data-toggle='tooltip'  id='deleteDetailObligation' title='Eliminar rubro implicado en obligación'><button onclick=\'DeleteRIDO("+JSON.stringify(data.OB[i].idObligation)+','+id+','+JSON.stringify(data.OB[i].rubro)+','+obligation+")\' class='btn btn-primary btn-sm'><i class='fa fa-trash'></i></button></a>"+
						"<a data-toggle='tooltip'  id='updateDatailObligation' title='Modificar rubro implicado en obligación'><button onclick=\'updateDetailObligation("+JSON.stringify(data.OB[i].idObligation)+','+id+','+JSON.stringify(data.OB[i].id)+','+JSON.stringify(data.OB[i].value)+','+JSON.stringify(data.OB[i].budgetEject)+','+obligation+','+JSON.stringify(data.OB[i].balance)+")\' class='btn btn-primary btn-sm'><i class='fa fa-pencil'></i></button></a>"
						])
						totalDetailOblig = totalDetailOblig + data.OB[i].balance;
						totalDetailObligation = totalDetailObligation + data.OB[i].value;				
					}
					table.draw( false );
					 
					$("#totalBalanceObligation").text("SALDO: "+ totalDetailOblig);	
					$("#totalObligationImp").text("OBLIGACIÓN: "+ totalDetailObligation);
					swal("El rubro implicado en la obligacion número " + register + "  se ha eliminado con éxito."," ","success");

				}

		  
			}
		});
	}
	});
}

function updateDetailObligation(id,obligation,rubroID,register,oldValue,numberOblig,balance){

	var totalDetailOblig=0;
	var totalDetailObligation=0;
	var oldValue;

	var registerChange =   parseInt($("#valueDisponibilityUpdateDOblig"+rubroID).text()); 
	var obligationChangee = parseInt($("#valueRegisterUpdateDOblig"+rubroID).val())
	var balanceChange =  registerChange-obligationChangee; 


	if(registerChange<=register){
		$.ajax({
			url: '{% url "updateDetailObligation"  0 %}'.replace('0', localStorage.getItem('userID')),
			data: {
				'id':id,
				'obligation':obligation,
				'sendValue':obligationChangee, 
				'newBalance': balanceChange,
				'oldValue': oldValue,
				'balance':balance,
			},
				
			dataType: 'json',				
			success: function (data) {
				getRubroImplicadoDisp(obligation,numberOblig);
				generateDisponibilty();
				console.log("entro")
			}
		});
	}else{
		swal("El valor de obligación "+ newValueObligationChange+" no puede ser mayor al valor de la disponibilidad "+ disponibilityChange, " Por favor verifique su operación", "error");
	}	
}

function cancels(option){
	if(option==1){
		$('#myModalCreateThird').modal('toggle');
		$('#myModalThirds').modal('toggle');
	}
	if(option==2){
		
		swal({
			title: "Desea cancelar por completo la disponibilidad?",
			text: "No se guardara ningun valor agregado.",
			icon: "warning",
			buttons: true,
			dangerMode: true,
			})
			.then((willDelete) => {
			if (willDelete) {
				$("#divCreate").css("display", "none");
				$("#divAgreement").css("display", "none");
				var tableRubros = $('#dataTableTest').DataTable(); 
				var rowsRubros = tableRubros.rows().remove().draw();
				$("#rubroContraOperations").css('display', 'none');		
				$('textarea[name="observation"]').val("");
				rubrosToOperation.length = 0;
				totalOperateArray.length =0;
				addDisponibility.length =0;
				totalDisponibility = 0;
				totalOperate = 0;
				$("#totalBalance").text("SALDO: "+ totalOperate);														
				$("#totalDisponibility").text("DISPONIBILIDAD: "+ totalDisponibility);	

			}
		});
	}if(option==3){
		swal({
			title: "Desea cancelar por completo el registro?",
			text: "No se guardara ningun valor agregado.",
			icon: "warning",
			buttons: true,
			dangerMode: true,
			})
			.then((willDelete) => {
			if (willDelete) {
				$("#divRegister").css("display", "none");
				$('textarea[name="observationRegister"]').val("");
				addRegister.length=0;
				totalRegister=0;
				totalOperateArrayRegister.length=0;
				totalOperateRegister=0;
				var table = $('#dataTableRegister').DataTable(); 
 				var rows = table.rows().remove().draw();
				$("#totalRegister").text("SALDO: "+ totalOperateRegister);														
				$("#totalRegisterBalance").text("REGISTRO: "+ totalRegister);
			}
		});
		
	}
	if(option==4){
		
		swal({
			title: "Desea cancelar por completo la obligación?",
			text: "No se guardara ningun valor agregado.",
			icon: "warning",
			buttons: true,
			dangerMode: true,
			})
			.then((willDelete) => {
			if (willDelete) {
				$("#divObligation").css("display", "none");
				$('textarea[name="observationObligation"]').val("");
				addObligation.length=0;
				totalObligation=0;
				countAccountOB =0
				totalOperateArrayObligation.length=0;
				totalOperateObligation=0;
				var table = $('#dataTableObligation').DataTable(); 
				var rows = table.rows().remove().draw();
				var tableACOB = $('#dataTableGetAccountsObligation').DataTable(); 
				var rows = tableACOB.rows().remove().draw();
				$("#totalObligation").text("SALDO: "+ totalOperateObligation);														
				$("#totalObligationBalance").text("OBLIGACIÓN: "+ totalObligation);		


				$('#terceroSelectObligation').prop('disabled',false)
			}
		});

	}
	if(option ==5){
		$("#postSelection").css("display", "none");
		$('#id_input_filter').val('')
		$("#countingToVoucher").css("display", "none");
		listComprobante = []

		$('#buttonAccount').css("display", "none");
		$('#buttonFinishVoucher').attr('disabled',true);
		
		$("#buttonDiscount").css("display", "block");

		valueTotalAccountVoucherC = 0
		valueTotalAccountVoucherD = 0
		addDiscounts = []
		addDiscounts.length = 0
		totalVoucher=0;
		addAccount.length=0;
		addVoucher.length=0;
		totalOperateVoucher=0;
		$('#buttonGetThird').attr('disabled',false)
		discountsRepeat = []
		var table = $('#dataTableVoucher').DataTable(); 
		var rows = table.rows().remove().draw();
		table.draw()
		var tableD = $('#dataTableGetDiscounts').DataTable(); 
		var rowsD = tableD.rows().remove().draw();
		tableD.draw()
		var tableAC = $('#datatableAccountToVoucher').DataTable(); 
		var rowsAC = tableAC.rows().remove().draw();
		tableAC.draw()	 
		$("#totalVoucher").text("SALDO: "+ totalVoucher);														
		$("#totalVoucherBalance").text("OBLIGACIÓN: "+ totalOperateVoucher);

		$('#observationVoucherPayment').val('')
	}
}

function getDisponibilitysRg(){
	$.ajax({
			url: '{% url "getDisponibilityRegister"  0 %}'.replace('0', localStorage.getItem('userID')),
			data: {
				'bussines':localStorage.getItem('idBussines'),
				'origin': originID
			},
			dataType: 'json',
			success: function (data) {

				var table = $('#dataTableSelectDisponibility').DataTable(); 
 				var rows = table.rows().remove().draw();
				for (var i=0; i<data.DP.length; i++){

				table.row.add( [
				data.DP[i].disponibility,
				data.DP[i].value,
				data.DP[i].balance,
				data.DP[i].date,
				data.DP[i].observation,
				"<a data-toggle='tooltip' title='Seleccionar disponibilidad'><button  onclick=\'selectDisponibilty("+JSON.stringify(data.DP[i].id)+")\' class='btn btn-primary btn-sm'><i class='fa fa-check' aria-hidden='true'></i></button></a>"														
				])
				
			}
			table.draw( false );

			}
		});
}


function selectDisponibilty(id){

	$('#myModalDisponibilityOrigin').modal('toggle');
	$('#disponibilitySelectRegister> option[value='+id+']').attr('selected', 'selected');
	disponibilitySec = id;
	$.ajax({
			url: '{% url "fillDisponibility"  0 %}'.replace('0', localStorage.getItem('userID')),
			data: {
				'disponibility':id,
				'origin': originID
			},
			dataType: 'json',
			success: function (data) {
				

				if(data.RUBRO[0]['Third'].length == 1){
					$('#terceroSelectRegister').val(data.RUBRO[0]['Third'][0]['third__id'])
				}
				$("#observationRegister").val(data.OBSERVATION); 
				$("#dateRegister").val(data.DATE); 
				dateValidation =  data.DATE;
				var table = $('#dataTableRegister').DataTable(); 
 				var rows = table.rows().remove().draw();
				for (var i=0; i<data.RUBRO.length; i++){

				table.row.add( [
				data.RUBRO[i].rubro,
				data.RUBRO[i].description,
				data.RUBRO[i].valueP,
				"<input type='text'  onkeypress='return validaNumericos(event)'/   size='10'   id=register"+data.RUBRO[i].id+" class='form-control' name='inputRegister'>",
				"<label type='number' id=registerBalance"+data.RUBRO[i].id+">"+ JSON.stringify(data.RUBRO[i].valueP)+"</label>",
				"<a data-toggle='tooltip' title='Validar operación'><button type='button' onclick=\'operateBalanceRegister("+JSON.stringify(data.RUBRO[i].id)+','+JSON.stringify(data.RUBRO[i].rubro)+','+JSON.stringify(data.RUBRO[i].valueP )+','+JSON.stringify(data.RUBRO[i].idDispo)+','+JSON.stringify(data.RUBRO[i].valueP)+")\' class='btn btn-primary btn-sm'><i class='fa fa-check' aria-hidden='true'></i></button></a>"			
				])
			}
			table.draw( false );
			}
	});

}
function selectDisponibiltyToRegister(id){
	disponibilitySec = id;
	$.ajax({
			url: '{% url "fillDisponibility"  0 %}'.replace('0', localStorage.getItem('userID')),
			data: {
				'disponibility':id,
				'origin': originID
			},
			dataType: 'json',
			success: function (data) {
				$("#observationRegister").val(data.OBSERVATION);
				$("#dateRegister").val(data.DATE); 
				dateValidation =  data.DATE; 
				var table = $('#dataTableRegister').DataTable(); 
 				var rows = table.rows().remove().draw();
				for (var i=0; i<data.RUBRO.length; i++){

				table.row.add( [
				data.RUBRO[i].rubro,
				data.RUBRO[i].description,
				data.RUBRO[i].value,
				"<input type='text'  onkeypress='return validaNumericos(event)'/   size='10'   id=register"+data.RUBRO[i].id+" class='form-control' name='inputRegister'>",
				"<label type='number' id=registerBalance"+data.RUBRO[i].id+">"+ JSON.stringify(data.RUBRO[i].valueP)+"</label>",
				"<a data-toggle='tooltip' title='Validar operación'><button type='button' onclick=\'operateBalanceRegister("+JSON.stringify(data.RUBRO[i].id)+','+JSON.stringify(data.RUBRO[i].rubro)+','+JSON.stringify(data.RUBRO[i].value)+','+JSON.stringify(data.RUBRO[i].idDispo)+','+JSON.stringify(data.RUBRO[i].valueP)+")\' class='btn btn-primary btn-sm'><i class='fa fa-check' aria-hidden='true'></i></button></a>"			
				])
			}
			table.draw( false );
			}
	});

}
function getThirdsRg(option){
	if(option==1){
		$.ajax({
				url: '{% url "getThirds"  0 %}'.replace('0', localStorage.getItem('userID')),
				data: {
					'bussines':localStorage.getItem('idBussines'),
					'origin': originID
				},
				dataType: 'json',
				success: function (data) {

					var table = $('#dataTableThirds').DataTable(); 
					var rows = table.rows().remove().draw();
					for (var i=0; i<data.TH.length; i++){

					table.row.add( [
					data.TH[i].name,
					data.TH[i].surnames,
					data.TH[i].typeIdentification,
					data.TH[i].identification,
					data.TH[i].phone,
					"<a data-toggle='tooltip' title='Seleccionar tercero'><button  id="+JSON.stringify(data.TH[i].id)+" onclick=\'selectThirds("+JSON.stringify(data.TH[i].id)+','+JSON.stringify(data.TH[i].name)+")\' class='btn btn-primary btn-sm'><i class='fa fa-check' aria-hidden='true'></i></button></a>"														
					])
					
				}
				table.draw( false );

				}
			});
	}
	if(option==2){
		$.ajax({
				url: '{% url "getThirds"  0 %}'.replace('0', localStorage.getItem('userID')),
				data: {
					'bussines':localStorage.getItem('idBussines'),
					'origin': originID
				},
				dataType: 'json',
				success: function (data) {
					
					var table = $('#dataTableThirds').DataTable(); 
					var rows = table.rows().remove().draw();
					for (var i=0; i<data.TH.length; i++){

					table.row.add( [
					data.TH[i].name,
					data.TH[i].surnames,
					data.TH[i].typeIdentification,
					data.TH[i].identification,
					data.TH[i].phone,
					"<a data-toggle='tooltip' title='Seleccionar tercero'><button  id="+JSON.stringify(data.TH[i].id)+" onclick=\'selectThirdsUpdateRegister("+JSON.stringify(data.TH[i].id)+','+JSON.stringify(data.TH[i].name)+")\' class='btn btn-primary btn-sm'><i class='fa fa-check' aria-hidden='true'></i></button></a>"														
					
					])
					
				}
				table.draw( false );
				$('#myModalRubroImplicadoRegister').modal('toggle');
				}
			});
	}

}

function selectThirds(id,name){
	
	$('#terceroSelectRegister> option[value='+id+']').attr('selected', 'selected');
	$('#terceroSelectObligation> option[value='+id+']').attr('selected', 'selected');
	$('#myModalThirds').modal('toggle');
	
}
function selectThirdsUpdateRegister(id,name){
	
	$('#terceroSelectRegisterUpdate> option[value='+id+']').attr('selected', 'selected');
	$('#myModalThirds').modal('toggle');
	$('#myModalRubroImplicadoRegister').modal('toggle');
	
}

function getTypeDocument(){
	$.ajax({
			url: '{% url "getTypeDocument"  0 %}'.replace('0', localStorage.getItem('userID')),
			data: {
				'bussines':localStorage.getItem('idBussines'),
				'origin': originID
			},
			dataType: 'json',
			success: function (data) {

				var table = $('#dataTableTypeDocumentsVC').DataTable(); 
 				var rows = table.rows().remove().draw();
				for (var i=0; i<data.VC.length; i++){

				table.row.add( [
				data.VC[i].code,
				data.VC[i].name,
				data.VC[i].description,
				data.VC[i].category,
				"<a data-toggle='tooltip' title='Seleccionar tipo de documento'><button onclick=\'selectTypeDocument("+JSON.stringify(data.VC[i].id)+")\' class='btn btn-primary btn-sm'><i class='fa fa-check' aria-hidden='true'></i></button></a>"														
				])
				
			}
			table.draw( false );

			}
		});
}

function submitThird() {
	var typeIdentification = $("#id_typeIdentification option:selected").text();
	var identification = $('input[name="identification"]').val();
	var name = document.getElementById("id_name").value;
	var surnames = $('input[name="surnames"]').val();
	var reason = $('input[name="reason"]').val();
	var phone = $('input[name="phone"]').val();
	var city = $('input[name="city"]').val();   

	if (typeIdentification, identification, name, surnames, reason, phone, city) {
		// Create Ajax Call
		$.ajax({
			url: '{% url "createThird"  0 %}'.replace('0', localStorage.getItem('userID')),
			data: {
				'bussines': localStorage.getItem('idBussines'),
				'typeIdentification': typeIdentification,
				'identification': identification,
				'name': name,
				'surnames': surnames,    
				'reason': reason,
				'phone': phone,
				'city': city, 
			},
			dataType: 'json',
			success: function (data) {
				if (data.CREATE=="TRUE"){
					swal("Creado exitoso del nuevo tercero!", "Continua con tu proceso!", "success");
					$('#myModalCreateThird').modal('toggle');
					$('#myModalThirds').modal('toggle');
					$.ajax({
						url: '{% url "getThirds"  0 %}'.replace('0', localStorage.getItem('userID')),
						data: {
							'bussines':localStorage.getItem('idBussines'),
							'origin': originID
						},
						dataType: 'json',
						success: function (data) {

							var tableThirdsRg = $('#dataTableThirds').DataTable(); 
							var rows = tableThirdsRg.rows().remove().draw();
							
							const $selectTH = document.querySelector("#terceroSelectRegister");
							for (let i = $selectTH.options.length; i >= 0; i--) {
								$selectTH.remove(i);
							}  
							for (var i=0; i<data.TH.length; i++){
							$('#terceroSelectRegister').append('<option value='+data.TH[i].id+'>'+data.TH[i].name + " " +data.TH[i].surnames+'</option>')	

							tableThirdsRg.row.add( [
							data.TH[i].name,
							data.TH[i].surnames,
							data.TH[i].typeIdentification,
							data.TH[i].identification,
							data.TH[i].phone,
							"<a data-toggle='tooltip' title='Seleccionar tercero'><button  id="+JSON.stringify(data.TH[i].id)+" onclick=\'selectThirds("+JSON.stringify(data.TH[i].id)+','+JSON.stringify(data.TH[i].name)+")\' class='btn btn-primary btn-sm'><i class='fa fa-check' aria-hidden='true'></i></button></a>"														
							])
							
						}
						tableThirdsRg.draw( false );

						}
					});
				}else{
					swal("No se puede crear un tercero con la misma identificación para esta empresa", "Verifique sus datos!", "error");
				}
				
			}
		});
	} else {
		alert("Por favor llene todos los campos");
	}
	$('form#addThirdRg').trigger("reset");
	return false;
}

function viewFormThirds(){

	$('#myModalThirds').modal('toggle');
	setTimeout(function(){
		$("#myModalCreateThird").modal('show');
	},1000)
}
	

$(document).on('change', '#disponibilitySelectRegister', function(event) {
	$.ajax({
			url: '{% url "fillDisponibility"  0 %}'.replace('0', localStorage.getItem('userID')),
			data: {
				'disponibility':$( "#disponibilitySelectRegister" ).val(),
				'origin': originID
			},
			dataType: 'json',
			success: function (data) {
				console.log(data)
				disponibilitySec = $( "#disponibilitySelectRegister" ).val();
				if(data.RUBRO[0].Third.length > 0){
					$('#terceroSelectRegister').val(data.RUBRO[0].Third[0].third__id)
				}else{
					$('#terceroSelectRegister').val('')
				}

				$("#observationRegister").val(data.OBSERVATION);
				$("#dateRegister").val(data.DATE); 
				dateValidation =  data.DATE;
				var table = $('#dataTableRegister').DataTable(); 
 				var rows = table.rows().remove().draw();
				for (var i=0; i<data.RUBRO.length; i++){

				table.row.add( [
				data.RUBRO[i].rubro,
				data.RUBRO[i].description,
				data.RUBRO[i].value,
				"<input type='text'  onkeypress='return validaNumericos(event)'/   size='10'   id=register"+data.RUBRO[i].id+" class='form-control' name='inputRegister'>",
				"<label type='number' id=registerBalance"+data.RUBRO[i].id+"></label>",
				"<a data-toggle='tooltip' title='Validar operación'><button type='button' onclick=\'operateBalanceRegister("+JSON.stringify(data.RUBRO[i].id)+','+JSON.stringify(data.RUBRO[i].rubro)+','+JSON.stringify(data.RUBRO[i].value)+','+JSON.stringify(data.RUBRO[i].idDispo)+','+JSON.stringify(data.RUBRO[i].valueP)+")\' class='btn btn-primary btn-sm'><i class='fa fa-check' aria-hidden='true'></i></button></a>"			
				])



			}
			table.draw( false );			
			}
	});
});


$('#typeContractUpdate').on('focus',function () {
        // Store the current value on focus and on change
        previous = this.value;
    }).change(function(e) {
		$.ajax({
			url: '{% url "fillTypeContract"  0 %}'.replace('0', localStorage.getItem('userID')),
			data: {
				'contract':$( "#typeContractUpdate" ).val(),
				'bussines':localStorage.getItem('idBussines')
			},
			dataType: 'json',
			success: function (data) {
				$(typeContractUpdate).val()
				console.log($('#idMovementTC').val())

				if(data.Contract.length == 0){
					swal("No se posee contractos", " " , "error");
					$( "#typeContractUpdate" ).val(previous)
					previous =$( "#typeContractUpdate" ).val();

				}else{
					$("#DetalltypeContract").css("display", "block");
					const $select = document.querySelector("#selectDetalltypeContractUpdate");

					for (let i = $select.options.length; i >= 0; i--) {
							$select.remove(i);
					}


					$('#selectDetalltypeContractUpdate').append(`<option  hidden  selected"> Selecciona una opción</option>`);
					for (var i=0; i<data.Contract.length; i++){
						$('#selectDetalltypeContractUpdate').append('<option value='+data.Contract[i].id+'>'+data.Contract[i].digitstc+' '+data.Contract[i].value+'</option>')
					}
					previous =$( "#typeContractUpdate" ).val();
				}	
		}
	})
});

/* $(document).on('change', '#typeContractUpdate', function(event, oldValue) {	
	console.log( $(this).val())
	$.ajax({
			url: '{% url "fillTypeContract"  0 %}'.replace('0', localStorage.getItem('userID')),
			data: {
				'contract':$( "#typeContractUpdate" ).val(),
				'bussines':localStorage.getItem('idBussines')
			},
			dataType: 'json',
			success: function (data) {
				$(typeContractUpdate).val()
				console.log(data)

				if(data.Contract.length == 0){
					swal("No se posee contractos", " " , "error");

				}else{
					$("#DetalltypeContract").css("display", "block");
					const $select = document.querySelector("#selectDetalltypeContractUpdate");

					for (let i = $select.options.length; i >= 0; i--) {
							$select.remove(i);
					}


					$('#selectDetalltypeContractUpdate').append(`<option  hidden  selected"> Selecciona una opción</option>`);
					for (var i=0; i<data.Contract.length; i++){
						$('#selectDetalltypeContractUpdate').append('<option value='+data.Contract[i].id+'>'+data.Contract[i].digitstc+' '+data.Contract[i].value+'</option>')
					}
				}	
		}
	});
}); */


$(document).on('change', '#typeContract', function(event) {
	$.ajax({
			url: '{% url "fillTypeContract"  0 %}'.replace('0', localStorage.getItem('userID')),
			data: {
				'contract':$( "#typeContract" ).val(),
				'bussines':localStorage.getItem('idBussines')
			},
			dataType: 'json',
			success: function (data) {
				console.log(data)

				if(data.Contract.length == 0){
					swal("No se posee contractos", " " , "error");

				}else{
					$("#DetalltypeContract").css("display", "block");
					const $select = document.querySelector("#selectDetalltypeContract");

					for (let i = $select.options.length; i >= 0; i--) {
							$select.remove(i);
					}


					$('#selectDetalltypeContract').append(`<option  hidden  selected"> Selecciona una opción</option>`);
					for (var i=0; i<data.Contract.length; i++){
						$('#selectDetalltypeContract').append('<option value='+data.Contract[i].id+'>'+data.Contract[i].digitstc+' '+data.Contract[i].value+'</option>')
					}
				}
				
				/* 
				disponibilitySec = $( "#disponibilitySelectRegister" ).val();

				$("#observationRegister").val(data.OBSERVATION);
				$("#dateRegister").val(data.DATE); 
				dateValidation =  data.DATE;
				var table = $('#dataTableRegister').DataTable(); 
 				var rows = table.rows().remove().draw();
				for (var i=0; i<data.RUBRO.length; i++){

				table.row.add( [
				data.RUBRO[i].rubro,
				data.RUBRO[i].description,
				data.RUBRO[i].value,
				"<input type='text'  onkeypress='return validaNumericos(event)'/   size='10'   id=register"+data.RUBRO[i].id+" class='form-control' name='inputRegister'>",
				"<label type='number' id=registerBalance"+data.RUBRO[i].id+">"+ JSON.stringify(data.RUBRO[i].valueP)+"</label>",
				"<a data-toggle='tooltip' title='Validar operación'><button type='button' onclick=\'operateBalanceRegister("+JSON.stringify(data.RUBRO[i].id)+','+JSON.stringify(data.RUBRO[i].rubro)+','+JSON.stringify(data.RUBRO[i].value)+','+JSON.stringify(data.RUBRO[i].idDispo)+','+JSON.stringify(data.RUBRO[i].valueP)+")\' class='btn btn-primary btn-sm'><i class='fa fa-check' aria-hidden='true'></i></button></a>"			
				])
			}
			table.draw( false );			 */
		}
	});
});



$("#dateRegister").change(function(){
    var valor = $(this).val();
    if(valor!=""){
		if(dateValidation >= valor){
			swal("Fecha minima posible", dateValidation, "warning");
			$("#dateRegister").val(dateValidation);
		}		
    }
})
$("#dateObligation").change(function(){
    var valor = $(this).val();
    if(valor!=""){
		if(dateValidationR >= valor){
			swal("Fecha minima posible", dateValidationR, "warning");
			$("#dateObligation").val(dateValidationR);
		}		
    }
})
$("#dateVoucherPayment").change(function(){
    var valor = $(this).val();
    if(valor!=""){
		if(dateValidationR >= valor){
			swal("Fecha minima posible", dateValidationR, "warning");
			$("#dateVoucherPayment").val(dateValidationR);
		}		
    }
})
cantidad = 0
$(document).on('change', '#registerObligation', function(event) {
	registerSec = $("#registerObligation").val();
	$.ajax({
			url: '{% url "fillRegister"  0 %}'.replace('0', localStorage.getItem('userID')),
			data: {
				'register':$( "#registerObligation" ).val(),
				'origin': originID
			},
			dataType: 'json',
			success: function (data) {
				$("#observationObligation").val(data.OBSERVATION); 
				dateValidationR =  data.DATE;
				$("#dateObligation").val(data.DATE);
				var table = $('#dataTableObligation').DataTable(); 
 				var rows = table.rows().remove().draw();
				console.log(data)
				$('#terceroSelectObligation> option[value='+data.THIRD+']').attr('selected', 'selected');
				$('#terceroSelectObligation').prop('disabled', 'disabled');
				for (var i=0; i<data.RUBRO.length; i++){

				table.row.add( [
				data.RUBRO[i].rubro,
				data.RUBRO[i].register,
				data.RUBRO[i].value,
				"<input type='text'  onkeypress='return validaNumericos(event)'/   size='10'   id=obligation"+data.RUBRO[i].id+" class='form-control' name='inputObligation'>",
				"<label type='number' id=registerObligation"+data.RUBRO[i].id+">"+ JSON.stringify(data.RUBRO[i].valueP)+"</label>",
				"<a data-toggle='tooltip' title='Validar operación'><button type='button' id=ButtonregisterObligation"+data.RUBRO[i].id+" onclick=\'operateBalanceObligation("+JSON.stringify(data.RUBRO[i].id)+','+JSON.stringify(data.RUBRO[i].rubro)+','+JSON.stringify(data.RUBRO[i].value)+','+JSON.stringify(data.RUBRO[i].idRegister)+','+JSON.stringify(data.RUBRO[i].valueP)+','+1+")\' class='btn btn-primary btn-sm'><i class='fa fa-check' aria-hidden='true'></i></button></a>"
				/* +
				"<a data-toggle='tooltip' title='Validar operación'><button id="+data.RUBRO[i].rubro+" type='button' onclick=\'ChangeValue("+JSON.stringify(data.RUBRO[i].id)+','+JSON.stringify(data.RUBRO[i].rubro)+','+JSON.stringify(data.RUBRO[i].value)+','+JSON.stringify(data.RUBRO[i].idRegister)+','+JSON.stringify(data.RUBRO[i].valueP)+",this)\' class='btn btn-primary btn-sm'><i class='fa fa-pencil' aria-hidden='true'></i></button></a>"			 */
					
			])
			}
			table.draw( false );
			var table = $('#dataTableGetAccountsObligation').DataTable(); 
 			var rows = table.rows().remove().draw();
			auxiliarAccountList = []
			accountsWithValues = []
			arrayIdAccount = []
			
			}
	});
});


function operateBalanceRegister(id,rubro,value,idDispo,valueP){

	var createId =  "#register"+id;
	var result= "#registerBalance"+id
	var operate=0;
	var valueRegister = parseInt(value);
	operate = parseInt(value) - parseInt($(createId).val());
	const found = addRegister.findIndex(element => element['id'] == id);
	if(parseInt($(createId).val())==0){
		swal("No se puede generar una operación de valor 0", " " , "error");
	}else{
		if(found<0){
			if(operate<0){
					swal("El valor de "+ parseInt($(createId).val())+" es mayor a el valor de  "+ value, " No se puede realizar el registro", "error");
				}else{
					$(result).text(operate);
					addRegister.push({
						"idDispo":idDispo,
						"id": id,
						"rubro": rubro,
						"value":parseInt($(createId).val()),
						"balance":operate
					})
					totalOperateArrayRegister.push({
						"id": id,
						"subtotal": operate,
						"register":  parseInt($(createId).val())
					})
					totalOperateRegister = totalOperateRegister + operate;	
					totalRegister = totalRegister + parseInt($(createId).val());
					$("#totalRegister").text("SALDO: "+ totalOperateRegister);														
					$("#totalRegisterBalance").text("REGISTRO: "+ totalRegister);														

				}
			}else{

				if(operate<0){
					swal("El valor de "+ parseInt($(createId).val())+" es mayor a el valor de  "+ value, " No se puede realizar el registro", "error");
				}else{
					$(result).text(operate);
					addRegister[found] ={
						"idDispo":idDispo,
						"id": id,
						"rubro": rubro,
						"value":parseInt($(createId).val()),
						"balance":operate
					}
					totalOperateRegister = totalOperateRegister - totalOperateArrayRegister[found]['subtotal'];	
					totalRegister = totalRegister - totalOperateArrayRegister[found]['register'];
					totalOperateArrayRegister[found] = {
						"id": id,
						"subtotal": operate,
						"register":  parseInt($(createId).val())
					}
					totalOperateRegister = totalOperateRegister + totalOperateArrayRegister[found]['subtotal'];	
					totalRegister = totalRegister + totalOperateArrayRegister[found]['register'];
					$("#totalRegister").text("SALDO: "+ totalOperateRegister);														
					$("#totalRegisterBalance").text("REGISTRO: "+ totalRegister);														

				}
			}
	}	
	
}

function createRegister(option){
	if(option==1){
		if(totalRegister==0){
		swal("No puede guardar el registro sin valores", "Por favor ingrese el registro", "error");
		}else{
			swal({
			title: "Desea terminar el registro ?",
			text: "Al confirmar esta acción,el registro sera guardado",
			icon: "warning",
			buttons: true,
			dangerMode: true,
			}).then((willDelete) => {
			if (willDelete) {

				var registerCode = $('input[name="registerNumber"]').val();
				var observation = $('textarea[name="observationRegister"]').val();
				var date = $('input[name="dateRegister"]').val();
				var contract  = $("#selectDetalltypeContract").val();
				var third = $("#terceroSelectRegister option:selected").val();
				var contract2 = $('#typeContract').val();
				if (registerCode,observation,date && third != "Selecciona una opción" && contract != "Selecciona una opción"  && contract2 != "Selecciona una opción") {
					// Create Ajax Call
					$.ajax({
						url: '{% url "createRegister"  0 %}'.replace('0', localStorage.getItem('userID')),
						data: {
							'bussines':localStorage.getItem('idBussines'), 
							'registerCode': registerCode,
							'origin': originID,
							'date': date,
							'observation': observation,
							'value':totalRegister,
							'balance': totalOperateRegister,
							'registers': JSON.stringify(addRegister),
							'disponibility': disponibilitySec,
							'contract': contract,
							'third': third
						},
						dataType: 'json',
						success: function (data) {
							$("#divRegister").css("display", "none");
							swal("Creado exitoso del registro!", "Continua con tu proceso!", "success");
							$('textarea[name="observationRegister"]').val("");
							addRegister.length=0;
							totalRegister=0;
							totalOperateArrayRegister.length=0;
							totalOperateRegister=0;
							var table = $('#dataTableRegister').DataTable(); 
							var rows = table.rows().remove().draw();
							$("#totalRegister").text("SALDO: "+ totalOperateRegister);														
							$("#totalRegisterBalance").text("REGISTRO: "+ totalRegister);
							$("#observationRegister").val("");
							$("#DetalltypeContract").css("display", "none");
			
						}
					});
				} else {
					swal("Revisar información", "Por favor llene todos los campos", "error");
				}
				return false;
			}
			});
		}
		
	}else{
		
		var thirdVal = $("#terceroSelectRegister option:selected").val();
		if(totalRegister==0 || thirdVal=='Selecciona una opción'){
		swal("No puede guardar el registro sin valores", "Por favor ingrese el registro o escoge Terceros", "error");
		}else{

		
		swal({
			title: "Desea terminar el registro ?",
			text: "Al confirmar esta acción, l el registro sera guardado",
			icon: "warning",
			buttons: true,
			dangerMode: true,
			}).then((willDelete) => {
			if (willDelete) {
				var registerCode = $('input[name="registerNumber"]').val();
				var observation = $('textarea[name="observationRegister"]').val();
				var date = $('input[name="dateRegister"]').val();
				var contract  = $("#selectDetalltypeContract").val();
				var third = $("#terceroSelectRegister option:selected").val();
				var contract2 = $('#typeContract').val();
				if (registerCode,observation,date && third != "Selecciona una opción" && contract != "Selecciona una opción"  && contract2 != "Selecciona una opción") {
					// Create Ajax Call
					$.ajax({
						url: '{% url "createRegister"  0 %}'.replace('0', localStorage.getItem('userID')),
						data: {
							'bussines':localStorage.getItem('idBussines'), 
							'registerCode': registerCode,
							'origin': originID,
							'date': date,
							'observation': observation,
							'value':totalRegister,
							'balance': totalOperateRegister,
							'registers': JSON.stringify(addRegister),
							'disponibility': disponibilitySec,
							'contract': contract,
							'third': thirdVal
						},
						dataType: 'json',
						success: function (data) {
							
							getDataToObligation();
							Tercerodesactivo = $("#terceroSelectRegister option:selected").val()
							setTimeout(function(){
								
								$('#registerObligation> option[value='+data.ID+']').attr('selected', 'selected');
								$('#terceroSelectObligation> option[value='+$("#terceroSelectRegister option:selected").val()+']').attr('selected', 'selected');
								$('#registerObligation').prop('disabled', 'disabled');
							}, 1000);
							
							
							selectRegisterToObligation(JSON.stringify(data.ID));
							$("#divRegister").css("display", "none");
							swal("Creado exitoso del registro!", "Continua con tu proceso!", "success");
							$('textarea[name="observationRegister"]').val("");
							addRegister.length=0;
							totalRegister=0;
							totalOperateArrayRegister.length=0;
							totalOperateRegister=0;
							$('#registerObligation').prop('disabled', 'disabled');
							$('#terceroSelectObligation').prop('disabled', 'disabled');
							$("#buttonRegisterSelectObligation").css("display", "none");     
							$("#buttonThirdSelectObligation").css("display", "none");
							$("#labelRegisterSelectObligation").text("Registro: ");		
							var table = $('#dataTableRegister').DataTable(); 
							var rows = table.rows().remove().draw();
							$("#totalRegister").text("SALDO: "+ totalOperateRegister);														
							$("#totalRegisterBalance").text("REGISTRO: "+ totalRegister);
							$("#ThirdsToObligation").text("Terceros: ");															
							$("#observationObligation").val(observation);
							$("#dateObligation").val(date); 						
							dateValidationR =  date;
							$("#registerObligation").val(data.ID);



							$('input[name=typeComprobante]:checked', '#addVoucher').attr('checked',false)
							$('#OBLIGACIÓN', '#addVoucher').attr('checked',true)
							var nameOrigin = $('input[name=origins]:checked', '#addVoucher').val();
							$("#generator").text("GENERAR OBLIGACIÓN DE PRESUPUESTO DE "+ nameOrigin);
							$('input[name=typeComprobante]:checked', '#addVoucher').val('OBLIGACIÓN')
							$('input[name=typeComprobante]:checked', '#addVoucher').attr('checked',true)

							registerSecDispo = data.ID;

						}
					});
				} else {
					alert("Por favor llene todos los campos");
				}
				return false;
			}
			});		
		}
	}	
}


function getRegistersOB(){
	$.ajax({
			url: '{% url "getRegistersOB"  0 %}'.replace('0', localStorage.getItem('userID')),
			data: {
				'bussines':localStorage.getItem('idBussines'),
				'origin': originID
			},
			dataType: 'json',
			success: function (data) {
				
				var table = $('#dataTableSelecRegister').DataTable(); 
 				var rows = table.rows().remove().draw();
				for (var i=0; i<data.RG.length; i++){

					table.row.add( [
					data.RG[i].register,
					data.RG[i].value,
					data.RG[i].balance,
					data.RG[i].date,
					data.RG[i].observation,
					"<a data-toggle='tooltip' title='Seleccionar registro'><button  onclick=\'selectRegister("+JSON.stringify(data.RG[i].id)+")\' class='btn btn-primary btn-sm'><i class='fa fa-check' aria-hidden='true'></i></button></a>"														
					])
				
			}
			table.draw( false );

			}
		});
}
function getObligationVoucher(){
	$.ajax({
			url: '{% url "getObligationsVC"  0 %}'.replace('0', localStorage.getItem('userID')),
			data: {
				'bussines':localStorage.getItem('idBussines'),
				'origin': originID
			},
			dataType: 'json',
			success: function (data) {

				var table = $('#dataTableSelectObligation').DataTable(); 
 				var rows = table.rows().remove().draw();
				for (var i=0; i<data.OB.length; i++){

				table.row.add( [
				data.OB[i].obligation,
				data.OB[i].value,
				data.OB[i].balance,
				data.OB[i].date,
				data.OB[i].observation,
				"<a data-toggle='tooltip' title='Seleccionar obligacion'><button  onclick=\'selectObligation("+JSON.stringify(data.OB[i].id)+")\' class='btn btn-primary btn-sm'><i class='fa fa-check' aria-hidden='true'></i></button></a>"														
				])
				
			}
			table.draw( false );

			}
		});
}
function selectObligation(id){
	$('#myModalRegister').modal('toggle');
	$('#selectObligationVoucher').val(id);
	$.ajax({
			url: '{% url "fillObligation"  0 %}'.replace('0', localStorage.getItem('userID')),
			data: {
				'obligation':id,
				'origin': originID
			},
			dataType: 'json',
			success: function (data) {
				$("#observationVoucherPayment").val(data.OBSERVATION); 
				$("#dateVoucherPayment").val(data.DATE); 
				dateValidationR = data.DATE; 
				var table = $('#dataTableObligation').DataTable(); 
 				var rows = table.rows().remove().draw();
				for (var i=0; i<data.RUBRO.length; i++){

				table.row.add( [
				data.RUBRO[i].rubro,
				data.RUBRO[i].obligation,
				data.RUBRO[i].value,
				"<input type='text'  onkeypress='return validaNumericos(event)'/   size='10'   id=voucherPayment"+data.RUBRO[i].id+" class='form-control' name='inputObligation'>",
				data.RUBRO[i].valueP,
				"<a data-toggle='tooltip' title='Validar operación'><button type='button' onclick=\'operateVoucherPayment("+JSON.stringify(data.RUBRO[i].id)+','+JSON.stringify(data.RUBRO[i].rubro)+','+JSON.stringify(data.RUBRO[i].value)+','+JSON.stringify(data.RUBRO[i].idRegister)+','+JSON.stringify(data.RUBRO[i].valueP)+")\' class='btn btn-primary btn-sm'><i class='fa fa-check' aria-hidden='true'></i></button></a>"			
				])
			}
			table.draw( false );
			}
	});

}
function selectRegister(id){
	$('#myModalRegister').modal('toggle');
	$('#registerObligation> option[value='+id+']').attr('selected', 'selected');
	$.ajax({
			url: '{% url "fillRegister"  0 %}'.replace('0', localStorage.getItem('userID')),
			data: {
				'register':id,
				'origin': originID
			},
			dataType: 'json',
			success: function (data) {
				$('#terceroSelectObligation').val(data.THIRD)
				$('#terceroSelectObligation').prop('disabled', 'disabled');
				$("#observationObligation").val(data.OBSERVATION); 
				$("#dateObligation").val(data.DATE); 
				dateValidationR = data.DATE; 
				var table = $('#dataTableObligation').DataTable(); 
 				var rows = table.rows().remove().draw();
				for (var i=0; i<data.RUBRO.length; i++){

				table.row.add( [
				data.RUBRO[i].rubro,
				data.RUBRO[i].register,
				data.RUBRO[i].value,
				"<input type='text'  onkeypress='return validaNumericos(event)'/   size='10'   id=obligation"+data.RUBRO[i].id+" class='form-control' name='inputObligation'>",
				"<label type='number' id=registerObligation"+data.RUBRO[i].id+">"+ JSON.stringify(data.RUBRO[i].valueP)+"</label>",
				"<a data-toggle='tooltip' title='Validar operación'><button type='button' onclick=\'operateBalanceObligation("+JSON.stringify(data.RUBRO[i].id)+','+JSON.stringify(data.RUBRO[i].rubro)+','+JSON.stringify(data.RUBRO[i].value)+','+JSON.stringify(data.RUBRO[i].idRegister)+','+JSON.stringify(data.RUBRO[i].valueP)+','+1+")\' class='btn btn-primary btn-sm'><i class='fa fa-check' aria-hidden='true'></i></button></a>"			
				])
			}
			table.draw( false );
			}
	});

}
function selectRegisterToObligation(id){
	$('#registerObligation> option[value='+id+']').attr('selected', 'selected');
	registerSec = $("#registerObligation").val();
	$.ajax({
			url: '{% url "fillRegister"  0 %}'.replace('0', localStorage.getItem('userID')),
			data: {
				'register':id,
				'origin': originID
			},
			dataType: 'json',
			success: function (data) {
				$("#observationObligation").val(data.OBSERVATION);
				$("#dateObligation").val(data.DATE); 						
				dateValidationR =  data.DATE;  
				var table = $('#dataTableObligation').DataTable(); 
 				var rows = table.rows().remove().draw();
				for (var i=0; i<data.RUBRO.length; i++){

				table.row.add( [
				data.RUBRO[i].rubro,
				data.RUBRO[i].register,
				data.RUBRO[i].value,
				"<input type='text'  onkeypress='return validaNumericos(event)'/   size='10'   id=obligation"+data.RUBRO[i].id+" class='form-control' name='inputObligation'>",
				"<label type='number' id=registerObligation"+data.RUBRO[i].id+">"+ JSON.stringify(data.RUBRO[i].valueP)+"</label>",
				"<a data-toggle='tooltip' title='Validar operación'><button type='button' onclick=\'operateBalanceObligation("+JSON.stringify(data.RUBRO[i].id)+','+JSON.stringify(data.RUBRO[i].rubro)+','+JSON.stringify(data.RUBRO[i].value)+','+JSON.stringify(data.RUBRO[i].idRegister)+','+JSON.stringify(data.RUBRO[i].valueP)+','+1+")\' class='btn btn-primary btn-sm'><i class='fa fa-check' aria-hidden='true'></i></button></a>"
			])
			}
			table.draw( false );
			}
	});

}

function ChangeValue(id,rubro,value,idRegister,valueP,row){
	
	var table = $('#dataTableGetAccountsObligation').DataTable(); 
	var data = table.rows().data();
	var debit;
	var credit;
	this.operateBalanceObligation(id,rubro,value,idRegister,valueP,2)
	data.each(function (value, index) {	
		if(value[0] == id){
			console.log(value[4])
			var createId =  "#obligation"+id;
			console.log($(createId).val())
			$("#obligationAccount"+id+index).val($(createId).val())
		}
    });
}


function operateBalanceObligation(id,rubro,value,idRegister,valueP,change){
	var createId =  "#obligation"+id;
	var result= "#registerObligation"+id
	var operate=0;
	var valueRegister = parseInt(value);
	var tableedit = $('#dataTableGetAccountsObligation').DataTable(); 
	var nRow = tableedit.rows().count();
	operate = parseInt(value) - parseInt($(createId).val());
	var valueAccount=parseInt($(createId).val());

	var accountExiste = false;


	$.ajax({
			url: '{% url "getAccountRubroExists"  0 %}'.replace('0', localStorage.getItem('userID')),
			data: {
				'rubro':id,
			},
			dataType: 'json',
			success: function (data) {
				if(data.EXISTE ==  "SI"){
					
					accountExiste = true
				}else{
					accountExiste = false
				}

				const found = addObligation.findIndex(element => element['id'] == id);
				setTimeout(()=>{
					if(parseInt($(createId).val())==0 || $(createId).val() ==''){
					swal("No se puede generar una operacion de valor 0", " " , "error");
				}else{
					if(found<0){
						if(operate<0){
								swal("El valor de "+ parseInt($(createId).val())+" es mayor a el valor de  "+ value, " No se puede realizar  la obligacion", "error");
						}else{
																			

							if(nRow==0 || change ==1){
								tableAccountsObligation(id,valueAccount,rubro);
							}
							
							if(accountExiste){

								$(result).text(operate);
								addObligation.push({
									"idRegister":idRegister,
									"id": id,
									"rubro": rubro,
									"value":parseInt($(createId).val()),
									"balance":operate
								})
								totalOperateArrayObligation.push({
									"id": id,
									"subtotal": operate,
									"obligation":  parseInt($(createId).val())
								})
								totalOperateObligation = totalOperateObligation + operate;	
								totalObligation = totalObligation + parseInt($(createId).val());
								$("#totalObligation").text("SALDO: "+ totalOperateObligation);														
								$("#totalObligationBalance").text("OBLIGACIÓN: "+ totalObligation);		
								}
							}
							
					}else{

						if(operate<0){
							swal("El valor de "+ parseInt($(createId).val())+" es mayor a el valor de  "+ value, " No se puede realizar la obligación", "error");
						}else{


								
							if(nRow==0 || change ==1){
								tableAccountsObligation(id,valueAccount,rubro);
							}
							if(accountExiste){
								$(result).text(operate);
							addObligation[found] ={
								"idRegister":idRegister,
								"id": id,
								"rubro": rubro,
								"value":parseInt($(createId).val()),
								"balance":operate
							}
							totalOperateObligation = totalOperateObligation - totalOperateArrayObligation[found]['subtotal'];	
							totalObligation = totalObligation - totalOperateArrayObligation[found]['obligation'];
							totalOperateArrayObligation[found] = {
								"id": id,
								"subtotal": operate,
								"obligation":  parseInt($(createId).val())
							}
							totalOperateObligation = totalOperateObligation + totalOperateArrayObligation[found]['subtotal'];	
							totalObligation = totalObligation + totalOperateArrayObligation[found]['obligation'];
							$("#totalObligation").text("SALDO: "+ totalOperateObligation);														
							$("#totalObligationBalance").text("OBLIGACIÓN: "+ totalObligation);	
							}												

						}

					}
				} 
				},1000)
							
			}
	});

	

	
	
}	


function SeleccionCuentaD(accountsAux,idObli,id,value,documento,account){
	
	console.log(accountsAux,idObli,id,value,documento,account)
	$("#CuentasAuxiliares").css("display", "flex");
	const $selectADebito = document.querySelector("#typeAccountSelectAD");

	for (let i = $selectADebito.options.length; i >= 0; i--) {
			$selectADebito.remove(i);
	}
	
	
	console.log(accountsAux)
	for(i = 0; i<accountsAux.length; i++){
		if(accountsAux[i].typeAccount == "M"){
			$('#typeAccountSelectAD').append('<option disabled style="background-color:gray; color: black" data-value2="'+accountsAux[i].description+'" value="'+accountsAux[i].code+'">'+accountsAux[i].code+' '+accountsAux[i].description+'</option>')
		}else{
			$('#typeAccountSelectAD').append('<option  data-id="'+accountsAux[i].id +'" data-value2="'+accountsAux[i].description+'" value="'+accountsAux[i].code+'">'+accountsAux[i].code+' '+accountsAux[i].description+'</option>')
		}
	}
	
	auxiliarAccountList[0] = [{
		"id": idObli,
		"accountMain":$("#typeAccountSelectAD option:selected").attr('data-id'),
		"account": $("#typeAccountSelectAD option:selected").val(),
		"description": $("#typeAccountSelectAD option:selected").attr('data-value2'),
		"valor":value,
		"documento":documento,
		"Tipo":"Debito",
		"Rubro": id
	}]

	$('#typeAccountSelectAD').on('change', function() {
		auxiliarAccountList[0] = [{
		"id": idObli,
		"accountMain":$("#typeAccountSelectAD option:selected").attr('data-id'),
		"account": $(this).val(),
		"description": $('option:selected', this).attr('data-value2'),
		"valor":value,
		"documento":documento,
		"Tipo":"Debito",
		"Rubro": id
		}]
    });


}


function SeleccionCuentaC(accountsAux,idObli,id,value,documento,account){
	$("#CuentasAuxiliaresCredito").css("display", "flex");
	const $selectACredito = document.querySelector("#typeAccountSelectAC");

	for (let i = $selectACredito.options.length; i >= 0; i--) {
			$selectACredito.remove(i);
	}
	for(i = 0; i<accountsAux.length; i++){
		if(accountsAux[i].typeAccount == "M"){
			$('#typeAccountSelectAC').append('<option disabled style="background-color:gray; color: black" data-value2="'+accountsAux[i].description+'" value="'+accountsAux[i].code+'">'+accountsAux[i].code+' '+accountsAux[i].description+'</option>')
		}else{
			$('#typeAccountSelectAC').append('<option data-value2="'+accountsAux[i].description+'" value="'+accountsAux[i].code+'">'+accountsAux[i].code+' '+accountsAux[i].description+'</option>')
		}
	}
	console.log(id)
	auxiliarAccountList[1] = [{
		"id": idObli,
		"accountMain":$("#typeAccountSelectAC option:selected").attr('data-id'),
		"account": $("#typeAccountSelectAC option:selected").val(),
		"description": $("#typeAccountSelectAC option:selected").attr('data-value2'),
		"valor":value,
		"documento":documento,
		"Tipo":"Credito",
		"Rubro": id
	}]

	$('#typeAccountSelectAC').on('change', function() {
		auxiliarAccountList[1] = [{
		"id": idObli,
		"accountMain":$("#typeAccountSelectAC option:selected").attr('data-id'),
		"account": $(this).val(),
		"description": $('option:selected', this).attr('data-value2'),
		"valor":value,
		"documento":documento,
		"Tipo":"Credito",
		"Rubro": id
		}]
    });


}



function ConfirmarSeleccion(){
	console.log(auxiliarAccountList)
	if(auxiliarAccountList[0] != null && auxiliarAccountList[1] != null){

		swal({
			title: "Desea continuar?",
			text: "No se podra modificar o eliminar",
			icon: "warning",
			buttons: true,
			dangerMode: true,
			})
			.then((willDelete) => {
				if (willDelete) {
					var table = $('#dataTableGetAccountsObligation').DataTable(); 
					//console.log(auxiliarAccountList,"f")
					var indexes = table
						.rows()
						.indexes()
						.filter( function ( value, index ) {
							return  auxiliarAccountList[0][0].Rubro === table.row(value).data()[0];
						} );
					table.rows(indexes).remove().draw();
					//console.log(indexes)
					
					var found = accountsWithValues.findIndex(element => element['Rubro'] == auxiliarAccountList[0][0].Rubro);
					console.log(found,1)
					while (found>=0){
						accountsWithValues.splice(found, 1)
						found = accountsWithValues.findIndex(element => element['Rubro']==auxiliarAccountList[0][0].Rubro);
						console.log(found,3)
					}
					for (var j=0; j<auxiliarAccountList.length; j++){
						
						//accountsWithValues.push({"accountID": auxiliarAccountList[j][0].Rubro,"obligationID": auxiliarAccountList[j][0].id,"typeAccount":auxiliarAccountList[j][0].Tipo,"value":auxiliarAccountList[j][0].valor})
						arrayIdAccount.push({
							"rubro": auxiliarAccountList[j][0].Rubro,
							"id": auxiliarAccountList[j][0].id,
							"code": auxiliarAccountList[j][0].account
						})

						$('#obligation'+auxiliarAccountList[j][0].Rubro).prop('disabled',true)
						$('#ButtonregisterObligation'+auxiliarAccountList[j][0].Rubro).prop('disabled',true)
						console.log(auxiliarAccountList[j][0].Rubro,accountsWithValues.length)
						table.row.add( [
							auxiliarAccountList[j][0].Rubro,
							auxiliarAccountList[j][0].account,
							auxiliarAccountList[j][0].description,
							auxiliarAccountList[j][0].Tipo,			
							auxiliarAccountList[j][0].documento,
							"<input type='text'  onkeypress='return validaNumericos(event)'/ value='"+auxiliarAccountList[j][0].valor+"'  size='10'   id=obligationAccount"+auxiliarAccountList[j][0].Rubro+accountsWithValues.length+" class='form-control' name='obligationAccountInput'>",
							"<a data-toggle='tooltip' title='Aceptar valores cuenta'><button type='button' onclick=\'createArrayAccount("+JSON.stringify(auxiliarAccountList[j][0].id)+','+JSON.stringify(auxiliarAccountList[j][0].Rubro)+','+JSON.stringify(auxiliarAccountList[j][0].valor)+','+JSON.stringify(auxiliarAccountList[j][0].account)+")\' class='btn btn-primary btn-sm'><i class='fa fa-check' aria-hidden='true'></i></button><label id='validate"+auxiliarAccountList[j][0].account+""+accountsWithValues.length+"''>Sin validar</label></a>"			
						])
						accountsWithValues.push({"accountMainID":auxiliarAccountList[j][0].accountMain,"accountID":auxiliarAccountList[j][0].account,"Rubro": auxiliarAccountList[j][0].Rubro,"obligationID": auxiliarAccountList[j][0].id,"typeAccount":auxiliarAccountList[j][0].Tipo,"value":auxiliarAccountList[j][0].valor,"validate":false})
						
					}
					console.log(accountsWithValues)
					table.draw( false );
					$("#CuentasAuxiliares").css("display", "none");
					$("#CuentasAuxiliaresCredito").css("display", "none");
					const $selectACredito = document.querySelector("#typeAccountSelectAC");

					for (let i = $selectACredito.options.length; i >= 0; i--) {
							$selectACredito.remove(i);
					}
					const $selectADebito = document.querySelector("#typeAccountSelectAD");

					for (let i = $selectADebito.options.length; i >= 0; i--) {
							$selectADebito.remove(i);
					}
					
				}
				$("#myModalRepeti").modal('toggle'); 
			})

	}else{
		swal({
			title: "Error",
			text: "Por favor selecionar una cuenta y una cuenta auxiliar si la posee mas de una",
			icon: "warning"
			})
	}


}

function tableAccountsObligation(id,valueAccount,rubro){
	$.ajax({
		url: '{% url "getAccountsByRubro"  0 %}'.replace('0', localStorage.getItem('userID')),
		data: {
			'bussines':localStorage.getItem('idBussines'), 
			'rubro': id,

		},
		dataType: 'json',
		success: function (response) {

			console.log(response,"aquir")
			auxiliarAccountList = []
			
			var table = $('#datatableResultsFilterAccountDebito').DataTable(); 
			var rows = table.rows().remove().draw();
			var tableC = $('#datatableResultsFilterAccountCredito').DataTable(); 
			var rows = tableC.rows().remove().draw();
			for (var i=0; i<response.AC.length; i++){
				if(response.AC[i].document == 'Obligacion'){
					if(response.AC[i].typeAccount == 'Debito'){
						table.row.add( [
							response.AC[i].account ,
							response.AC[i].description,		
							response.AC[i].document,/* 
							"<input type='text'  onkeypress='return validaNumericos(event)'/ value='"+valueAccount+"'  size='10'   id=obligationAccount"+response.AC[i].id+" class='form-control' name='obligationAccountInput'>",
	*/
							"<a data-toggle='tooltip' title='Aceptar valores cuenta'><button type='button' onclick=\'SeleccionCuentaD("+JSON.stringify(response.AC[i].accounts)+','+JSON.stringify(response.AC[i].id)+','+JSON.stringify(id)+','+JSON.stringify(valueAccount)+','+JSON.stringify(response.AC[i].document)+','+JSON.stringify(response.AC[i].account_id)+")\' class='btn btn-primary btn-sm'><i class='fa fa-check' aria-hidden='true'></i></button></a>"+			
							"<a title='Actualizar cuenta'><button onclick=\'searchAccountsButton("+JSON.stringify(response.AC[i].id)+','+valueAccount+','+id+")\' class='btn btn-primary btn-sm'><i class='fa fa-pencil' aria-hidden='true'></i></button></a>"												
						])
					}
					if(response.AC[i].typeAccount == 'Credito'){
						tableC.row.add( [
							response.AC[i].account ,
							response.AC[i].description,		
							response.AC[i].document,/* 
							"<input type='text'  onkeypress='return validaNumericos(event)'/ value='"+valueAccount+"'  size='10'   id=obligationAccount"+response.AC[i].id+" class='form-control' name='obligationAccountInput'>",
	*/
							"<a data-toggle='tooltip' title='Aceptar valores cuenta'><button type='button' onclick=\'SeleccionCuentaC("+JSON.stringify(response.AC[i].accounts)+','+JSON.stringify(response.AC[i].id)+','+JSON.stringify(id)+','+JSON.stringify(valueAccount)+','+JSON.stringify(response.AC[i].document)+','+JSON.stringify(response.AC[i].account_id )+")\' class='btn btn-primary btn-sm'><i class='fa fa-check' aria-hidden='true'></i></button></a>"+			
							"<a title='Actualizar cuenta'><button onclick=\'searchAccountsButton("+JSON.stringify(response.AC[i].id)+','+valueAccount+','+id+")\' class='btn btn-primary btn-sm'><i class='fa fa-pencil' aria-hidden='true'></i></button></a>"												
						])
					}
				}
			}

			if(table.rows().count() == 0){
				$("#tablaDebito").css("display", "none");
				$("#CreateDebito").css("display", "block");
				$("#buttonConfirm").css("display", "none");
				
			}else{
				$("#tablaDebito").css("display", "block");
				$("#CreateDebito").css("display", "none");
				$("#buttonConfirm").css("display", "bloc");
			}
			if(tableC.rows().count() == 0){
				$("#tablaCredito").css("display", "none");
				$("#CreateCredito").css("display", "block");
				$("#buttonConfirm").css("display", "none");
				
			}else{
				$("#tablaCredito").css("display", "block");
				$("#CreateCredito").css("display", "none");
				$("#buttonConfirm").css("display", "block")
			}

			table.draw( false );
			tableC.draw( false );


			$('#myModalRepeti').data('id_elemento',id );
			$('#myModalRepeti').data('id_rubro',rubro );
			$("#myModalRepeti").modal('show'); 
			/* arrayIdAccount.push(response.AC[0])
			arrayIdAccount.push(response.AC[1]) */
		}
	});
}

function AgregarCuenta(id,rubro,type){
	console.log(id,rubro)
	$("#myModalRepeti").modal('toggle'); 
 
	setTimeout(function(){
		$('#myModalNewAccount').data('id_elemento',id );
		$('#myModalNewAccount').data('id_rubro',rubro );
		$('#myModalNewAccount').data('type',type );
		$("#myModalNewAccount").modal('show');
		$.ajax({
			url: '{% url "getAccountSettings"  0 %}'.replace('0', localStorage.getItem('userID')),
			data: {
				'bussinesId': localStorage.getItem('idBussines'),
				'idAC': localStorage.getItem('idAC'),

			},
			dataType: 'json',
			success: function (data) {
				/* const $select = document.querySelector("#accountSelect");
			
				for (let i = $select.options.length; i >= 0; i--) {
					$select.remove(i);
				} */

				var my_list=document.getElementById("accountSelect");
				var src = ''
				
				//$('#accountSelect').append(`<option  hidden  selected" > Selecciona una opción</option>`);
				for (var i=0; i<data.ACC.length; i++){
					src +=`<option  data-id="${data.ACC[i].id}" data-code="${data.ACC[i].code}" value="${data.ACC[i].code}`+' '+ `${data.ACC[i].description}" > </option>`
				//$('#accountSelect').append(`<option value="${data.ACC[i].id}" data-tokens="${data.ACC[i].id}">${data.ACC[i].code}`+' '+ `${data.ACC[i].description} </option>`);
				}	
				
				my_list.innerHTML = src;

				this.options = [].slice.call(document.getElementById("accountSelect").options).map( function(option) { return option.value; });


			}       
		});
	},1000)
}




/* $('#DataListaccountSelect').on('input', function() { 
	
	console.log(options)
	var val = $(this).val();
    if($('#accountSelect option').filter(function(){
        return this.value.toUpperCase() === val.toUpperCase();        
    }).length) {
        //send ajax request
		console.log($(this).val())
    }/* 
    var table =  $('#accountSelect [value="' + $(this).val() + '"]').data('id')
	
    
    table.column(0).search("^" + $(this).val(), true, false, true).draw(); */
/*}); */

var accountRubro = []
function createAccount(idRubro,Rubro,type){
	var account = ''
	var document = $("#operationAccountSelect option:selected").val();
	var idValue = $('#DataListaccountSelect').val();
	var dataID =  $('#accountSelect [value="' + idValue + '"]').data('id');
	var dataCODE =  $('#accountSelect [value="' + idValue + '"]').data('code');
	console.log(idRubro,Rubro,type,document,dataID,accountRubro)
	if(document && dataID && document!='Selecciona una opción'){
		$.ajax({
		url: '{% url "validateAccountsByRubro"  0 %}'.replace('0', localStorage.getItem('userID')),
		data: {
			'bussinesId': localStorage.getItem('idBussines'),            
			'rubro': idRubro,
			'document': document,
			'account': dataID,
			'operation': type
		},
		dataType: 'json',
		success: function (data) {
			if(data.VALIDATE == "PARTIDA"){
				swal("No se ha podido añadir cuenta", "Esta cuenta ya posee partida doble" , "error");
			}else{
				var tableAccountingOp = $('#dataTableAccountingOp').DataTable();
				tableAccountingOp.draw(false);
				var valueDouble = 0
				if (accountRubro.length == 0){
					accountRubro.push({"rubro": idRubro,"account": dataID,"document": document,"operationAccount":type})
					tableAccountingOp.row.add( [
						Rubro,
						dataCODE,
						type,
						document,                            
						"<a data-toggle='tooltip' type='button' id='deleteAccounting'title='Eliminar Cuenta'><button onclick=\'deleteAccounting(this)\' class='btn btn-primary btn-sm'><i class='fa fa-trash'></i></button></a>"
					])
					tableAccountingOp.draw(false);
				}else{
					for(var i = 0; i<accountRubro.length; i++){
						if(accountRubro[i].account == dataID && accountRubro[i].rubro == idRubro &&  accountRubro[i].document == document && accountRubro[i].operationAccount == type)
						{
							valueDouble = 1
						}
					} 
					if(valueDouble == 1){
						swal("No se ha podido añadir cuenta", "Esta cuenta ya se agrego" , "error");
					}else{
						accountRubro.push({"rubro": idRubro,"account": dataID,"document": document,"operationAccount":type})
						tableAccountingOp.row.add( [
							Rubro,
							dataCODE,
							type,
							document,                               
							"<a data-toggle='tooltip' type='button' id='deleteAccounting'title='Eliminar Cuenta'><button onclick=\'deleteAccounting(this)\' class='btn btn-primary btn-sm'><i class='fa fa-trash'></i></button></a>"
						])
						tableAccountingOp.draw(false);
					}
				}
				
			}
		}
	})

	}else{
		swal("No se ha podido añadir cuenta", "Llenar todos los campos" , "error");
	}

	

}

function deleteAccounting(row){
    var table = $('#dataTableAccountingOp').DataTable()
    indexTable = table.row(row.closest('tr')).index();
    table.row(row.closest('tr')).remove().draw(false);
	accountRubro.splice(indexTable, 1);
}

function cleanFields(){
	$("#operationAccountSelect").val('Selecciona una opción');
	$('#DataListaccountSelect').val('');
    $('#dataTableAccountingOp tbody tr td').each( function(){
        var table = $('#dataTableAccountingOp').DataTable()
        table.row(this.closest('tr')).remove().draw(false);
        accountRubro = []
    });
	$("#myModalNewAccount").modal('toggle'); 


	
}


function sendAccounts(){
    var token = '{{csrf_token}}';
	
    $.ajax({
			headers: { "X-CSRFToken": token },
			url: '{% url "createAccountRubro"  0 %}'.replace('0', localStorage.getItem('userID')),
			data: {
				'accountRubro': JSON.stringify(accountRubro),
				'bussines':localStorage.getItem('idBussines'),
			},
			type: 'POST',
			dataType: 'json',
			success: function (data) { 
                if(data.CREATE=="TRUE"){
                    swal("Se ha añadido cuenta", "Continua con tu proceso", "success");
					
					$("#myModalNewAccount").modal('toggle'); 

					$("#tablaDebito").css("display", "block");
					$("#CreateDebito").css("display", "none");
					$("#buttonConfirm").css("display", "block");

					$("#tablaCredito").css("display", "block");
					$("#CreateCredito").css("display", "none");
					$("#buttonConfirm").css("display", "block");
					cleanFields()   
					/* setTimeout(function(){
						$("#myModalRepeti").modal('show');
						
					},1000) */
                }
            }       
    });

}

function selectAccount(id,valueAccount,idTypeAccountUpdate,rubro){
	$.ajax({
			url: '{% url "updateAccountToObligation"  0 %}'.replace('0', localStorage.getItem('userID')),
			data: {
				'bussinesId': localStorage.getItem('idBussines'),            
				'id': id,
				'idTypeAccountUpdate':idTypeAccountUpdate
			},
			dataType: 'json',
			success: function (data) {
				
				$('#myModalAccountButton').modal('toggle');

				setTimeout(function(){
					
					tableAccountsObligation(rubro,valueAccount,rubro);
				},1000)

			}
	});
}
countAccountOB = 0
function createArrayAccount(obligationID,rubroID,valueAcount,accounIDR){
	var table = $('#dataTableGetAccountsObligation').DataTable(); 
	var data = table.rows().data();
	var debit;
	var credit;
	var indexDe
	var indexCR
		/* 
		table.rows(indexes).remove().draw(); */
	let valueDis = $('#obligation'+rubroID).val()
	data.each(function (value, index) {	
		console.log(value[0],rubroID)
		if(value[0] == rubroID){
			if(value[3]=='Debito'){
				debit =  parseInt($("#obligationAccount"+arrayIdAccount[index]['rubro']+''+index).val());
				indexDe = index
			}else{
				credit = parseInt($("#obligationAccount"+arrayIdAccount[index]['rubro']+''+index).val());	
				indexCR = index
			}		
		}
    });

	console.log(valueDis,debit)
	console.log(valueDis,credit)

	if(debit > valueDis || credit > valueDis){
		
		swal("Superan el valor del saldo de la disponibilidad","Verifique los valores", "error");

	}else{
		if(debit==credit){
			if(debit==valueAcount &&  credit==valueAcount){
				
				const found = accountsWithValues.findIndex(element => element.obligationID == obligationID );
				$('#validate'+accounIDR+""+found).text("OK")
				accountsWithValues[found]['value'] = valueAcount
				accountsWithValues[found]['validate'] = true
				countAccountOB = countAccountOB + 1
			}else{
				swal({
				title: "Suma no coincide en los valores contables?",
				text: "Al confirmar esta acción, los valores seran guardado",
				icon: "warning",
				buttons: true,
				dangerMode: true,
				}).then((willDelete) => { 

					const found = accountsWithValues.findIndex(element => element.obligationID == obligationID );
					
					for(var i = 0; i < accountsWithValues.length; i++){
						if(accountsWithValues[i]['obligationID'] == obligationID){
							
							
							if(accountsWithValues[i]['typeAccount'] == "Debito"){
								accountsWithValues[i]['value'] = parseInt($("#obligationAccount"+accountsWithValues[i]['Rubro']+''+i).val());
							}else{
								accountsWithValues[i]['value'] = parseInt($("#obligationAccount"+accountsWithValues[i]['Rubro']+''+i).val());	
							}
						}
						accountsWithValues[i]['validate'] = true
						$('#validate'+accountsWithValues[i]['accountID']+""+i).text("OK")
					}
				});	
			}
		}else{
			swal("Credito y debito no son iguales","Verifique los valores", "error");
			const found = accountsWithValues.findIndex(element => element.obligationID == obligationID );
			accountsWithValues[found]['validate'] = false
			$('#validate'+accounIDR+""+found).text("Error")
			for(var i = 0; i < accountsWithValues.length; i++){
				if(accountsWithValues[i]['obligationID'] == obligationID){
					if(accountsWithValues[i]['typeAccount'] == "Debito"){
						accountsWithValues[i]['value'] = debit
					}else{
						accountsWithValues[i]['value'] = credit
					}
				}
			}

		}
	}

	console.log(accountsWithValues)
	
	
}
function searchAccountsButton(id,valueAccount,rubro){
	
	$("#myModalRepeti").modal('toggle');
	setTimeout(function(){
		$("#myModalAccountButton").modal('show');
		$.ajax({
			url: '{% url "getSearchAccountButton"  0 %}'.replace('0', localStorage.getItem('userID')),
			data: {
				'bussinesId': localStorage.getItem('idBussines'),            
				'idAC': localStorage.getItem('idAC')

			},
			dataType: 'json',
			success: function (data) {
				console.log(data)

				var table = $('#datatableAccountButton').DataTable(); 
				var rows = table.rows().remove().draw();
				for (var i=0; i<data.ACCOUNT.length; i++){

				table.row.add( [
				data.ACCOUNT[i].code,
				data.ACCOUNT[i].description,
				"<a data-toggle='tooltip' title='Actualizar cuenta'><button id="+JSON.stringify(data.ACCOUNT[i].id)+" onclick=\'selectAccount("+id+','+valueAccount+','+JSON.stringify(data.ACCOUNT[i].id)+','+rubro+")\' class='btn btn-primary btn-sm'><i class='fa fa-check' aria-hidden='true'></i></button></a>"														
				])
				
			}
			table.draw( false );
			}
		});
	},1000)
	
}

function createObligation(option){
	var tableedit = $('#dataTableGetAccountsObligation').DataTable(); 
	var nRow = tableedit.rows().count();
	if(registerSec == null){
		registerSec = registerSecDispo;
	}

	var validate = true

	for(var i = 0; i < accountsWithValues.length; i++){
		if(!accountsWithValues[i]['validate']){
			validate = false
		}
	}
	if(validate){
		if(option==1){
		if(totalObligation==0){
			swal("No puede guardar la obligacion sin valores", "Por favor ingrese la obligacion", "error");
		}else{
			swal({
			title: "Desea terminar la obligación ?",
			text: "Al confirmar esta acción, la obligación sera guardada",
			icon: "warning",
			buttons: true,
			dangerMode: true,
			}).then((willDelete) => { 
				if (willDelete) {

					var obligationCode = $('input[name="numberObligation"]').val();
					var observation = $('textarea[name="observationObligation"]').val();
					var date = $('input[name="dateObligation"]').val();

					console.log("regost",registerSec)
					if (obligationCode,observation,date) {
						// Create Ajax Call
						$.ajax({
							url: '{% url "createObligation"  0 %}'.replace('0', localStorage.getItem('userID')),
							data: {
								'bussines':localStorage.getItem('idBussines'), 
								'obligationCode': obligationCode,
								'origin': originID,
								'date': date,
								'observation': observation,
								'value':totalObligation,
								'balance': totalOperateObligation,
								'obligations': JSON.stringify(addObligation),
								'accounts': JSON.stringify(accountsWithValues),	
								'third': $("#terceroSelectObligation").val(),
								'rightsEconomic': checkEconomicsRight,											
								'register':registerSec
							},
							dataType: 'json',
							success: function (data) {

								$("#divObligation").css("display", "none");
								swal("Creado exitoso de la obligacion!", "Continua con tu proceso!", "success");
								$('textarea[name="observationObligation"]').val("");
								addObligation.length=0;
								totalObligation=0;
								cantidad = 0;
								totalOperateArrayObligation.length=0;
								totalOperateObligation=0;
								var table = $('#dataTableObligation').DataTable(); 
								var rows = table.rows().remove().draw();
								countAccountOB = 0
								var tableACOB = $('#dataTableGetAccountsObligation').DataTable(); 
								var rows = tableACOB.rows().remove().draw();
								$("#totalObligation").text("SALDO: "+ totalOperateObligation);														
								$("#totalObligationBalance").text("OBLIGACIÓN: "+ totalObligation);	
								$('#terceroSelectObligation').prop('disabled',false)
								

								
							}
						});
					} else {
						alert("Por favor llene todos los campos");
					}
					return false;
				}
			});
		}
	}else{
		if(totalObligation==0){
		swal("No puede guardar la obligacion sin valores", "Por favor ingrese la obligacion", "error");
		}else{
			swal({
				title: "Desea terminar la obligación ?",
				text: "Al confirmar esta acción, la obligación sera guardado",
				icon: "warning",
				buttons: true,
				dangerMode: true,
				}).then((willDelete) => {
				if (willDelete) {

					var obligationCode = $('input[name="numberObligation"]').val();
					var observation = $('textarea[name="observationObligation"]').val();
					var date = $('input[name="dateObligation"]').val();
					if (obligationCode,observation,date) {
						// Create Ajax Call
						$.ajax({
							url: '{% url "createObligation"  0 %}'.replace('0', localStorage.getItem('userID')),
							data: {
								'bussines':localStorage.getItem('idBussines'), 
								'obligationCode': obligationCode,
								'origin': originID,
								'date': date,
								'observation': observation,
								'value':totalObligation,
								'balance': totalOperateObligation,
								'obligations': JSON.stringify(addObligation),
								'accounts': JSON.stringify(accountsWithValues),						
								'register':registerSec,
								'third': $("#terceroSelectObligation").val(),
								'rightsEconomic': checkEconomicsRight
							},
							dataType: 'json',
							success: function (data) {

								$("#divObligation").css("display", "none");
								swal("Creado exitoso de la obligación!", "Continua con tu proceso!", "success");
								$('textarea[name="observationObligation"]').val("");
								addObligation.length=0;
								totalObligation=0;
								countAccountOB =0
								totalOperateArrayObligation.length=0;
								totalOperateObligation=0;
								var table = $('#dataTableObligation').DataTable(); 
								var rows = table.rows().remove().draw();
								var tableACOB = $('#dataTableGetAccountsObligation').DataTable(); 
								var rows = tableACOB.rows().remove().draw();
								$("#totalObligation").text("SALDO: "+ totalOperateObligation);														
								$("#totalObligationBalance").text("OBLIGACIÓN: "+ totalObligation);		


								$('input[name=typeComprobante]:checked', '#addVoucher').attr('checked',false)
								$('#COMPROBANTEPAGO', '#addVoucher').attr('checked',true)
								var nameOrigin = $('input[name=origins]:checked', '#addVoucher').val();
								$("#generator").text("GENERAR COMPROBANTE DE PAGO DE PRESUPUESTO DE "+ nameOrigin);
								$('input[name=typeComprobante]:checked', '#addVoucher').val('COMPROBANTEPAGO')
								$('input[name=typeComprobante]:checked', '#addVoucher').attr('checked',true)
								$('#terceroSelectObligation').prop('disabled',false)

							}
						});
					} else {
						alert("Por favor llene todos los campos");
					}
					return false;
				}
				});
			}		
		}
	}else{
			swal("No puede guardar", "Por favor validar las cuentas contables", "error");
		}

	
	
}
function getDataToGenerateVoucher(){

	$("#divCreate").css("display", "none");
	$("#divRegister").css("display", "none");
	$("#divObligation").css("display", "none");
	$("#divVoucherPayment").css("display", "block");

	$.ajax({
			url: '{% url "getDataToVoucherPayment"  0 %}'.replace('0', localStorage.getItem('userID')),
			data: {
				'bussines':localStorage.getItem('idBussines'),
				'origin': originID
			},
			dataType: 'json',
			success: function (data) {

				const $selectTH = document.querySelector("#terceroSelectVoucher");
				
				$('#terceroSelectVoucher').append(`<option  hidden  selected"> Selecciona una opción</option>`);
				for (var i=0; i<data.TH.length; i++){
					$('#terceroSelectVoucher').append('<option value='+data.TH[i].id+'>'+data.TH[i].name + " " +data.TH[i].surnames+'</option>')
				}

				var table = $('#dataTableGetObligation').DataTable(); 
				var rows = table.rows().remove().draw();
				for (var i=0; i<data.VP.length; i++){

					table.row.add( [
					data.VP[i].vouchePayment,
					data.VP[i].observation,
					data.VP[i].value,
					data.VP[i].balance,
					"<a data-toggle='tooltip' type='button' title='Actualizar comprobante de pago'><button  class='btn btn-primary btn-sm'><i class='fa fa-check' aria-hidden='true'></i></button></a>"+
					"<a data-toggle='tooltip' type='button' title='Eliminar comprobante de pago'><button onclick=\'deleteObligation("+JSON.stringify(data.VP[i].id)+','+JSON.stringify(data.VP[i].vouchePayment)+")\' class='btn btn-primary btn-sm'><i class='fa fa-trash'></i></button></a>"
					])
				}
				table.draw( false );
			}
	});
	$.ajax({
			url: '{% url "getSerialVoucherPayment"  0 %}'.replace('0', localStorage.getItem('userID')),
			data: {
				'bussines':localStorage.getItem('idBussines'),
				'origin': originID
			},
			dataType: 'json',
			success: function (data) {
				$("#observationVoucherPayment").val(data.OB); 

			}
	});
}

function selectThirdToVoucher(id){
	$('#myModalResult').modal('toggle');

	$.ajax({
			url: '{% url "filterObligationByName"  0 %}'.replace('0', localStorage.getItem('userID')),
			data: {
				'id':id
			},
			dataType: 'json',
			success: function (data) {
				var table = $('#datatableResultsFilterObligation').DataTable(); 
				var rows = table.rows().remove().draw();
				const $select = document.querySelector("#selectObligationVoucher");
				for (let i = $select.options.length; i >= 0; i--) {
						$select.remove(i);
				}
				$('#selectObligationVoucher').append(`<option  hidden  selected"> Selecciona una opción</option>`);	
				
				for (var i=0; i<data.MV.length; i++){
					$('#selectObligationVoucher').append('<option value='+data.MV[i].movement_id+'>'+data.MV[i].movement__obligation+'</option>')
					table.row.add([
					data.MV[i].movement__obligation,
					data.MV[i].movement__observation,
					data.MV[i].movement__date,
					data.MV[i].movement__origin,
					"<a data-toggle='tooltip' type='button' title='Seleccionar'><button  onclick=\'selectObligationsData("+JSON.stringify(data.MV[i].movement_id)+','+ id +")\' class='btn btn-primary btn-sm'><i class='fa fa-check' aria-hidden='true'></i></button></a>"
					])
				}
				table.draw( false );
				
				$('#myModalResultObligations').modal('toggle');
	
			}
	});	
}
function getSerialVoucherPayment(){

	$.ajax({
			url: '{% url "getSerialVoucherPayment"  0 %}'.replace('0', localStorage.getItem('userID')),
			data: {
				'bussines':localStorage.getItem('idBussines'),
				'origin': originID
			},
			dataType: 'json',
			success: function (data) {
				$("#numberVoucherPayment").val(data.VP); 

			}
	});
}
function selectObligationsData(id,third){
	$('#myModalResultObligations').modal('toggle');
	getSerialVoucherPayment();
	$.ajax({
			url: '{% url "getObligationsSelect"  0 %}'.replace('0', localStorage.getItem('userID')),
			data: {
				'id':id,
				'bussines':localStorage.getItem('idBussines'),
			},
			dataType: 'json',
			success: function (data) {
				console.log(data,"aqui")
				discountsRepeat = data.DC;
				accontsToVoucher = data.account;
				console.log(data.account);
				$('#observationVoucherPayment').val(data.OBSERVATION);
				$('#dateVoucherPayment').val(data.DATE);
				$('#selectObligationVoucher').val(id);
				$('#selectObligationVoucher').prop('disabled', 'disabled');
				$('#terceroSelectVoucher').val(third);
				$('#terceroSelectVoucher').prop('disabled', 'disabled');
				var table = $('#dataTableVoucher').DataTable(); 
 				var rows = table.rows().remove().draw();
				for (var i=0; i<data.RUBRO.length; i++){

				table.row.add( [
				data.RUBRO[i].rubro,
				data.RUBRO[i].description,
				data.RUBRO[i].value,
				"<input type='text'  onkeypress='return validaNumericos(event)'/   size='10'   id=voucher"+data.RUBRO[i].idObligation+" class='form-control' name='inputObligation'>",
				"<label type='number' id=obligationVoucher"+data.RUBRO[i].idObligation+">"+ JSON.stringify(data.RUBRO[i].valueP)+"</label>",
				"<a data-toggle='tooltip' title='Validar operación'><button type='button' onclick=\'operateBalanceVoucher("+JSON.stringify(data.RUBRO[i].id)+','+JSON.stringify(data.RUBRO[i].rubro)+','+JSON.stringify(data.RUBRO[i].value)+','+JSON.stringify(data.RUBRO[i].idObligation)+','+JSON.stringify(data.RUBRO[i].valueP)+")\' class='btn btn-primary btn-sm'><i class='fa fa-check' aria-hidden='true'></i></button></a>"			
				])
				arrayIdsVoucher.push(data.RUBRO[i].id);

			}
			table.draw( false );
			const $selectVC = document.querySelector("#typeDocument");
				
			for (let i = $selectVC.options.length; i >= 0; i--) {
						$selectVC.remove(i);
			}  
			$('#typeDocument').append(`<option  hidden  selected"> Selecciona una opción</option>`);
			for (var i=0; i<data.VC.length; i++){
				$('#typeDocument').append('<option value='+data.VC[i].id+'>'+data.VC[i].code + " " +data.VC[i].name+'</option>')
			}
			$("#postSelection").css("display", "block");

		}
	});	
}
function operateBalanceVoucher(id,rubro,value,Obligation,valueP,idrubro,idObligation,moveId){

	var createId =  "#voucher"+idObligation;
	var result= "#obligationVoucher"+idObligation
	var operate=0;
	var valueRegister = parseInt(value);
	operate = parseInt(value) - parseInt($(createId).val());
	var valueAccount=parseInt($(createId).val());
	const found = addVoucher.findIndex(element => element['idObligation'] == idObligation);
	console.log(parseInt(valueP),parseInt($(createId).val()),id)
	if(parseInt($(createId).val())==0 || $(createId).val()==''){
		swal("No se puede generar una operacion de valor 0", " " , "error");
	}else{
		if(found<0){
			if(operate<0){
					swal("El valor de "+ parseInt($(createId).val())+" es mayor a el valor de  "+ valueP, " No se puede realizar  la obligacion", "error");
				}else{
					$(result).text(operate);
					addVoucher.push({
						"idObligation":idObligation,
						"id": idrubro,
						"rubro": rubro,
						"value":parseInt($(createId).val()),
						"balance":operate
					})
					totalOperateArrayVoucher.push({
						"id": id,
						"subtotal": operate,
						"obligation":  parseInt($(createId).val())
					})
					totalOperateVoucher = totalOperateVoucher + operate;	
					totalVoucher = totalVoucher + parseInt($(createId).val());
					$("#totalVoucher").text("SALDO: "+ totalOperateVoucher);			 
					$("#totalVoucherBalance").text("COMPROBANTE DE PAGO: "+ totalVoucher);														

				}

			}else{

				if(operate<0){
					swal("El valor de "+ parseInt($(createId).val())+" es mayor a el valor de  "+ valueP, " No se puede realizar la obligación", "error");
				}else{
					$(result).text(operate);
					addVoucher[found] ={
						"idObligation":idObligation,
						"id": idrubro,
						"rubro": rubro,
						"value":parseInt($(createId).val()),
						"balance":operate
					}
					totalOperateVoucher = totalOperateVoucher - totalOperateArrayVoucher[found]['subtotal'];	
					totalVoucher = totalVoucher - totalOperateArrayVoucher[found]['obligation'];
					totalOperateArrayVoucher[found] = {
						"id": id,
						"subtotal": operate,
						"obligation":  parseInt($(createId).val())
					}
					totalOperateVoucher = totalOperateVoucher + totalOperateArrayVoucher[found]['subtotal'];	
					totalVoucher = totalVoucher + totalOperateArrayVoucher[found]['obligation'];
					$("#totalVoucher").text("SALDO: "+ totalOperateVoucher);														
					$("#totalVoucherBalance").text("COMPROBANTE DE PAGO: "+ totalVoucher);														

				}
		}
		$('#buttonGetThird').attr('disabled',true)


	}
	$.ajax({
			url: '{% url "getObligationsSelect"  0 %}'.replace('0', localStorage.getItem('userID')),
			data: {
				'id':idObligation,
				'bussines':localStorage.getItem('idBussines'),
			},
			dataType: 'json',
			success: function (data) {
				accontsToVoucher.push(data.account)
			}
		
	})


	var table2 = $('#dataTableVoucher').DataTable(); 
	var count1 = table2.rows().count();

	if(count1 == addVoucher.length){
		$('#addDiscount').attr("disabled", false);
	


		var tableDiscount = $('#dataTableGetDiscounts').DataTable(); 
		var data = tableDiscount.rows().data();

		data.each(function (value, index) {	

			
			const found = addDiscounts.findIndex(element => element['id'] == value[0]);

			addDiscounts[found]["base"] = parseInt(totalVoucher)

			if(value[5] == "PORCENTAJE"){	
				var valueDisccount = parseInt(totalVoucher)*(value[6])/100
				$("#discountValue"+value[0]).val(valueDisccount)
			}

			if(value[5] == "PORCENTAJE RANGO"){	
				if(beetween(parseInt($(createId).val()),discountsRepeat[index].initialValue,discountsRepeat[index].finalValue)==true){
					var valueDisccount = parseInt(totalVoucher)*(value[6])/100
					$("#discountValue"+value[0]).val(valueDisccount)
				}
				
			}

			if(value[5] == "FIJO RANGO"){	
				if(beetween(parseInt($(createId).val()),discountsRepeat[index].initialValue,discountsRepeat[index].finalValue)==true){
					$("#discountValue"+value[0]).val(discountsRepeat[index].average)
				}
			}
		});
	

	}
}

function beetween(valor,min,max){

	if(valor>=min && valor<=max){
		return true;
	}else{
		return false;
	}

}
function getDiscountsManuals(){
	$.ajax({
			url: '{% url "getDiscountsManuals" 0 %}'.replace('0', localStorage.getItem('userID')),
			data: {
				'bussines':localStorage.getItem('idBussines')
			},
			dataType: 'json',
			success: function (data) {
				console.log(data,"getDis")
				var table = $('#dataTableSelectDiscount').DataTable(); 
				var rows = table.rows().remove().draw();

				for (var i=0; i<data.DC.length; i++){

				table.row.add( [
					data.DC[i].id,	
					data.DC[i].name,
					data.DC[i].account__code,
					data.DC[i].account__description,
					data.DC[i].acumulate,
					data.DC[i].typeDiscount,
					data.DC[i].average,
					"<a data-toggle='tooltip' title='Validar operación'><button type='button' onclick=\'selectDiscountToVoucher("+JSON.stringify(data.DC[i].id)+","+JSON.stringify(data.DC[i].name)+","+JSON.stringify(data.DC[i].account__code)+","+JSON.stringify(data.DC[i].acumulate)+","+JSON.stringify(data.DC[i].typeDiscount)+","+JSON.stringify(data.DC[i].average)+","+JSON.stringify(data.DC[i].baseCalculate)+","+JSON.stringify(data.DC[i].initialValue)+","+JSON.stringify(data.DC[i].finalValue)+","+JSON.stringify(data.DC[i].account__description)+")\' class='btn btn-primary btn-sm'><i class='fa fa-check' aria-hidden='true'></i></button></a>"
				])
			}
			table.draw( false );
			}
		});
}

function selectDiscountToVoucher(id,name,account_code,acumulate,typeDiscount,average,baseCalculate,initialValue,finalValue,description){

	const found = addDiscounts.findIndex(element => element['id'] == id);
	if(found < 0){
		var tableDiscount = $('#dataTableGetDiscounts').DataTable(); 
		if(typeDiscount=="PORCENTAJE RANGO"){
				var total = 0
					for (var i=0; i<totalOperateArrayVoucher.length; i++){
						total += totalOperateArrayVoucher[i].obligation
					}
				console.log(total)
				if(beetween(parseInt(total),initialValue,finalValue)==true){
						tableDiscount.row.add( [
						id,
						name,
						account_code,
						description,
						acumulate,
						typeDiscount,
						average,
						"<input type='text'  onkeypress='return validaNumericos(event)'/   size='10'  value="+parseInt(total)*(average)/100+"  id=discountValue"+id+" class='form-control'>",
						"<a data-toggle='tooltip' title='Validar operación'><button type='button' id='buttonDiscountsDelete"+id+"' onclick=\'discountsDelete("+id+',this'+")\' class='btn btn-primary btn-sm'><i class='fa fa-trash' aria-hidden='true'></i></button></a>"+
						"<a data-toggle='tooltip' title='Validar operación'><button type='button' id='buttonDiscountsChange"+id+"' onclick=\'discountsChange("+id+','+total+")\' class='btn btn-primary btn-sm'><i class='fa fa-check' aria-hidden='true'></i></button><label id=validatediscount"+id+">sin validar</label></a>"		
					])
					addDiscounts.push({"id":id,"base": totalVoucher,"value":parseInt(total)*(average)/100, "validate":false})	
				}else{
					tableDiscount.row.add( [
						id,
						name,
						account_code,
						description,
						acumulate,
						typeDiscount,
						average,
						"<input type='text'  onkeypress='return validaNumericos(event)'/   size='10'  value="+0+"  id=discountValue"+id+" class='form-control'>",
						"<a data-toggle='tooltip' title='Validar operación'><button type='button' id='buttonDiscountsDelete"+id+"' onclick=\'discountsDelete("+id+',this'+")\' class='btn btn-primary btn-sm'><i class='fa fa-trash' aria-hidden='true'></i></button></a>"+
						"<a data-toggle='tooltip' title='Validar operación'><button type='button' id='buttonDiscountsChange"+id+"' onclick=\'discountsChange("+id+','+total+")\' class='btn btn-primary btn-sm'><i class='fa fa-check' aria-hidden='true'></i></button><label id=validatediscount"+id+">sin validar</label></a>"			
					])
					addDiscounts.push({"id":id,"base": totalVoucher,"value":0, "validate":false})
				}
			}
			if(typeDiscount=="FIJO RANGO"){
				var total = 0
				for (var i=0; i<totalOperateArrayVoucher.length; i++){
					total += totalOperateArrayVoucher[i].obligation
				}
				if(beetween(parseInt(total),initialValue,finalValue)==true){
					tableDiscount.row.add( [
						id,
						name,
						account_code,
						description,
						acumulate,
						typeDiscount,
						average,
						"<input type='text'  onkeypress='return validaNumericos(event)'/   size='10'  value="+average+"  id=discountValue"+id+" class='form-control'>",
						"<a data-toggle='tooltip' title='Validar operación'><button type='button' id='buttonDiscountsDelete"+id+"' onclick=\'discountsDelete("+id+',this'+")\' class='btn btn-primary btn-sm'><i class='fa fa-trash' aria-hidden='true'></i></button></a>"+
						"<a data-toggle='tooltip' title='Validar operación'><button type='button' id='buttonDiscountsChange"+id+"' onclick=\'discountsChange("+id+','+total+")\' class='btn btn-primary btn-sm'><i class='fa fa-check' aria-hidden='true'></i></button><label id=validatediscount"+id+">sin validar</label></a>"			
					])
					addDiscounts.push({"id":id,"base": totalVoucher,"value":average, "validate":false})
				}else{
					tableDiscount.row.add( [
						id,
						name,
						account_code,
						description,
						acumulate,
						typeDiscount,
						average,
						"<input type='text'  onkeypress='return validaNumericos(event)'/   size='10'  value="+0+"  id=discountValue"+id+" class='form-control'>",
						"<a data-toggle='tooltip' title='Validar operación'><button type='button' id='buttonDiscountsDelete"+id+"' onclick=\'discountsDelete("+id+',this'+")\' class='btn btn-primary btn-sm'><i class='fa fa-trash' aria-hidden='true'></i></button></a>"+
						"<a data-toggle='tooltip' title='Validar operación'><button type='button' id='buttonDiscountsChange"+id+"' onclick=\'discountsChange("+id+','+total+")\' class='btn btn-primary btn-sm'><i class='fa fa-check' aria-hidden='true'></i></button><label id=validatediscount"+id+">sin validar</label></a>"			
					])
					addDiscounts.push({"id":id,"base": totalVoucher,"value":0, "validate":false})
				}
			}
			if(typeDiscount=="PORCENTAJE"){
				var total = 0
				for (var i=0; i<totalOperateArrayVoucher.length; i++){
					total += totalOperateArrayVoucher[i].obligation
				}
				console.log(total)
				tableDiscount.row.add( [
					id,
					name,
					account_code,
					description,
					acumulate,
					typeDiscount,
					average,
					"<input type='text'  onkeypress='return validaNumericos(event)'/   size='10'  value="+parseInt(total)*(average)/100+"  id=discountValue"+id+" class='form-control'>",
					"<a data-toggle='tooltip' title='Validar operación'><button type='button' id='buttonDiscountsDelete"+id+"' onclick=\'discountsDelete("+id+',this'+")\' class='btn btn-primary btn-sm'><i class='fa fa-trash' aria-hidden='true'></i></button></a>"+
					"<a data-toggle='tooltip' title='Validar operación'><button type='button' id='buttonDiscountsChange"+id+"' onclick=\'discountsChange("+id+','+total+")\' class='btn btn-primary btn-sm'><i class='fa fa-check' aria-hidden='true'></i></button><label id=validatediscount"+id+">sin validar</label></a>"			
				])
				addDiscounts.push({"id":id,"base": totalVoucher,"value":parseInt(total)*(average)/100, "validate":false})

			}
			if(typeDiscount=="FIJO"){
					var total = 0
					for (var i=0; i<totalOperateArrayVoucher.length; i++){
						total += totalOperateArrayVoucher[i].obligation
					}
					tableDiscount.row.add( [
						id,
						name,
						account_code,
						description,
						acumulate,
						typeDiscount,
						average,
						"<input type='text'  onkeypress='return validaNumericos(event)'/   size='10'  value="+average+"  id=discountValue"+id+" class='form-control'>",
						"<a data-toggle='tooltip' title='Validar operación'><button type='button' id='buttonDiscountsDelete"+id+"' onclick=\'discountsDelete("+id+',this'+")\' class='btn btn-primary btn-sm'><i class='fa fa-trash' aria-hidden='true'></i></button></a>"+
						"<a data-toggle='tooltip' title='Validar operación'><button type='button' id='buttonDiscountsChange"+id+"' onclick=\'discountsChange("+id+','+total+")\' class='btn btn-primary btn-sm'><i class='fa fa-check' aria-hidden='true'></i></button><label id=validatediscount"+id+">sin validar</label></a>"			
					])
					addDiscounts.push({"id":id,"base": totalVoucher,"value":average, "validate":false})

			}
		$('#myModalDiscount').modal('toggle');	
		tableDiscount.draw( false );

	}else{
		swal("Error", "Ya se encuentra incluido el descuento", "error");
	}
	

}

function discountsDelete(id,row){
	var table = $('#dataTableGetDiscounts').DataTable()

	addDiscounts.splice(addDiscounts.findIndex(el=> el.id ==id), 1);

	table.row(row.closest('tr')).remove().draw(false);
}


function selectDiscountToVoucherAuto(id,name,account_code,acumulate,typeDiscount,average,baseCalculate,initialValue,finalValue,description){
	
	console.log(id,name,account_code,acumulate,typeDiscount,average,baseCalculate,initialValue,finalValue,description)
	if(typeDiscount.toString()=="FIJO"){
		console.log("FIJO")
	}
	var tableDiscount = $('#dataTableGetDiscounts').DataTable(); 
	if(typeDiscount=="PORCENTAJE RANGO"){
			console.log(total)
			if(beetween(parseInt(total),initialValue,finalValue)==true){
					tableDiscount.row.add( [
					id,
					name,
					account_code,
					description,
					acumulate,
					typeDiscount,
					average,
					"<input type='text'  onkeypress='return validaNumericos(event)'/   size='10'  value="+parseInt(totalVoucher)*(average)/100+"  id=discountValue"+id+" class='form-control'>",
					"<a data-toggle='tooltip' title='Validar operación'><button type='button' id='buttonDiscountsDelete"+id+"' onclick=\'discountsDelete("+id+',this'+")\' class='btn btn-primary btn-sm'><i class='fa fa-trash' aria-hidden='true'></i></button></a>"+
					"<a data-toggle='tooltip' title='Validar operación'><button type='button' id='buttonDiscountsChange"+id+"' onclick=\'discountsChange("+id+','+total+")\' class='btn btn-primary btn-sm'><i class='fa fa-check' aria-hidden='true'></i></button><label id=validatediscount"+id+">sin validar</label></a>"			
				])
				addDiscounts.push({"id":id,"base": totalVoucher,"value":parseInt(totalVoucher)*(average)/100, "validate":false})	
			}else{
				tableDiscount.row.add( [
					id,
					name,
					account_code,
					description,
					acumulate,
					typeDiscount,
					average,
					"<input type='text'  onkeypress='return validaNumericos(event)'/   size='10'  value="+0+"  id=discountValue"+id+" class='form-control'>",
					"<a data-toggle='tooltip' title='Validar operación'><button type='button' id='buttonDiscountsDelete"+id+"' onclick=\'discountsDelete("+id+',this'+")\' class='btn btn-primary btn-sm'><i class='fa fa-trash' aria-hidden='true'></i></button></a>"+
					"<a data-toggle='tooltip' title='Validar operación'><button id='buttonDiscountsChange"+id+"' type='button' onclick=\'discountsChange("+id+','+total+")\' class='btn btn-primary btn-sm'><i class='fa fa-check' aria-hidden='true'></i></button><label id=validatediscount"+id+">sin validar</label></a>"			
				])
				addDiscounts.push({"id":id,"base": totalVoucher,"value":0, "validate":false})
			}
	}

	if(typeDiscount=="FIJO RANGO"){
			var total = 0
			for (var i=0; i<totalOperateArrayVoucher.length; i++){
				total += totalOperateArrayVoucher[i].obligation
			}
			if(beetween(parseInt(total),initialValue,finalValue)==true){
				tableDiscount.row.add( [
					id,
					name,
					account_code,
					description,
					acumulate,
					typeDiscount,
					average,
					"<input type='text'  onkeypress='return validaNumericos(event)'/   size='10'  value="+average+"  id=discountValue"+id+" class='form-control'>",
					"<a data-toggle='tooltip' title='Validar operación'><button type='button' id='buttonDiscountsDelete"+id+"' onclick=\'discountsDelete("+id+',this'+")\' class='btn btn-primary btn-sm'><i class='fa fa-trash' aria-hidden='true'></i></button></a>"+
					"<a data-toggle='tooltip' title='Validar operación'><button id='buttonDiscountsChange"+id+"' type='button' onclick=\'discountsChange("+id+','+total+")\' class='btn btn-primary btn-sm'><i class='fa fa-check' aria-hidden='true'></i></button><label id=validatediscount"+id+">sin validar</label></a>"			
				])
				addDiscounts.push({"id":id,"base": totalVoucher,"value":average, "validate":false})
			}else{
				tableDiscount.row.add( [
					id,
					name,
					account_code,
					description,
					acumulate,
					typeDiscount,
					average,
					"<input type='text'  onkeypress='return validaNumericos(event)'/   size='10'  value="+0+"  id=discountValue"+id+" class='form-control'>",
					"<a data-toggle='tooltip' title='Validar operación'><button type='button' id='buttonDiscountsDelete"+id+"' onclick=\'discountsDelete("+id+',this'+")\' class='btn btn-primary btn-sm'><i class='fa fa-trash' aria-hidden='true'></i></button></a>"+
					"<a data-toggle='tooltip' title='Validar operación'><button id='buttonDiscountsChange"+id+"' type='button' onclick=\'discountsChange("+id+','+total+")\' class='btn btn-primary btn-sm'><i class='fa fa-check' aria-hidden='true'></i></button><label id=validatediscount"+id+">sin validar</label></a>"			
				])
				addDiscounts.push({"id":id,"base": totalVoucher,"value":0, "validate":false})
			}
	}

	if(typeDiscount=="PORCENTAJE"){
			tableDiscount.row.add( [
				id,
				name,
				account_code,
				description,
				acumulate,
				typeDiscount,
				average,
				"<input type='text'  onkeypress='return validaNumericos(event)'/   size='10'  value="+parseInt(totalVoucher)*(average)/100+"  id=discountValue"+id+" class='form-control'>",
				"<a data-toggle='tooltip' title='Validar operación'><button type='button' id='buttonDiscountsDelete"+id+"' onclick=\'discountsDelete("+id+',this'+")\' class='btn btn-primary btn-sm'><i class='fa fa-trash' aria-hidden='true'></i></button></a>"+
				"<a data-toggle='tooltip' title='Validar operación'><button id='buttonDiscountsChange"+id+"' type='button' onclick=\'discountsChange("+id+','+total+")\' class='btn btn-primary btn-sm'><i class='fa fa-check' aria-hidden='true'></i></button><label id=validatediscount"+id+">sin validar</label></a>"			
			])
			addDiscounts.push({"id":id,"base": totalVoucher,"value":parseInt(totalVoucher)*(average)/100, "validate":false})

	}
	
	if(typeDiscount=="FIJO"){
				console.log("Entro")
				console.log(id,name,account_code,acumulate,typeDiscount,average,baseCalculate,initialValue,finalValue)
				
				var total = 0
				for (var i=0; i<totalOperateArrayVoucher.length; i++){
					total += totalOperateArrayVoucher[i].obligation
				}
				tableDiscount.row.add( [
					id,
					name,
					account_code,
					description,
					acumulate,
					typeDiscount,
					average,
					"<input type='text'  onkeypress='return validaNumericos(event)'/   size='10'  value="+average+"  id=discountValue"+id+" class='form-control'>",
					"<a data-toggle='tooltip' title='Validar operación'><button type='button' id='buttonDiscountsDelete"+id+"' onclick=\'discountsDelete("+id+',this'+")\' class='btn btn-primary btn-sm'><i class='fa fa-trash' aria-hidden='true'></i></button></a>"+
					"<a data-toggle='tooltip' title='Validar operación'><button id='buttonDiscountsChange"+id+"' type='button' onclick=\'discountsChange("+id+','+total+")\' class='btn btn-primary btn-sm'><i class='fa fa-check' aria-hidden='true'></i></button><label id=validatediscount"+id+">sin validar</label></a>"			
				])
				addDiscounts.push({"id":id,"base": totalVoucher,"value":average, "validate":false})

	}
	tableDiscount.draw( false );

}

function discountsChange(id,baseCalculate){

	var table2 = $('#dataTableVoucher').DataTable(); 
	var count1 = table2.rows().count();
	
	if(count1 == addVoucher.length){

		$('#validatediscount'+id).text("OK")
		
		

		const found = addDiscounts.findIndex(element => element['id'] == id);
		addDiscounts[found] ={"id":id,"base": totalVoucher,"value":parseInt($('#discountValue'+id).val()),"validate":true}
		
		console.log(addDiscounts)

	}



}

var valueTotalAccountVoucherC = 0
var valueTotalAccountVoucherD = 0
function finishDiscounts(){
	var validateDiscount = true
	
	for(var i = 0;i<addDiscounts.length;i++){
		if(addDiscounts[i]['validate']==false){
			validateDiscount = false
			break
			}
		}

	

	if(validateDiscount == true){

		$('#addDiscount').attr('disabled',true)
		
		for(var i = 0;i<addDiscounts.length;i++){
			$('#buttonDiscountsChange'+addDiscounts[i]['id']).attr('disabled',true)
			$('#buttonDiscountsDelete'+addDiscounts[i]['id']).attr('disabled',true)
		}


		var table2 = $('#dataTableVoucher').DataTable(); 
		var count1 = table2.rows().count();

		if(count1 == addVoucher.length){
			var tableDiscount = $('#dataTableGetDiscounts').DataTable(); 
		var data = tableDiscount.rows().data();
		var table = $('#datatableAccountToVoucher').DataTable(); 

		var rows = table.rows().remove().draw();
		totalCreditos=0;
		totalDebitos=0;
		data.each(function (value, index) {
			console.log(value)
			valueTotalAccountVoucherC += parseInt($('#discountValue'+value[0]).val())
			table.row.add( [
				counter,
				value[2],
				value[3],
				" ",
				parseInt($('#discountValue'+value[0]).val()),
				" ",
				" ",
				
			]);
			totalCreditos = totalCreditos+parseInt($('#discountValue'+value[0]).val())
			console.log(totalCreditos)
			counter= counter+1;

		});
		
		var repeat=0;
		table.draw( false );
		
		for (var i=0; i<accontsToVoucher.length; i++){
			var list =accontsToVoucher[i]
			console.log(list,"ac",listComprobante)
			
			for (var k=0; k<list.length; k++){
				const found = listComprobante.findIndex(element => element['rubro'] == list[k].account__rubro__rubro);
				console.log(found)
				if(found != -1){
					/* && list[k].account__document=="Obligacion" */
				if(list[k].typeAccount=="Credito" ){
					totalDebitos += parseInt($("#voucher"+listComprobante[found].idObligation).val())
					if(list[k]['id']==repeat){
						console.log("omito");
					}else{
						valueTotalAccountVoucherD += parseInt($("#voucher"+listComprobante[found].idObligation).val()),
						addAccount.push({"id":list[k].account__account__id,"value":parseInt($("#voucher"+listComprobante[found].idObligation).val()),'tipo':'Debito'});
						table.row.add( [
						counter,
						list[k].account__account__code,
						list[k].account__account__description,
						parseInt($("#voucher"+listComprobante[found].idObligation).val()),
						" ",
						" ",
						" "
						]);
						repeat=list[k].id;
						counter= counter+1;

					}
					}
				}
			}
		}
		table.draw( false );
		$("#countingToVoucher").css("display", "block");
		$("#buttonDiscount").css("display", "none");
		$("#buttonAccount").css("display", "block");

		$('#totalAccountVoucherC').text(valueTotalAccountVoucherC)
		$('#totalAccountVoucherDifer').text(valueTotalAccountVoucherD - valueTotalAccountVoucherC)
		$('#totalAccountVoucherD').text(valueTotalAccountVoucherD)
		}


	}else{
		swal("Error", "Por favor validar todos los descuentos", "error");
	}

}

function finishAccount(){

	if(valueTotalAccountVoucherC != valueTotalAccountVoucherD ){
		swal("Error", "Revisar los debitos y creditos no coinciden", "error");
	}else{
		if(valueTotalAccountVoucherC != totalVoucher || valueTotalAccountVoucherD != totalVoucher){
			swal({
			title: "Deseas salir",
			text: "Al confirmar esta acción, se guardaran los asientos contables como estan",
			icon: "warning",
			buttons: true,
			dangerMode: true,
			}).then((willDelete) => { 
			if (willDelete) {

				for (var i=0;i<addAccount.length;i++){
					$('#buttonDeleteVoucherPaymer'+addAccount[i]['id']).attr('disabled', true)
					$('#buttonCreateVoucherPaymer'+addAccount[i]['id']).attr('disabled', true)
				}
				$('#buttonFinishVoucher').attr('disabled', false)
				$('#buttonAddAccount').attr('disabled', true)
				$('#buttonAccount').css('display', none)
			}})
		}else{
			for (var i=0;i<addAccount.length;i++){
				$('#buttonDeleteVoucherPaymer'+addAccount[i]['id']).attr('disabled', true)
				$('#buttonCreateVoucherPaymer'+addAccount[i]['id']).attr('disabled', true)
			}
			$('#buttonFinishVoucher').attr('disabled', false)
			$('#buttonAddAccount').attr('disabled', true)
			$('#buttonAccount').css('display', 'none')
		}

		
		console.log(addDiscounts)
		console.log(addAccount)
	}
}

function searchAccountsButtonToVoucher(id,valueAccount,rubro){

	$.ajax({
		url: '{% url "getSearchAccountButton"  0 %}'.replace('0', localStorage.getItem('userID')),
		data: {
			'bussinesId': localStorage.getItem('idBussines'),            
			'idAC': localStorage.getItem('idAC')
		},
		dataType: 'json',
		success: function (data) {

			var table = $('#datatableAccountButtonVoucher').DataTable(); 
			var rows = table.rows().remove().draw();
			for (var i=0; i<data.ACCOUNT.length; i++){

				table.row.add( [
				data.ACCOUNT[i].code,
				data.ACCOUNT[i].description,
				"<a data-toggle='tooltip' title='Seleccionar cuenta'><button id="+JSON.stringify(data.ACCOUNT[i].id)+" onclick=\'selectAccountToVoucher("+JSON.stringify(data.ACCOUNT[i].code)+","+JSON.stringify(data.ACCOUNT[i].id)+','+JSON.stringify(data.ACCOUNT[i].description)+")\' class='btn btn-primary btn-sm'><i class='fa fa-check' aria-hidden='true'></i></button></a>"														
			])
			
		}
		table.draw( false );
		}
	});

}


function selectAccountToVoucher(code,id,description){
	const found = addAccount.findIndex(element => element['id'] == id);

	if(found < 0){
		var table = $('#datatableAccountToVoucher').DataTable();
		addAccount.push({"id":id,"value":0, "tipo":""});
		table.row.add( [
					counter,
					code,
					description,
					"<input type='text'  oninput='inputDebito(this.value,"+id+")' onkeypress='return validaNumericos(event)'/   size='10'   id=accountValueD"+id+" class='form-control'> ",
					"<input type='text'  oninput='inputCredito(this.value,"+id+")' onkeypress='return validaNumericos(event)'/   size='10'   id=accountValueC"+id+" class='form-control'> ",
					"<input type='text'    size='10'   id=accountDocument"+id+" class='form-control'>",
					"<a data-toggle='tooltip' title='Seleccionar cuenta'><button id='buttonDeleteVoucherPaymer"+id+"' onclick=\'deleteVoucherPayment("+id+",this)\' class='btn btn-primary btn-sm'><i class='fa fa-trash' aria-hidden='true'></i></button></a>"+
					"<a data-toggle='tooltip' title='Seleccionar cuenta'><button  id='buttonCreateVoucherPaymer"+id+"' onclick=\'createVoucherPayment("+id+")\' class='btn btn-primary btn-sm'><i class='fa fa-check' aria-hidden='true'></i></button></a>"
					
		]).draw(false);
		counter= counter+1;
		$('#myModalAccountVoucher').modal('toggle');	

	}else{
		swal("Error", "Ya se encuentra incluido la cuenta", "error");
	}
	
}

function deleteVoucherPayment(id,row){
	var table = $('#datatableAccountToVoucher').DataTable()

	addAccount.splice(addAccount.findIndex(el=> el.id ==id), 1);

	table.row(row.closest('tr')).remove().draw(false);
}

function inputDebito(valor,id){
	const found = addAccount.findIndex(element => element.id == id);

	if(addAccount[found]['tipo'] == "Credito"){
		valueTotalAccountVoucherC -= addAccount[found]['value']	
		addAccount[found]['value'] = 0		
		$('#totalAccountVoucherC').text(valueTotalAccountVoucherC)

	}
	if(valor!=''){
		addAccount[found]['tipo'] = "Debito"
		$('#accountValueC'+id).attr('disabled',true)
	}else{
		$('#accountValueC'+id).attr('disabled',false)
	}
}

function inputCredito(valor,id){
	const found = addAccount.findIndex(element => element.id == id);
	if(addAccount[found]['tipo'] == "Debito"){
		valueTotalAccountVoucherD -= addAccount[found]['value']	
		addAccount[found]['value'] = 0	
		$('#totalAccountVoucherD').text(valueTotalAccountVoucherD)
	}

	if(valor!=''){
		addAccount[found]['tipo'] = "Credito"
		$('#accountValueD'+id).attr('disabled',true)
	}else{
		$('#accountValueD'+id).attr('disabled',false)
	}
}


function createVoucherPayment(id){

	const found = addAccount.findIndex(element => element.id == id);
	
	if(addAccount[found].value == 0){
		console.log(addAccount)
		if($("#accountDocument"+id).val()==""){
			swal("No hay documento", "Por favor llenar el documento", "error");
		}else{
			

			if(($('#accountValueC'+id).val()=='' &&  $('#accountValueD'+id).val()=='') || (parseInt($('#accountValueC'+id).val())==0 || parseInt($('#accountValueD'+id).val())==0)){
				addAccount[found]['value'] = 0		
				swal("Error", "No se puede validar vacio o valor 0", "error");
			}else{

				if($('#accountValueD'+id).val()!=''){
					addAccount[found]['value'] = parseInt($("#accountValueD"+id).val())
					valueTotalAccountVoucherD += parseInt($("#accountValueD"+id).val())
					$('#totalAccountVoucherD').text(valueTotalAccountVoucherD)
				}

				if($('#accountValueC'+id).val()!=''){
					addAccount[found]['value'] = parseInt($("#accountValueC"+id).val())
					valueTotalAccountVoucherC += parseInt($("#accountValueC"+id).val())			
					$('#totalAccountVoucherC').text(valueTotalAccountVoucherC)
				}
			}


		}

	}else{
		if($("#accountDocument"+id).val()==""){
			swal("No hay documento", "Por favor llenar el documento", "error");
		}else{
			
			console.log(addAccount[found],"pos")
		

			if($('#accountValueC'+id).val()=='' && $('#accountValueD'+id).val()=='' || (parseInt($('#accountValueC'+id).val())==0 || parseInt($('#accountValueD'+id).val())==0)){
				swal("Error", "No se puede validar vacio o valor 0", "error");
				if(addAccount[found].tipo == 'Debito'){
					parseInt($("#accountValueD"+id).val(addAccount[found].value))
					
					$('#accountValueC'+id).attr('disabled',true)
				}else{
					parseInt($("#accountValueC"+id).val(addAccount[found].value))
					
					$('#accountValueD'+id).attr('disabled',true)		
				}
			}else{

				if(addAccount[found].tipo == 'Debito' && $('#accountValueC'+id).val()!=''){

				}


				if($('#accountValueD'+id).val()!=''){
					valueTotalAccountVoucherD = valueTotalAccountVoucherD - addAccount[found].value
					addAccount[found].value = parseInt($("#accountValueD"+id).val())
					valueTotalAccountVoucherD += parseInt($("#accountValueD"+id).val())
					$('#totalAccountVoucherD').text(valueTotalAccountVoucherD)
				}

				if($('#accountValueC'+id).val()!=''){
					console.log(addAccount[found]['value'],"c")
					valueTotalAccountVoucherC = valueTotalAccountVoucherC - addAccount[found].value
					addAccount[found].value	 = parseInt($("#accountValueC"+id).val())
					valueTotalAccountVoucherC += parseInt($("#accountValueC"+id).val())	
					$('#totalAccountVoucherC').text(valueTotalAccountVoucherC)
				}


			}
		}


	}
	$('#totalAccountVoucherDifer').text(valueTotalAccountVoucherD- valueTotalAccountVoucherC)



	
	console.log(addAccount,addAccount[found]['value'],"subf")
	
	
}

function SendCreateVoucherPayment(){
	console.log(addVoucher)
	if(valueTotalAccountVoucherC==valueTotalAccountVoucherD){
		if(totalVoucher==0){
			swal("No puede guardar el pago  sin valores", "Por favor ingrese el pago", "error");
		}
		else{
		 	swal({
			title: "Desea terminar el pago ?",
			text: "Al confirmar esta acción, el pago sera guardado",
			icon: "warning",
			buttons: true,
			dangerMode: true,
			}).then((willDelete) => { 
			if (willDelete) {

				var paymentCode = $('input[name="numberVoucherPayment"]').val();
				var observation = $('textarea[name="observationVoucherPayment"]').val();
				var date = $('input[name="dateVoucherPayment"]').val();
				console.log(addVoucher)
				if (paymentCode,observation,date) {
					// Create Ajax Call
					$.ajax({
						url: '{% url "createVoucherPayment"  0 %}'.replace('0', localStorage.getItem('userID')),
						data: {
							'bussines':localStorage.getItem('idBussines'), 
							'obligation': $('#selectObligationVoucher').val(),
							'paymentCode': paymentCode,
							'origin': originID,
							'date': date,
							'observation': observation,
							'value':totalVoucher,
							'balance': totalOperateVoucher,
							'typeDocument': $('#typeDocument').val(),
							'payments': JSON.stringify(addVoucher),
							'discounts': JSON.stringify(addDiscounts),
							'accounts': JSON.stringify(addAccount)

						},
						dataType: 'json',
						success: function (data) {

							$("#divVoucherPayment").css("display", "none");
							$("#countingToVoucher").css("display", "none");
							$("#postSelection").css("display", "none");

							swal("Creado exitoso del comprobante de pago!", "Continua con tu proceso!", "success");
							$('textarea[name="observationVoucherPayment"]').val("");
							addDiscounts.length=0;
							totalVoucher=0;
							addAccount.length=0;
							addVoucher.length=0;
							totalOperateVoucher=0; 
							$("#totalVoucher").text("SALDO: "+ totalVoucher);														
							$("#totalVoucherBalance").text("OBLIGACIÓN: "+ totalOperateVoucher);
							
							
							$('#buttonGetThird').attr('disabled',false)


							$('#id_input_filter').val('')
							listComprobante = []

							$('#buttonAccount').css("display", "none");
							$('#buttonFinishVoucher').attr('disabled',true);
							
							$("#buttonDiscount").css("display", "block");

							valueTotalAccountVoucherC = 0
							valueTotalAccountVoucherD = 0
							addDiscounts = []
							addDiscounts.length = 0
							totalVoucher=0;
							addAccount.length=0;
							addVoucher.length=0;
							totalOperateVoucher=0;
							discountsRepeat = []
							var table = $('#dataTableVoucher').DataTable(); 
							var rows = table.rows().remove().draw();
							table.draw()
							var tableD = $('#dataTableGetDiscounts').DataTable(); 
							var rowsD = tableD.rows().remove().draw();
							tableD.draw()
							var tableAC = $('#datatableAccountToVoucher').DataTable(); 
							var rowsAC = tableAC.rows().remove().draw();
							tableAC.draw()	 
							$("#totalVoucher").text("SALDO: "+ totalVoucher);														
							$("#totalVoucherBalance").text("OBLIGACIÓN: "+ totalOperateVoucher);

							$('#observationVoucherPayment').val('')
						}
					});
				} else {
					alert("Por favor llene todos los campos");
				}
				return false;
			}
			});
		}		
	}
	
		
}

function getRubros(){
	$.ajax({
		url: '{% url "getOperationBudget"  0 %}'.replace('0', localStorage.getItem('userID')),
		data: {
			'nameOrigin': $('input[name=origins]:checked', '#separatorOP').val(),
			'nameAC': localStorage.getItem('nameAC'),
			'idBussines': localStorage.getItem('idBussines'),
		},
		dataType: 'json',
		success: function (data) {
			var table = $('#dataTableRubroTem').DataTable(); 
 			var rows = table.rows().remove().draw();

			for (var i=0; i<data.RUBRO.length; i++){
				table.row.add( [
				data.RUBRO[i].id,
				data.RUBRO[i].rubro,
				data.RUBRO[i].typeRubro,
				data.RUBRO[i].description,
				data.RUBRO[i].initialBudget,
				data.RUBRO[i].realBudget,
				data.RUBRO[i].budgetEject
			])
			}
			table
			.order( [ 1, 'asc' ] )
			.draw();
			table.draw(false);
		}
	});

}

listComprobante = []

function selectObligationComprobante(id, register,obligation,rubro,saldo,Fecha,origen,description,saldoP,idrubro,idObligation,idMoveObli){
	
	$('#validate'+id).text("Seleccionado")
	const found = listComprobante.findIndex(element => element['id'] == id);
	console.log(found)
	if(found == -1){
		listComprobante.push({
		"idrubro":idrubro,
		"idObligation":idObligation,
		"id":id,
		"register":register,
		"obligation":obligation,
		"rubro":rubro,
		"Fecha":Fecha,
		"saldo":saldo,
		"saldoP":saldoP,
		"origen":origen,
		"description":description,
		"movementOlbi": idMoveObli
	})
	}else{
		swal({
			title: "Desea desmarcarla ?",
			text: "Al confirmar esta acción, no estara en el comprobante",
			icon: "warning",
			buttons: true,
			dangerMode: true,
			}).then((willDelete) => {
			if (willDelete) {
				listComprobante.splice(found,1);
				$('#validate'+id).text("Sin Seleccionar")
			}
			});
		}
		
	
		console.log(listComprobante)
	
}

function getFinishProcessUpdateRIRegist(){
	contract = $('#selectDetalltypeContractUpdate').val()
	date = $('#dateUpdateRegister').val()
	movementContracDetail = $('#idMovementTC').val()
	registerID = $('#MovementTC').val()
	description = $('#observationUpdateRegister').val()
	thirdupdate = $('#terceroSelectRegisterUpdate').val()
	if(date >= oldDateRegister){	
		$.ajax({
			url: '{% url "updateDetailRegisterBase"  0 %}'.replace('0', localStorage.getItem('userID')),
			data: {
				'TypeContractMovement_id':movementContracDetail,
				'TypeContractMovementID': contract,
				'movementID': registerID,
				'thirdID': thirdupdate,
				'date': date,
				'observation': description
			},
			dataType: 'json',
			success: function (data) {
				console.log(data)
				if(data.OPERO == "SI"){
					swal("Modificación exitosa!", "Continua con tu proceso!", "success");
					$('#myModalRubroImplicadoRegister').modal('toggle');
					getDataToRegister();
				}else{
					swal("Error al mofidicar!", "Ya se esta utilizando en una obligacion!", "error");
					$('#myModalRubroImplicadoRegister').modal('toggle');
				}
				
			}
		});
	}
	else{
		$('#dateUpdateRegister').val(oldDateRegister)
		swal("No se puede modificar los datos la fecha nueva para el registro "+ date+" es menor a la de disponibilidad creada ("+ oldDateRegister+")", " Por favor verifique su proceso", "error");
	}

	


}


function getFinishProcessUpdateRIOblig(){
	date = $('#dateUpdateObligation').val()
	description = $('#observationUpdateObligation').val()
	thirdupdate = $('#terceroSelectUpdateObligation').val()
	ObligationID = $('#MovementOB').val()


	if(date >= oldDateObligation){	
		$.ajax({
			url: '{% url "updateDetailObligateBase"  0 %}'.replace('0', localStorage.getItem('userID')),
			data: {
				'movementID': ObligationID,
				'thirdID': thirdupdate,
				'date': date,
				'observation': description
			},
			dataType: 'json',
			success: function (data) {
				console.log(data)
				if(data.OPERO == "SI"){
					swal("Modificación exitosa!", "Continua con tu proceso!", "success");
					$('#myModalRubroImplicadoObligation').modal('toggle');
					getDataToObligation()
				}else{
					swal("Error al mofidicar!", "Ya se esta utilizando en una obligacion!", "error");
					$('#myModalRubroImplicadoObligation').modal('toggle');
				}
				
			}	
		});
	}
	else{
		$('#dateUpdateObligation').val(oldDateObligation)
		swal("No se puede modificar los datos la fecha nueva para el registro "+ date+" es menor a la de disponibilidad creada ("+ oldDateObligation+")", " Por favor verifique su proceso", "error");
	}

	


}

function procesoComprobante(){
	$('#myModalResult').modal('toggle');
	if(listComprobante.length > 0){
		setTimeout(()=>{
		var fecha = new Date(); //Fecha actual
		var mes = fecha.getMonth()+1; //obteniendo mes
		var dia = fecha.getDate(); //obteniendo dia
		var ano = fecha.getFullYear(); //obteniendo año
		if(dia<10)
			dia='0'+dia; //agrega cero si el menor de 10
		if(mes<10)
			mes='0'+mes //agrega cero si el menor de 10
		document.getElementById('dateVoucherPayment').value=ano+"-"+mes+"-"+dia;
		$.ajax({
			url: '{% url "getSerialVoucherPayment"  0 %}'.replace('0', localStorage.getItem('userID')),
			data: {
				'bussines':localStorage.getItem('idBussines'),
				'origin': originID,
				'dateCreateDP': ano+"-"+mes+"-"+dia
			},
			dataType: 'json',
			success: function (data) {
				$("#numberVoucherPayment").val(data.VP); 

			}
		});
		$.ajax({
			url: '{% url "getDiscountAuto"  0 %}'.replace('0', localStorage.getItem('userID')),
			data: {
				'bussines':localStorage.getItem('idBussines'),
			},
			dataType: 'json',
			success: function (data) {
				console.log(data,"descuento")
				discountsRepeat = data.DC;
				for(var i = 0; i< data.DC.length; i++){
					selectDiscountToVoucherAuto(JSON.stringify(data.DC[i].id),data.DC[i].name,data.DC[i].account__code,data.DC[i].acumulate,data.DC[i].typeDiscount,JSON.stringify(data.DC[i].average),JSON.stringify(data.DC[i].baseCalculate),JSON.stringify(data.DC[i].initialValue),JSON.stringify(data.DC[i].finalValue),data.DC[i].account__description)
				}
				
			}
		});


		$.ajax({
			url: '{% url "getTypeDocument"  0 %}'.replace('0', localStorage.getItem('userID')),
			data: {
				'bussines':localStorage.getItem('idBussines'),
				'period': localStorage.getItem('idAC')
			},
			dataType: 'json',
			success: function (data) {
				console.log(data)
				const $selectDocument = document.querySelector("#typeDocument");

				for (let i = $selectDocument.options.length; i >= 0; i--) {
						$selectDocument.remove(i);
				}

				for(i = 0; i<data.VC.length; i++){
					$('#typeDocument').append('<option data-value2="'+data.VC[i].id+'" value="'+data.VC[i].codigo+'">'+data.VC[i].description+'</option>')
				}
			}
		});

		var table = $('#dataTableVoucher').DataTable(); 
		var rows = table.rows().remove().draw();
		for (var i=0; i<listComprobante.length; i++){	
			console.log(listComprobante[i])
			table.row.add( [
			listComprobante[i].rubro,
			listComprobante[i].description,
			listComprobante[i].saldo,
			"<input type='text'  onkeypress='return validaNumericos(event)'/   size='10'   id=voucher"+listComprobante[i].idObligation+" class='form-control' name='inputObligation'>",
			"<label type='number' id=obligationVoucher"+listComprobante[i].idObligation+">"+ JSON.stringify(listComprobante[i].saldoP)+"</label>",
			"<a data-toggle='tooltip' title='Validar operación'><button type='button' onclick=\'operateBalanceVoucher("+JSON.stringify(listComprobante[i].rubro)+','+JSON.stringify(listComprobante[i].rubro)+','+listComprobante[i].saldo+','+listComprobante[i].obligation+','+listComprobante[i].saldoP+','+JSON.stringify(listComprobante[i].idrubro)+','+JSON.stringify(listComprobante[i].idObligation)+','+JSON.stringify(listComprobante[i].movementOlbi)+")\' class='btn btn-primary btn-sm'><i class='fa fa-check' aria-hidden='true'></i></button></a>"			
			])
			/* ','+JSON.stringify(data.RUBRO[i].idObligation)+','+JSON.stringify(data.RUBRO[i].valueP)+ */

		}
		table.draw()

	},50)
	$("#postSelection").css("display", "block");

	

	}
	
}
/* 
function cancels(){
	$("#postSelection").css("display", "none");
	$('#id_input_filter').val('')
	let table = $('#dataTableVoucher').DataTable(); 
	let rows = table.rows().remove().draw();


	let tableD = $('#dataTableGetDiscounts').DataTable()
	let rowsD = tableD.rows().remove().draw();

	let tableAV = $('#datatableAccountToVoucher').DataTable()
	let rowsAV = tableAV.rows().remove().draw();

	$('#observationVoucherPayment').val('')
}
 */

</script>

{% endblock %}
	
</body>
